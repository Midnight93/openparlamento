/* (C) 2008 henrik.lindqvist@llamalab.com */
(function(a){if(!a.every){a.every=function(e,d){for(var c=0,b=this.length;--b>=0;c++){if(c in this&&!e.call(d,this[c],c,this)){return false}}return true}}if(!a.filter){a.filter=function(f,e){var g=[];for(var c,d=0,b=this.length;--b>=0;d++){if(d in this&&f.call(e,c=this[d],d,this)){g.push(c)}}return g}}if(!a.forEach){a.forEach=function(e,d){for(var c=0,b=this.length;--b>=0;c++){if(c in this){e.call(d,this[c],c,this)}}}}if(!a.indexOf){a.indexOf=function(d,c){var b=this.length;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=b}for(;c<b;c++){if(c in this&&this[c]===d){return c}}return -1}}if(!a.lastIndexOf){a.lastIndexOf=function(d,c){var b=this.length;if(isNaN(c)){c=b-1}else{c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=b}else{if(c>=b){c=b-1}}}for(;c>-1;c--){if(c in this&&this[c]===d){return c}}return -1}}if(!a.map){a.map=function(e,d){var b=this.length;var f=new Array(b);for(var c=0;--b>=0;c++){if(c in this){f[c]=e.call(d,this[c],c,this)}}return f}}if(!a.some){a.some=function(e,d){for(var c=0,b=this.length;--b>=0;c++){if(c in this&&e.call(d,this[c],c,this)){return true}}return false}}})(Array.prototype);
/*
// Copyright 2006 Google Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
*/
if(!document.createElement("canvas").getContext){(function(){var A=Math;var B=A.round;var x=A.sin;var J=A.cos;var q=A.abs;var I=A.sqrt;var a=10;var r=a/2;function n(){return this.context_||(this.context_=new u(this))}var z=Array.prototype.slice;function K(m,L,M){var j=z.call(arguments,2);return function(){return m.apply(L,j.concat(z.call(arguments)))}}var o={init:function(j){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var m=j||document;m.createElement("canvas");m.attachEvent("onreadystatechange",K(this.init_,this,m))}},init_:function(M){if(!M.namespaces.g_vml_){M.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!M.namespaces.g_o_){M.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!M.styleSheets.ex_canvas_){var L=M.createStyleSheet();L.owningElement.id="ex_canvas_";L.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var m=M.getElementsByTagName("canvas");for(var j=0;j<m.length;j++){this.initElement(m[j])}},initElement:function(m){if(!m.getContext){m.getContext=n;m.innerHTML="";m.attachEvent("onpropertychange",H);m.attachEvent("onresize",b);var j=m.attributes;if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"}else{m.width=m.clientWidth}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"}else{m.height=m.clientHeight}}return m}};function H(m){var j=m.srcElement;switch(m.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function b(m){var j=m.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}o.init();var e=[];for(var E=0;E<16;E++){for(var D=0;D<16;D++){e[E*16+D]=E.toString(16)+D.toString(16)}}function v(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(M,L){var m=v();for(var j=0;j<3;j++){for(var P=0;P<3;P++){var N=0;for(var O=0;O<3;O++){N+=M[j][O]*L[O][P]}m[j][P]=N}}return m}function C(m,j){j.fillStyle=m.fillStyle;j.lineCap=m.lineCap;j.lineJoin=m.lineJoin;j.lineWidth=m.lineWidth;j.miterLimit=m.miterLimit;j.shadowBlur=m.shadowBlur;j.shadowColor=m.shadowColor;j.shadowOffsetX=m.shadowOffsetX;j.shadowOffsetY=m.shadowOffsetY;j.strokeStyle=m.strokeStyle;j.globalAlpha=m.globalAlpha;j.arcScaleX_=m.arcScaleX_;j.arcScaleY_=m.arcScaleY_;j.lineScale_=m.lineScale_}function c(m){var N,M=1;m=String(m);if(m.substring(0,3)=="rgb"){var P=m.indexOf("(",3);var j=m.indexOf(")",P+1);var O=m.substring(P+1,j).split(",");N="#";for(var L=0;L<3;L++){N+=e[Number(O[L])]}if(O.length==4&&m.substr(3,1)=="a"){M=O[3]}}else{N=m}return{color:N,alpha:M}}function y(j){switch(j){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function u(m){this.m_=v();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=a*1;this.globalAlpha=1;this.canvas=m;var j=m.ownerDocument.createElement("div");j.style.width=m.clientWidth+"px";j.style.height=m.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";m.appendChild(j);this.element_=j;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var p=u.prototype;p.clearRect=function(){this.element_.innerHTML=""};p.beginPath=function(){this.currentPath_=[]};p.moveTo=function(m,j){var L=this.getCoords_(m,j);this.currentPath_.push({type:"moveTo",x:L.x,y:L.y});this.currentX_=L.x;this.currentY_=L.y};p.lineTo=function(m,j){var L=this.getCoords_(m,j);this.currentPath_.push({type:"lineTo",x:L.x,y:L.y});this.currentX_=L.x;this.currentY_=L.y};p.bezierCurveTo=function(L,m,R,Q,P,N){var j=this.getCoords_(P,N);var O=this.getCoords_(L,m);var M=this.getCoords_(R,Q);s(this,O,M,j)};function s(j,M,L,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:M.x,cp1y:M.y,cp2x:L.x,cp2y:L.y,x:m.x,y:m.y});j.currentX_=m.x;j.currentY_=m.y}p.quadraticCurveTo=function(P,L,m,j){var O=this.getCoords_(P,L);var N=this.getCoords_(m,j);var Q={x:this.currentX_+2/3*(O.x-this.currentX_),y:this.currentY_+2/3*(O.y-this.currentY_)};var M={x:Q.x+(N.x-this.currentX_)/3,y:Q.y+(N.y-this.currentY_)/3};s(this,Q,M,N)};p.arc=function(S,Q,R,N,m,L){R*=a;var W=L?"at":"wa";var T=S+J(N)*R-r;var V=Q+x(N)*R-r;var j=S+J(m)*R-r;var U=Q+x(m)*R-r;if(T==j&&!L){T+=0.125}var M=this.getCoords_(S,Q);var P=this.getCoords_(T,V);var O=this.getCoords_(j,U);this.currentPath_.push({type:W,x:M.x,y:M.y,radius:R,xStart:P.x,yStart:P.y,xEnd:O.x,yEnd:O.y})};p.rect=function(L,m,j,M){this.moveTo(L,m);this.lineTo(L+j,m);this.lineTo(L+j,m+M);this.lineTo(L,m+M);this.closePath()};p.strokeRect=function(L,m,j,M){var N=this.currentPath_;this.beginPath();this.moveTo(L,m);this.lineTo(L+j,m);this.lineTo(L+j,m+M);this.lineTo(L,m+M);this.closePath();this.stroke();this.currentPath_=N};p.fillRect=function(L,m,j,M){var N=this.currentPath_;this.beginPath();this.moveTo(L,m);this.lineTo(L+j,m);this.lineTo(L+j,m+M);this.lineTo(L,m+M);this.closePath();this.fill();this.currentPath_=N};p.createLinearGradient=function(m,M,j,L){var N=new F("gradient");N.x0_=m;N.y0_=M;N.x1_=j;N.y1_=L;return N};p.createRadialGradient=function(M,O,L,m,N,j){var P=new F("gradientradial");P.x0_=M;P.y0_=O;P.r0_=L;P.x1_=m;P.y1_=N;P.r1_=j;return P};p.drawImage=function(Z,L){var R,P,T,ag,X,U,ab,ai;var S=Z.runtimeStyle.width;var Y=Z.runtimeStyle.height;Z.runtimeStyle.width="auto";Z.runtimeStyle.height="auto";var Q=Z.width;var ae=Z.height;Z.runtimeStyle.width=S;Z.runtimeStyle.height=Y;if(arguments.length==3){R=arguments[1];P=arguments[2];X=U=0;ab=T=Q;ai=ag=ae}else{if(arguments.length==5){R=arguments[1];P=arguments[2];T=arguments[3];ag=arguments[4];X=U=0;ab=Q;ai=ae}else{if(arguments.length==9){X=arguments[1];U=arguments[2];ab=arguments[3];ai=arguments[4];R=arguments[5];P=arguments[6];T=arguments[7];ag=arguments[8]}else{throw Error("Invalid number of arguments")}}}var ah=this.getCoords_(R,P);var M=ab/2;var m=ai/2;var af=[];var j=10;var O=10;af.push(" <g_vml_:group",' coordsize="',a*j,",",a*O,'"',' coordorigin="0,0"',' style="width:',j,"px;height:",O,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var N=[];N.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",B(ah.x/a),",","Dy=",B(ah.y/a),"");var ad=ah;var ac=this.getCoords_(R+T,P);var aa=this.getCoords_(R,P+ag);var V=this.getCoords_(R+T,P+ag);ad.x=A.max(ad.x,ac.x,aa.x,V.x);ad.y=A.max(ad.y,ac.y,aa.y,V.y);af.push("padding:0 ",B(ad.x/a),"px ",B(ad.y/a),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",N.join(""),", sizingmethod='clip');")}else{af.push("top:",B(ah.y/a),"px;left:",B(ah.x/a),"px;")}af.push(' ">','<g_vml_:image src="',Z.src,'"',' style="width:',a*T,"px;"," height:",a*ag,'px;"',' cropleft="',X/Q,'"',' croptop="',U/ae,'"',' cropright="',(Q-X-ab)/Q,'"',' cropbottom="',(ae-U-ai)/ae,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",af.join(""))};p.stroke=function(ak){var P=[];var Q=false;var aw=c(ak?this.fillStyle:this.strokeStyle);var ag=aw.color;var aq=aw.alpha*this.globalAlpha;var M=10;var S=10;P.push("<g_vml_:shape",' filled="',!!ak,'"',' style="position:absolute;width:',M,"px;height:",S,'px;"',' coordorigin="0 0" coordsize="',a*M," ",a*S,'"',' stroked="',!ak,'"',' path="');var R=false;var av={x:null,y:null};var ac={x:null,y:null};for(var ap=0;ap<this.currentPath_.length;ap++){var ao=this.currentPath_[ap];var au;switch(ao.type){case"moveTo":au=ao;P.push(" m ",B(ao.x),",",B(ao.y));break;case"lineTo":P.push(" l ",B(ao.x),",",B(ao.y));break;case"close":P.push(" x ");ao=null;break;case"bezierCurveTo":P.push(" c ",B(ao.cp1x),",",B(ao.cp1y),",",B(ao.cp2x),",",B(ao.cp2y),",",B(ao.x),",",B(ao.y));break;case"at":case"wa":P.push(" ",ao.type," ",B(ao.x-this.arcScaleX_*ao.radius),",",B(ao.y-this.arcScaleY_*ao.radius)," ",B(ao.x+this.arcScaleX_*ao.radius),",",B(ao.y+this.arcScaleY_*ao.radius)," ",B(ao.xStart),",",B(ao.yStart)," ",B(ao.xEnd),",",B(ao.yEnd));break}if(ao){if(av.x==null||ao.x<av.x){av.x=ao.x}if(ac.x==null||ao.x>ac.x){ac.x=ao.x}if(av.y==null||ao.y<av.y){av.y=ao.y}if(ac.y==null||ao.y>ac.y){ac.y=ao.y}}}P.push(' ">');if(!ak){var ab=this.lineScale_*this.lineWidth;if(ab<1){aq*=ab}P.push("<g_vml_:stroke",' opacity="',aq,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',y(this.lineCap),'"',' weight="',ab,'px"',' color="',ag,'" />')}else{if(typeof this.fillStyle=="object"){var T=this.fillStyle;var Z=0;var an={x:0,y:0};var ah=0;var X=1;if(T.type_=="gradient"){var V=T.x0_/this.arcScaleX_;var m=T.y0_/this.arcScaleY_;var U=T.x1_/this.arcScaleX_;var ax=T.y1_/this.arcScaleY_;var at=this.getCoords_(V,m);var ar=this.getCoords_(U,ax);var O=ar.x-at.x;var N=ar.y-at.y;Z=Math.atan2(O,N)*180/Math.PI;if(Z<0){Z+=360}if(Z<0.000001){Z=0}}else{var at=this.getCoords_(T.x0_,T.y0_);var j=ac.x-av.x;var L=ac.y-av.y;an={x:(at.x-av.x)/j,y:(at.y-av.y)/L};j/=this.arcScaleX_*a;L/=this.arcScaleY_*a;var am=A.max(j,L);ah=2*T.r0_/am;X=2*T.r1_/am-ah}var af=T.colors_;af.sort(function(ay,W){return ay.offset-W.offset});var aa=af.length;var ae=af[0].color;var ad=af[aa-1].color;var aj=af[0].alpha*this.globalAlpha;var ai=af[aa-1].alpha*this.globalAlpha;var al=[];for(var ap=0;ap<aa;ap++){var Y=af[ap];al.push(Y.offset*X+ah+" "+Y.color)}P.push('<g_vml_:fill type="',T.type_,'"',' method="none" focus="100%"',' color="',ae,'"',' color2="',ad,'"',' colors="',al.join(","),'"',' opacity="',ai,'"',' g_o_:opacity2="',aj,'"',' angle="',Z,'"',' focusposition="',an.x,",",an.y,'" />')}else{P.push('<g_vml_:fill color="',ag,'" opacity="',aq,'" />')}}P.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",P.join(""))};p.fill=function(){this.stroke(true)};p.closePath=function(){this.currentPath_.push({type:"close"})};p.getCoords_=function(M,L){var j=this.m_;return{x:a*(M*j[0][0]+L*j[1][0]+j[2][0])-r,y:a*(M*j[0][1]+L*j[1][1]+j[2][1])-r}};p.save=function(){var j={};C(this,j);this.aStack_.push(j);this.mStack_.push(this.m_);this.m_=d(v(),this.m_)};p.restore=function(){C(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function g(L){for(var N=0;N<3;N++){for(var M=0;M<2;M++){if(!isFinite(L[N][M])||isNaN(L[N][M])){return false}}}return true}function G(L,j,M){if(!g(j)){return}L.m_=j;if(M){var N=j[0][0]*j[1][1]-j[0][1]*j[1][0];L.lineScale_=I(q(N))}}p.translate=function(L,m){var j=[[1,0,0],[0,1,0],[L,m,1]];G(this,d(j,this.m_),false)};p.rotate=function(m){var M=J(m);var L=x(m);var j=[[M,L,0],[-L,M,0],[0,0,1]];G(this,d(j,this.m_),false)};p.scale=function(L,m){this.arcScaleX_*=L;this.arcScaleY_*=m;var j=[[L,0,0],[0,m,0],[0,0,1]];G(this,d(j,this.m_),true)};p.transform=function(N,M,P,O,m,j){var L=[[N,M,0],[P,O,0],[m,j,1]];G(this,d(L,this.m_),true)};p.setTransform=function(O,N,Q,P,M,L){var j=[[O,N,0],[Q,P,0],[M,L,1]];G(this,j,true)};p.clip=function(){};p.arcTo=function(){};p.createPattern=function(){return new f};function F(j){this.type_=j;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}F.prototype.addColorStop=function(m,j){j=c(j);this.colors_.push({offset:m,color:j.color,alpha:j.alpha})};function f(){}G_vmlCanvasManager=o;CanvasRenderingContext2D=u;CanvasGradient=F;CanvasPattern=f})();
/*
  XPath.js, an JavaScript implementation of XML Path Language (XPath) Version 1.0
  Copyright (C) 2008 Henrik Lindqvist <henrik.lindqvist@llamalab.com>
  
  This library is free software: you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as published 
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Lesser General Public License for more details.
  
  You should have received a copy of the GNU Lesser General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
}(function(v,s,m){function u(d){this.e=d;this.i=0;this.js=["with(XPath){return ","}"];this.expression(1,1)||this.error();return new Function("n","nsr",this.js.join(""))}u.ie=/MSIE/.test(navigator.userAgent);u.prototype={match:function(p,e){var d,f;if(!(d=p.exec(this.e.substr(this.i)))||(typeof e=="number"&&!(f=d[e]))||(typeof e=="object"&&!(f=e[d[1]]))){return false}this.m=d;this.i+=d[0].length;return f||d},error:function(f){f=(f||"Syntax error")+" at index "+this.i+": "+this.e.substr(this.i);var p;try{p=new o(51,f)}catch(d){p=new Error(f)}throw p},step:function(d,z,p,A){var f=3;if(this.match(/^(\/\/?|\.\.?|@)\s*/,1)){switch(this.m[1]){case"/":if(p){this.error()}if(!A){return this.step(d,z,1)}this.js.splice(d,0,' axis(axes["',"document-root",'"],');f+=this.nodeTypes.node.call(this,d+f);p=1;break;case"//":if(p){this.error()}this.js.splice(d,0,' axis(axes["',"descendant-or-self",'"],');f+=this.nodeTypes.node.call(this,d+f);p=1;break;case".":if(!p&&!A){this.error()}this.js.splice(d,0,' axis(axes["',"self",'"],');f+=this.nodeTypes.node.call(this,d+f);p=0;break;case"..":if(!p&&!A){this.error()}this.js.splice(d,0,' axis(axes["',"parent",'"],');f+=this.nodeTypes.node.call(this,d+f);p=0;break;case"@":if(!p&&!A){this.error()}this.js.splice(d,0,' axis(axes["',"attribute",'"],');f+=this.nodeTest(d+f,"node")||this.error("Missing nodeTest after @");p=0}}else{if(!p&&!A){return p?this.error():0}else{if(this.match(/^([a-z]+(?:-[a-z]+)*)\s*::\s*/,u.axes)){this.js.splice(d,0,' axis(axes["',this.m[1],'"],');f+=this.nodeTest(d+f,(this.m[1]=="attribute")?"node":"element")||this.error("Missing nodeTest after ::");p=0}else{if(f=this.nodeTest(d,"element")){this.js.splice(d,0,' axis(axes["',"child",'"],');f+=3;p=0}else{return 0}}}}for(var e;e=this.predicate(d+f);f+=e){}if(A){this.js.splice(z+f++,0,A)}f+=this.step(d,z+f,p);this.js.splice(z+f++,0,")");return f},expression:function(d,f,z){var A,e=this.operand(d);while(A=this.match(/^(or|and|!?=|[<>]=?|[|*+-]|div|mod)\s*/,this.operators)){if(z&&z[0]>=A[0]){this.i-=this.m[0].length;break}this.js.splice(d,0,A[1]);e++;this.js.splice(d+e++,0,A[2]);e+=this.expression(d+e,f,A)||this.error("Missing operand");this.js.splice(d+e++,0,A[3])}return e},operand:function(d){if(this.match(/^(-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)|"[^"]*"|'[^']*')\s*/,1)){this.js.splice(d,0,this.m[1]);return 1}var p;if(p=this.match(/^([a-z]+(?:-[a-z]+)*)\s*\(\s*/,this.functions)){var f=1,e;this.js.splice(d,0,p[1]);do{if(e){this.js.splice(d+f++,0,",")}f+=(e=this.expression(d+f,d+f))}while(e&&this.match(/^,\s*/));this.match(/^\)\s*/)||this.error("Missing (");if(p[0]){if(e){this.js.splice(d+f++,0,",")}this.js.splice(d+f++,0,p[0])}if(p[2]){this.js.splice(d+f++,0,p[2])}else{if(e>1){this.error("Function has arguments")}}f+=this.step(d,d+f);return f}if(this.match(/^\(\s*/)){var f=1;this.js.splice(d,0,"(");f+=this.expression(d+f,d+f);this.match(/^\)\s*/)||this.error("Missing )");this.js.splice(d+f++,")");return f}return this.step(d,d,0,"[n]")},operators:{"|":[1,"union(",",",")"],or:[1,"bool(",")||bool(",")"],and:[2,"bool(",")&&bool(",")"],"=":[3,"compare(eq,",",",")"],"!=":[3,"compare(ne,",",",")"],"<":[4,"compare(lt,",",",")"],">":[4,"compare(gt,",",",")"],"<=":[4,"compare(le,",",",")"],">=":[4,"compare(ge,",",",")"],"+":[5,"number(",")+number(",")"],"-":[5,"number(",")-number(",")"],"*":[6,"number(",")*number(",")"],div:[6,"number(",")/number(",")"],mod:[6,"number(",")%number(",")"]},functions:{last:[0,"nl.length"],position:[0,"(i+1)"],count:["nl","(",".length||0)"],id:["n","id(",")"],"local-name":["nl","localName(",")"],"namespace-uri":["nl","namespaceURI(",")"],name:["nl","qName(",")"],string:["n","string(",")"],concat:[0,"concat(",")"],"starts-with":[0,"startsWith(",")"],contains:[0,"contains(",")"],"substring-before":[0,"substringBefore(",")"],"substring-after":[0,"substringAfter(",")"],substring:[0,"substring(",")"],"string-length":["n","string(",").length"],"normalize-space":["n","normalizeSpace(",")"],translate:[0,"translate(",")"],"boolean":[0,"bool(",")"],not:[0,"!bool(",")"],"true":[0,"true "],"false":[0,"false "],number:["n","number(",")"],floor:[0,"Math.floor(number(","))"],ceiling:[0,"Math.ceil(number(","))"],round:[0,"Math.round(number(","))"],sum:[0,"sum(",")"]},predicate:function(d){var e=0;if(this.match(/^\[\s*/)){if(e=this.expression(d,d)){this.js.splice(d,0,"function(n,i,nl){with(XPath){var r=");e++;this.js.splice(d+e++,0,';return typeof r=="number"?Math.round(r)==i+1:bool(r)}},')}this.match(/^\]\s*/)||this.error("Missing ]")}return e},nodeTest:function(d,e){var f;if(f=this.match(/^([a-z]+(?:-[a-z]+)*)\(([^)]*)\)\s*/,this.nodeTypes)){return f.call(this,d,this.m[2])}if(this.match(/^\*\s*/)){return this.nodeTypes[e].call(this,d)}return this.nodeName(d)},nodeType:function(d,e){this.js.splice(d,0,"function(n){return n.nodeType==",e,"},");return 3},nodeTypes:{node:function(d){this.js.splice(d,0,"null,");return 1},element:function(d){return this.nodeType(d,1)},attribute:function(d){return this.nodeType(d,2)},text:function(d){return this.nodeType(d,3)},"processing-instruction":function(d,e){if(!e){return this.nodeType(d,7)}this.js.splice(d,0,"function(n){return n.nodeType==7&&n.target==",e,"},");return 3},comment:function(d){return this.nodeType(d,8)}},nodeName:function(d){if(!this.match(/^([a-zA-Z_]+(?:-?[a-zA-Z0-9]+)*)(?::([a-zA-Z_]+(?:-?[a-zA-Z0-9]+)*))?\s*/,1)){return 0}if(this.m[2]){this.js.splice(d,0,'function(n){if(!nsr)throw new XPathException(14);return "',this.m[2],'"==',u.ie?"n.baseName":"n.localName",'&&nsr.lookupNamespaceURI("',this.m[1],'")==n.namespaceURI},');return 7}else{this.js.splice(d,0,"function(n){return/^",this.m[1],"$/i.test(n.nodeName)},");return 3}}};u.order=function(e,f){var d=e.compareDocumentPosition?e.compareDocumentPosition(f):u.compareDocumentPosition.call(e,f);if(d&32){e=Array.prototype.indexOf.call(e.attributes,e);f=Array.prototype.indexOf.call(f.attributes,f);return(e<f)?-1:(e>f)?1:0}if(!d){if(e==f){return 0}if((e=e.ownerElement)&&(f=f.ownerElement)){return u.order(e,f)}return u.ie?1:0}return 3-((d&6)||3)};u.compare=function(z,e,A){if(e instanceof Array&&A instanceof Array){var d=e.map(this.string),f=A.map(this.string);for(e=d.length;--e>=0;){for(A=f.length;--A>=0;){if(!z(d[e],f[A])){return false}}}return true}if(e instanceof Array){for(var p=e.length;--p>=0;){if(!z(this[typeof A](e[p]),A)){return false}}return e.length>0}if(A instanceof Array){for(var p=A.length;--p>=0;){if(!z(e,this[typeof e](A[p]))){return false}}return A.length>0}if(typeof e=="boolean"||typeof A=="boolean"){return z(this.bool(e),this.bool(A))}if(typeof e=="number"||typeof A=="number"){return z(this.number(e),this.number(A))}return z(this.string(e),this.string(A))};u.eq=function(d,e){return d==e};u.ne=function(d,e){return d!=e};u.lt=function(d,e){return d<e};u.gt=function(d,e){return d>e};u.le=function(d,e){return d<=e};u.ge=function(d,e){return d>=e};u.id=function(f,r){if(arguments.length==1){r=f}var d=[];for(var p=this.string(f).split(/\s+/),e=p.length;--e>=0;){if(f=(r.ownerDocument||r).getElementById(p[e])){d.push(f)}}return d.sort(this.order)};u.localName=new Function("nl","return (nl.length&&nl[0]."+(u.ie?"baseName":"localName")+')||""');u.namespaceURI=function(d){return(d.length&&d[0].namespaceURI)||""};u.qName=function(d){return(d.length&&d[0].nodeName)||""};u.union=function(f,d){if(!f.length){return d}if(!d.length){return f}var e=[],r=f.length-1,p=d.length-1;for(;;){switch(this.order(f[r],d[p])){case -1:e.unshift(d[p--]);break;case 0:p--;case 1:e.unshift(f[r--]);break;default:throw new Error("Invalid order")}if(r<0){if(++p>0){e.unshift.apply(e,e.slice.call(d,0,p))}break}if(p<0){if(++r>0){e.unshift.apply(e,e.slice.call(f,0,r))}break}}return e};u.string=u.object=function(d){if(d instanceof Array&&typeof(d=d[0])=="undefined"){return""}if(typeof d=="string"){return d}switch(d.nodeType){case 1:case 9:case 11:return Array.prototype.map.call(d.childNodes,this.string,this).join("");default:return d.nodeValue||""}return String(d)};u.concat=function(){return Array.prototype.map.call(arguments,this.string,this).join("")};u.startsWith=function(e,d){return this.string(e).substr(0,(d=this.string(d)).length)==d};u.contains=function(e,d){return this.string(e).indexOf(this.string(d))!=-1};u.substringBefore=function(e,d){e=this.string(e);d=e.indexOf(this.string(d));return d!=-1?e.substr(0,d):""};u.substringAfter=function(e,d){e=this.string(e);d=this.string(d);var f=e.indexOf(d);return f!=-1?e.substr(f+d.length):""};u.substring=function(f,e,d){f=this.string(f);e=Math.round(this.number(e))-1;return(arguments.length==2)?f.substr(e<0?0:e):f.substr(e<0?0:e,Math.round(this.number(d))-Math.max(0,-e))};u.normalizeSpace=function(d){return this.string(d).replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ")};u.translate=function(p,e,B){p=this.string(p);e=this.string(e);B=this.string(B);var A=[],f=p.length,z=0,r,d;while(--f>=0){if((r=e.indexOf(d=p.charAt(z++)))==-1||(d=B.charAt(r))){A.push(d)}}return A.join("")};u.bool=u["boolean"]=function(d){if(typeof d=="boolean"){return d}if(d instanceof Array||typeof d=="string"){return d.length>0}return Boolean(d)};u.number=function(d){if(d instanceof Array&&typeof(d=d[0])=="undefined"){return 0}if(typeof d=="number"){return d}if(typeof d=="boolean"){return d?1:0}return Number(this.string(d))};u.sum=function(d){var f=0,e=d.length;while(--e>=0){f+=this.number(d[e])}return f};u.walk=function(p,e){var d,f=p.firstChild;while(f){e.push(f);if(d=f.firstChild){f=d}else{for(d=f;!(f=d.nextSibling)&&(d=d.parentNode)&&(d!=p);){}}}return e};u.axes={ancestor:function(e){var d=[];while(e=e.parentNode){d.unshift(e)}return d},"ancestor-or-self":function(e){var d=[];do{d.unshift(e)}while(e=e.parentNode);return d},attribute:new Function("n","var nl = [], a = n.attributes;if(a){attr:for(var x,i=a.length;--i>=0;){if(!(x=a[i]).specified){"+(u.ie?'switch(x.nodeName){case"selected":case"value":if(x.nodeValue)break;default:continue attr;}':"continue;")+"}nl.unshift(x);}}return nl;"),child:function(d){return d.childNodes||[]},descendant:function(d){return this.walk(d,[])},"descendant-or-self":function(d){return this.walk(d,[d])},following:function(f){var e=[],d;while(f){if(d=f.nextSibling){e.push(f=d);if(d=f.firstChild){e.push(f=d)}}else{f=f.parentNode}}return e},"following-sibling":function(e){var d=[];while(e=e.nextSibling){d.push(e)}return d},parent:function(d){return d.parentNode?[d.parentNode]:[]},preceding:function(r){var e=[],d,f=r.parentNode;while(r){if(d=r.previousSibling){for(r=d;d=r.lastChild;r=d){}e.unshift(r)}else{if(r=r.parentNode){if(r==f){f=f.parentNode}else{e.unshift(r)}}}}return e},"preceding-sibling":function(e){var d=[];while(e=e.previousSibling){d.unshift(e)}return d},self:function(d){return[d]},"document-root":function(d){return[d.ownerDocument||d]}};u.axis=function(D,C){var d,E,B=arguments.length-1,e=arguments[B],z=Array.prototype;for(var A=0,p,f=e.length;--f>=0;){E=D.call(this,e[A++]);if(C&&E.length){E=z.filter.call(E,C,this)}for(p=2;p<B&&E.length;E=z.filter.call(E,arguments[p++],this)){}d=d?this.union(d,E):E}return d||[]};u.cache={};function b(B){if(this==B){return 0}if(this.nodeType==2&&B.nodeType==2){return(this.ownerElement&&this.ownerElement==B.ownerElement)?32:0}var d=this.ownerElement||this,p=B.ownerElement||B;if(d.sourceIndex>=0&&p.sourceIndex>=0&&d.contains&&p.contains){return(((d.contains(p)&&16)||(p.contains(d)&&8))|((d.sourceIndex<p.sourceIndex&&4)||(p.sourceIndex<d.sourceIndex&&2)))||1}var z=d,A=p,e=0,f=0;while(z=z.parentNode){e++}while(A=A.parentNode){f++}if(e>f){while(e--!=f){d=d.parentNode}if(d==p){return 2|8}}else{if(f>e){while(f--!=e){p=p.parentNode}if(p==d){return 4|16}}}while((z=d.parentNode)!=(A=p.parentNode)){if(!(d=z)||!(p=A)){return 1}}while(d=d.nextSibling){if(d==p){return 4}}return 2}if(v.Node){var y=v.Node.prototype;if(m||!y.compareDocumentPosition){y.compareDocumentPosition=b}if(m||!y.contains){y.contains=function(d){return Boolean(this.compareDocumentPosition(d)&16)}}}else{u.compareDocumentPosition=b}if(m||!v.XPathException){function o(e,d){this.name="XPathException";this.code=e;this.message=d}var q=o,c=new Error;c.toString=function(){return this.name+":"+this.message};q.prototype=c;q.NAMESPACE_ERR=14;q.INVALID_EXPRESSION_ERR=51;q.TYPE_ERR=52;v.XPathException=q}if(m||!v.XPathNSResolver){function j(p){this.ns={};for(var d,e,f=p.attributes.length;--f>=0;){if(d=/xmlns:(.+)/.exec((e=p.attributes[f]).nodeName)){this.ns[d[1]]=e.nodeValue}}this.ns[""]=p.getAttribute("targetNamespace")}j.prototype={lookupNamespaceURI:function(d){return this.ns[d||""]}};v.XPathNSResolver=j}if(m||!v.XPathExpression){function x(f,d){this.fn=u.cache[f]||(u.cache[f]=new u(f));this.nsr=d}x.prototype={evaluate:function(e,d){return new g(this.fn(e,this.nsr),d)}};v.XPathExpression=x}if(m||!v.XPathResult){function g(e,d){if(d==0){switch(typeof e){default:d++;case"boolean":d++;case"string":d++;case"number":d++}}this.resultType=d;switch(d){case 1:this.numberValue=u.number(e);return;case 2:this.stringValue=u.string(e);return;case 3:this.booleanValue=u.bool(e);return;case 4:case 5:if(e instanceof Array){this.value=e;this.index=0;this.invalidIteratorState=false;return}break;case 6:case 7:if(e instanceof Array){this.value=e;this.snapshotLength=e.length;return}break;case 8:case 9:if(e instanceof Array){this.singleNodeValue=e[0];return}}throw new o(52)}var a=g;a.ANY_TYPE=0;a.NUMBER_TYPE=1;a.STRING_TYPE=2;a.BOOLEAN_TYPE=3;a.UNORDERED_NODE_ITERATOR_TYPE=4;a.ORDERED_NODE_ITERATOR_TYPE=5;a.UNORDERED_NODE_SNAPSHOT_TYPE=6;a.ORDERED_NODE_SNAPSHOT_TYPE=7;a.ANY_UNORDERED_NODE_TYPE=8;a.FIRST_ORDERED_NODE_TYPE=9;a.prototype={iterateNext:function(){switch(this.resultType){case 4:case 5:return this.value[this.index++]}throw new o(52)},snapshotItem:function(d){switch(this.resultType){case 6:case 7:return this.value[d]}throw new o(52)}};v.XPathResult=a}if(m||!v.XPathEvaluator){function n(){}var q=n;q.prototype={createExpression:function(f,d){return new x(f,d)},createNSResolver:function(d){return new j(d)},evaluate:function(p,r,f,d){return new x(p,f).evaluate(r,d)}};q.install=function(p,e){for(var d in n.prototype){if(e||!p[d]){p[d]=n.prototype[d]}}};v.XPathEvaluator=q;if(v.Document){q.install(v.Document.prototype,m)}else{q.install(document,m)}v.XPath=u}})(window,document,/WebKit/.test(navigator.userAgent));arrDiff=function(u,s,b){if(!u.length){u.push("");s.push("");var a=1}var r=[],q=-1,o,n,g,f;for(n=s.length,f=u.length;n--;){for(g=f;g&&(o=s[n]!==u[--g]);){}o&&(r[++q]=b?n:s[n])}if(a){u.pop();s.pop()}return r};Date.prototype.format=function(c,g){var n=this,e,b=function(d,a){return(d=d+"").length<a?new Array(++a-d.length).join("0")+d:d};var g=g||{},j={j:function(){return n.getDate()},w:function(){return n.getDay()},y:function(){return(n.getFullYear()+"").slice(2)},Y:function(){return n.getFullYear()},n:function(){return n.getMonth()+1},m:function(){return b(j.n(),2)},g:function(){return n.getHours()%12||12},G:function(){return n.getHours()},H:function(){return b(n.getHours(),2)},h:function(){return b(j.g(),2)},d:function(){return b(j.j(),2)},N:function(){return j.w()+1},i:function(){return b(n.getMinutes(),2)},s:function(){return b(n.getSeconds(),2)},ms:function(){return b(n.getMilliseconds(),3)},a:function(){return n.getHours()>11?"pm":"am"},A:function(){return j.a().toUpperCase()},O:function(){return n.getTimezoneOffset()/60},z:function(){return(n-new Date(n.getFullYear()+"/1/1"))/86400000>>0},L:function(){var a=j.Y();return(!(a&3)&&(a%100||!(a%400)))?1:0},t:function(){var a;return(a=n.getMonth()+1)==2?28+j.L():a&1&&a<8||!(a&1)&&a>7?31:30},W:function(){var f=j.z(),d=364+j.L()-f,m=(new Date(n.getFullYear()+"/1/1").getDay()||7)-1;return(d<=2&&((n.getDay()||7)-1)<=2-d)?1:(f<=2&&m>=4&&f>=(6-m))?new Date(n.getFullYear()-1+"/12/31").format("%W%"):(1+(m<=3?((f+m)/7):(f-(7-m))/7)>>0)}};return String(c).replace(/%(.*?)%/g,function(a,d){return g[d]?g[d](n,function(f){return j[f]&&j[f]()}):j[d]?j[d]():"%"+(d&&d+"%")})};Date.ISO8601="%Y%-%m%-%d%T%H%:%i%:%s%%O%";Date.ISO8601c="%Y%%m%%d%T%H%:%i%:%s%%O%";Date.prototype.setISO8601=function(b){var c="(^[0-9]{4})(-?([0-9]{2})(-?([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";var f=b.match(new RegExp(c));var e=0;var a=new Date(f[1],0,1);if(f[3]){a.setMonth(f[3]-1)}if(f[5]){a.setDate(f[5])}if(f[7]){a.setHours(f[7])}if(f[8]){a.setMinutes(f[8])}if(f[10]){a.setSeconds(f[10])}if(f[12]){a.setMilliseconds(Number("0."+f[12])*1000)}if(f[14]){e=(Number(f[16])*60)+Number(f[17]);e*=((f[15]=="-")?1:-1)}e-=a.getTimezoneOffset();time=(Number(a)+(e*60*1000));this.setTime(Number(time))};
/*
 * jQuery JSON Plugin
 * version: 1.0 (2008-04-17)
 *
 * This document is licensed as free software under the terms of the
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 *
 * Brantley Harris technically wrote this plugin, but it is based somewhat
 * on the JSON.org website's http://www.json.org/json2.js, which proclaims:
 * "NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.", a sentiment that
 * I uphold.  I really just cleaned it up.
 *
 * It is also based heavily on MochiKit's serializeJSON, which is 
 * copywrited 2005 by Bob Ippolito.
 */
(function($){function toIntegersAtLease(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(date){return this.getUTCFullYear()+"-"+toIntegersAtLease(this.getUTCMonth())+"-"+toIntegersAtLease(this.getUTCDate())};var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};$.quoteString=function(string){if(escapeable.test(string)){return'"'+string.replace(escapeable,function(a){var c=meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};$.toJSON=function(o,compact){var type=typeof(o);if(type=="undefined"){return"undefined"}else{if(type=="number"||type=="boolean"){return o+""}else{if(o===null){return"null"}}}if(type=="string"){return $.quoteString(o)}if(type=="object"&&typeof o.toJSON=="function"){return o.toJSON(compact)}if(type!="function"&&typeof(o.length)=="number"){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i],compact))}if(compact){return"["+ret.join(",")+"]"}else{return"["+ret.join(", ")+"]"}}if(type=="function"){throw new TypeError("Unable to convert object of type 'function' to json.")}ret=[];for(var k in o){var name;var type=typeof(k);if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}val=$.toJSON(o[k],compact);if(typeof(val)!="string"){continue}if(compact){ret.push(name+":"+val)}else{ret.push(name+": "+val)}}return"{"+ret.join(", ")+"}"};$.compactJSON=function(o){return $.toJSON(o,true)};$.evalJSON=function(src){return eval("("+src+")")};$.secureEvalJSON=function(src){var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}}})(jQuery);
/* jQuery getScroll plugin using tips from http://www.quirksmode.org  */
jQuery.getScroll=function(a){if(a){t=a.scrollTop;l=a.scrollLeft;w=a.scrollWidth;h=a.scrollHeight}else{if(document.documentElement&&document.documentElement.scrollTop){t=document.documentElement.scrollTop;l=document.documentElement.scrollLeft;w=document.documentElement.scrollWidth;h=document.documentElement.scrollHeight}else{if(document.body){t=document.body.scrollTop;l=document.body.scrollLeft;w=document.body.scrollWidth;h=document.body.scrollHeight}}}return{t:t,l:l,w:w,h:h}};(function(b){b.escapeReturns=function(d){d=escape(d);for(i=0;i<d.length;i++){if(d.indexOf("%0D%0A")>-1){d=d.replace("%0D%0A","<br/>")}else{if(d.indexOf("%0A")>-1){d=d.replace("%0A","<br/>")}else{if(d.indexOf("%0D")>-1){d=d.replace("%0D","<br/>")}}}}d=unescape(d);return d};var a=/["\\\x00-\x1f\x7f-\x9f]/g;var c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.escapeString=function(d){if(a.test(d)){return d.replace(a,function(e){var f=c[e];if(typeof f==="string"){return f}f=e.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})}return d}})(jQuery);(function(a){a.fixOperaRangeSelectionBug=function(){function b(m){if(m.nodeType!=3){return false}var j=/\u00A0/;return m.nodeValue.match(j)}var f=document.body.getElementsByTagName("br");for(var g=0;g<f.length;g++){var d=f[g];var c=d.previousSibling;if(c!=null){var e=b(c);if(!e){d.parentNode.insertBefore(document.createTextNode("\u00A0"),d)}}}}})(jQuery);if(jQuery&&jQuery.browser.opera&&jQuery.browser.version>=9.5){var height_=jQuery.fn.height;jQuery.fn.height=function(){if(this[0]==window){return window.innerHeight}else{return height_.apply(this,arguments)}};var width_=jQuery.fn.width;jQuery.fn.width=function(){if(this[0]==window){return window.innerWidth}else{return width_.apply(this,arguments)}}}jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,f,a,j,g){return jQuery.easing[jQuery.easing.def](e,f,a,j,g)},easeInQuad:function(e,f,a,j,g){return j*(f/=g)*f+a},easeOutQuad:function(e,f,a,j,g){return -j*(f/=g)*(f-2)+a},easeInOutQuad:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f+a}return -j/2*((--f)*(f-2)-1)+a},easeInCubic:function(e,f,a,j,g){return j*(f/=g)*f*f+a},easeOutCubic:function(e,f,a,j,g){return j*((f=f/g-1)*f*f+1)+a},easeInOutCubic:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f*f+a}return j/2*((f-=2)*f*f+2)+a},easeInQuart:function(e,f,a,j,g){return j*(f/=g)*f*f*f+a},easeOutQuart:function(e,f,a,j,g){return -j*((f=f/g-1)*f*f*f-1)+a},easeInOutQuart:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f*f*f+a}return -j/2*((f-=2)*f*f*f-2)+a},easeInQuint:function(e,f,a,j,g){return j*(f/=g)*f*f*f*f+a},easeOutQuint:function(e,f,a,j,g){return j*((f=f/g-1)*f*f*f*f+1)+a},easeInOutQuint:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f*f*f*f+a}return j/2*((f-=2)*f*f*f*f+2)+a},easeInSine:function(e,f,a,j,g){return -j*Math.cos(f/g*(Math.PI/2))+j+a},easeOutSine:function(e,f,a,j,g){return j*Math.sin(f/g*(Math.PI/2))+a},easeInOutSine:function(e,f,a,j,g){return -j/2*(Math.cos(Math.PI*f/g)-1)+a},easeInExpo:function(e,f,a,j,g){return(f==0)?a:j*Math.pow(2,10*(f/g-1))+a},easeOutExpo:function(e,f,a,j,g){return(f==g)?a+j:j*(-Math.pow(2,-10*f/g)+1)+a},easeInOutExpo:function(e,f,a,j,g){if(f==0){return a}if(f==g){return a+j}if((f/=g/2)<1){return j/2*Math.pow(2,10*(f-1))+a}return j/2*(-Math.pow(2,-10*--f)+2)+a},easeInCirc:function(e,f,a,j,g){return -j*(Math.sqrt(1-(f/=g)*f)-1)+a},easeOutCirc:function(e,f,a,j,g){return j*Math.sqrt(1-(f=f/g-1)*f)+a},easeInOutCirc:function(e,f,a,j,g){if((f/=g/2)<1){return -j/2*(Math.sqrt(1-f*f)-1)+a}return j/2*(Math.sqrt(1-(f-=2)*f)+1)+a},easeInElastic:function(f,j,e,q,o){var m=1.70158;var n=0;var g=q;if(j==0){return e}if((j/=o)==1){return e+q}if(!n){n=o*0.3}if(g<Math.abs(q)){g=q;var m=n/4}else{var m=n/(2*Math.PI)*Math.asin(q/g)}return -(g*Math.pow(2,10*(j-=1))*Math.sin((j*o-m)*(2*Math.PI)/n))+e},easeOutElastic:function(f,j,e,q,o){var m=1.70158;var n=0;var g=q;if(j==0){return e}if((j/=o)==1){return e+q}if(!n){n=o*0.3}if(g<Math.abs(q)){g=q;var m=n/4}else{var m=n/(2*Math.PI)*Math.asin(q/g)}return g*Math.pow(2,-10*j)*Math.sin((j*o-m)*(2*Math.PI)/n)+q+e},easeInOutElastic:function(f,j,e,q,o){var m=1.70158;var n=0;var g=q;if(j==0){return e}if((j/=o/2)==2){return e+q}if(!n){n=o*(0.3*1.5)}if(g<Math.abs(q)){g=q;var m=n/4}else{var m=n/(2*Math.PI)*Math.asin(q/g)}if(j<1){return -0.5*(g*Math.pow(2,10*(j-=1))*Math.sin((j*o-m)*(2*Math.PI)/n))+e}return g*Math.pow(2,-10*(j-=1))*Math.sin((j*o-m)*(2*Math.PI)/n)*0.5+q+e},easeInBack:function(e,f,a,m,j,g){if(g==undefined){g=1.70158}return m*(f/=j)*f*((g+1)*f-g)+a},easeOutBack:function(e,f,a,m,j,g){if(g==undefined){g=1.70158}return m*((f=f/j-1)*f*((g+1)*f+g)+1)+a},easeInOutBack:function(e,f,a,m,j,g){if(g==undefined){g=1.70158}if((f/=j/2)<1){return m/2*(f*f*(((g*=(1.525))+1)*f-g))+a}return m/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+a},easeInBounce:function(e,f,a,j,g){return j-jQuery.easing.easeOutBounce(e,g-f,0,j,g)+a},easeOutBounce:function(e,f,a,j,g){if((f/=g)<(1/2.75)){return j*(7.5625*f*f)+a}else{if(f<(2/2.75)){return j*(7.5625*(f-=(1.5/2.75))*f+0.75)+a}else{if(f<(2.5/2.75)){return j*(7.5625*(f-=(2.25/2.75))*f+0.9375)+a}else{return j*(7.5625*(f-=(2.625/2.75))*f+0.984375)+a}}}},easeInOutBounce:function(e,f,a,j,g){if(f<g/2){return jQuery.easing.easeInBounce(e,f*2,0,j,g)*0.5+a}return jQuery.easing.easeOutBounce(e,f*2-g,0,j,g)*0.5+j*0.5+a}});jQuery.extend(jQuery.easing,{easeIn:function(e,f,a,j,g){return jQuery.easing.easeInQuad(e,f,a,j,g)},easeOut:function(e,f,a,j,g){return jQuery.easing.easeOutQuad(e,f,a,j,g)},easeInOut:function(e,f,a,j,g){return jQuery.easing.easeInOutQuad(e,f,a,j,g)},expoin:function(e,f,a,j,g){return jQuery.easing.easeInExpo(e,f,a,j,g)},expoout:function(e,f,a,j,g){return jQuery.easing.easeOutExpo(e,f,a,j,g)},expoinout:function(e,f,a,j,g){return jQuery.easing.easeInOutExpo(e,f,a,j,g)},bouncein:function(e,f,a,j,g){return jQuery.easing.easeInBounce(e,f,a,j,g)},bounceout:function(e,f,a,j,g){return jQuery.easing.easeOutBounce(e,f,a,j,g)},bounceinout:function(e,f,a,j,g){return jQuery.easing.easeInOutBounce(e,f,a,j,g)},elasin:function(e,f,a,j,g){return jQuery.easing.easeInElastic(e,f,a,j,g)},elasout:function(e,f,a,j,g){return jQuery.easing.easeOutElastic(e,f,a,j,g)},elasinout:function(e,f,a,j,g){return jQuery.easing.easeInOutElastic(e,f,a,j,g)},backin:function(e,f,a,j,g){return jQuery.easing.easeInBack(e,f,a,j,g)},backout:function(e,f,a,j,g){return jQuery.easing.easeOutBack(e,f,a,j,g)},backinout:function(e,f,a,j,g){return jQuery.easing.easeInOutBack(e,f,a,j,g)}});(function(a){a.fn.cleanWhitespace=function(m){var d=this[0];if(a(d).hasClass("keep-whitespace")){return d}var b=d.firstChild;var e=new RegExp("^"+String.fromCharCode(32)+"*","m");var j=new RegExp("$"+String.fromCharCode(32)+"*","m");var n=new RegExp(String.fromCharCode(32)+"{2,}","gm");var f=new RegExp(String.fromCharCode(160),"gm");while(b){var c=b.nextSibling;if(b.nodeType==3){if(!/\S/.test(b.nodeValue)&&!f.test(b.nodeValue)){d.removeChild(b)}else{var g=b.nodeValue;g=g.replace(/[\t\n\r\f]/gm,"");g=g.replace(n,String.fromCharCode(160));g=g.replace(e,String.fromCharCode(160));g=g.replace(j,String.fromCharCode(160));b.nodeValue=g}}else{if(m&&b.nodeType==1){a(b).cleanWhitespace(m)}}b=c}return d}})(jQuery);(function(a){a.fn.textNodes=function(b){var c=[];this.each(function(){var e=this.childNodes;for(var d=0;d<e.length;d++){var f=e[d];if(f.nodeType==3){c.push(f)}else{if(b&&f.nodeType==1){Array.prototype.push.apply(c,jQuery(f).textNodes(b,true))}}}});return arguments[1]?c:this.pushStack(c)}})(jQuery);(function(a){a.getSelectedText=function(){if(window.getSelection){var b=window.getSelection();return b.toString()}else{if(document.selection){var b=document.selection,c=b.createRange();return c.text}}};a.getSelection=function(B){if(window.getSelection){var p=window.getSelection();if(p.getRangeAt){var j=p.getRangeAt(0)}else{var j=document.createRange();j.setStart(p.anchorNode,p.anchorOffset);j.setEnd(p.focusNode,p.focusOffset)}x=j.cloneRange(),s=j.cloneRange();x.collapse(true);s.collapse(false);var C=x.startContainer,H=s.endContainer,u=x.startOffset,d=s.endOffset,q=p.toString();if(H.nodeType==1){var g=H.childNodes;var m=g[d];if(m.tagName.toLowerCase()=="br"){m=m.previousSibling;if(m.nodeType==1){m=a(m).textNodes(true);H=m[m.length-1];d=H.length-1}}}if(B){p.removeAllRanges()}}else{if(document.selection){try{var p=document.selection,j=p.createRange();var q=j.text;if(q.length==0){return null}var x=j.duplicate(),s=j.duplicate();x.collapse(true);s.collapse(false);var D=x.parentElement();var e=s.parentElement();var f=document.body.createTextRange(),y=f.text.length;f.moveToElementText(D);f.collapse(true);var u=0;while(j.compareEndPoints("StartToStart",f)!=0&&u<y){u++;f.move("character")}f.moveToElementText(e);y=f.text.length;f.collapse(true);var d=0;while(j.compareEndPoints("EndToEnd",f)!=0&&d<y){d++;f.move("character")}var z=a(D).textNodes(true),C;if(z.length==1){C=z[0]}else{var G=0,n=0,b=0;while(n<=u){b=n;n+=z[G].length;G++}u-=b;C=z[--G]}var F=a(e).textNodes(true),H;if(F.length==1){H=F[0]}else{var A=0,n=0,b=0;while(n<=d&&A<F.length){b=n;n+=F[A].length;A++}d-=b;H=F[--A]}d=Math.min(d,H.length);if(B){p.empty()}}catch(c){if(eMend.log){c.funct="$.getSelection";eMend.log.add("warning",c)}}}}if(C!=H||u!=d){var E={startContainer:C,endContainer:H,startOffset:u,endOffset:d,text:q};return E}else{return null}}})(jQuery);(function(a){a.create=function(){var c=[],b=arguments,d,f;b=b[0].constructor==Array?b[0]:b;for(d=0;d<b.length;d++){if(b[d+1]&&b[d+1].constructor==Object){f=document.createElement(b[d]);a(f).attr(b[++d]);if(b[d+1]&&b[d+1].constructor==Array){a(f).append(a.create(b[++d]))}c.push(f)}else{c.push(document.createTextNode(b[d]))}}return c};a.tpl=function(d,c){var b=[];jQuery.each(d.constructor==Array?d:[d],function(){var f=a.create(c.apply(this));for(var e=0;e<f.length;e++){b.push(f[e])}});return b}})(jQuery);(function($){$.template=function(html,options){return new $.template.instance(html,options)};$.template.instance=function(html,options){if(options&&options.regx){options.regx=this.regx[options.regx]}this.options=$.extend({compile:false,regx:this.regx.standard},options||{});this.html=html;if(this.options.compile){this.compile()}this.isTemplate=true};$.template.regx=$.template.instance.prototype.regx={jsp:/\$\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,ext:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,jtemplates:/\{\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}\}/g};$.extend($.template.regx,{gettext:/\_\(([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\)/g});$.template.regx.standard=$.template.regx.jsp;$.template.helpers=$.template.instance.prototype.helpers={substr:function(value,start,length){return String(value).substr(start,length)}};$.extend($.template.instance.prototype,{apply:function(values){if(this.options.compile){return this.compiled(values)}else{var tpl=this;var fm=this.helpers;var fn=function(m,name,format,args){if(format){if(format.substr(0,5)=="this."){return tpl.call(format.substr(5),values[name],values)}else{if(args){var re=/^\s*['"](.*)["']\s*$/;args=args.split(",");for(var i=0,len=args.length;i<len;i++){args[i]=args[i].replace(re,"$1")}args=[values[name]].concat(args)}else{args=[values[name]]}return fm[format].apply(fm,args)}}else{return values[name]!==undefined?values[name]:""}};return this.html.replace(this.options.regx,fn)}},compile:function(){var sep=$.browser.mozilla?"+":",";var fm=this.helpers;var fn=function(m,name,format,args){if(format){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="(values['"+name+"'] == undefined ? '' : "}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"};var body;if($.browser.mozilla){body="this.compiled = function(values){ return '"+this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn)+"';};"}else{body=["this.compiled = function(values){ return ['"];body.push(this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn));body.push("'].join('');};");body=body.join("")}eval(body);return this}});var $_old={domManip:$.fn.domManip,text:$.fn.text,html:$.fn.html};$.fn.domManip=function(args,table,reverse,callback){if(args[0].isTemplate){args[0]=args[0].apply(args[1]);delete args[1]}var r=$_old.domManip.apply(this,arguments);return r};$.fn.html=function(value,o){if(value&&value.isTemplate){var value=value.apply(o)}var r=$_old.html.apply(this,[value]);return r};$.fn.text=function(value,o){if(value&&value.isTemplate){var value=value.apply(o)}var r=$_old.text.apply(this,[value]);return r}})(jQuery);(function(a){a.fn.generateXPath=function(c){a.fn.generateXPath.defaults={depth:0,maxDepth:99,context:document.body,namespace:null,kwds:{showId:1}};var e=a.extend({},a.fn.generateXPath.defaults,c);return b(this[0],e.depth,e.maxDepth,e.context,e.namespace,e.kwds);function b(m,p,g,f,n,j){var s="";if(!m){return""}if(m==f){return"."}if((m.parentNode)&&(p<g)){s+=b(m.parentNode,p+1,g,f,n,j)}switch(m.nodeType){case 1:var q=m.nodeName;var v=[];var u=false;if(j.showClass&&a(m).attr("class")){v.push("@class='"+m.getAttribute("class")+"'")}if(j.showId&&a(m).attr("id")){v.push("@id='"+m.getAttribute("id")+"'");u=true}if(!u){var r=d(m);if(r){if(v.length>0){v.push("position()="+r)}else{v.push(r)}}}if(j.showNS){if(m.prefix){q=m.prefix+":"+q}else{if(n){q="default:"+q}}}if(j.toLowercase){q=q.toLowerCase()}s+="/"+q;if(v.length>0){s+="[";for(var o=0;o<v.length;o++){if(o>0){s+=" and "}s+=v[o]}s+="]"}break;case 9:break;case 3:s+="/text()";var r=d(m);if(r){s+="["+r+"]"}break}return s}function d(g){var p=g.parentNode.childNodes;var o=0;var f;if(g.nodeType==1){var j=g.nodeName;for(var m=0;m<p.length;m++){var n=p.item(m);if(n.nodeType==1){if(n.nodeName==j){o++}if(n==g){f=o}}}}else{if(g.nodeType==3){for(var m=0;m<p.length;m++){var n=p.item(m);if(n.nodeType==3){o++;if(n==g){f=o}}}}}if(o>1){return f}}}})(jQuery);(function(a){a.fn.wresize=function(c){version="1.1";wresize={fired:false,width:0};function b(){if(a.browser.msie){if(!wresize.fired){wresize.fired=true}else{var e=parseInt(a.browser.version,10);wresize.fired=false;if(e<7){return false}else{if(e==7){var f=a(window).width();if(f!=wresize.width){wresize.width=f;return false}}}}}return true}function d(f){if(b()){return c.apply(this,[f])}}this.each(function(){if(this==window){a(this).resize(d)}else{a(this).resize(c)}});return this}})(jQuery);(function(a){a.textResizeDetector=function(b){this.opts=a.extend({},a.textResizeDetector.defaults,b);this.initialize()};a.textResizeDetector.defaults={};a.textResizeDetector.prototype={id:"ResizeDetector",delay:800,create:function(){a("#"+this.id+"_text").remove();var d="position: absolute; padding: 0; left: -9999px; font-size:"+30+"px; line-height:"+30+"px;";var f="position: absolute; left: -9999px; width:10%; height:10%;";var b=a.create("span",{id:this.id+"_text",style:d,className:"write-protect"})[0];b.innerHTML="&nbsp;";var e=this.opts.target;e.appendChild(b);this.sizeT=30;return b},initialize:function(){this.create();this.check=window.setInterval(this.detect,this.delay)},detect:function(){var c=a("#ResizeDetector_text");if(!c.length){c=this.create()}var b=c.height();if(b!=this.sizeT){var d=30/b;a(document).trigger("textResize",d);this.sizeT=b;a(".fixedFontSize9").each(function(e){var g=Math.max(9*d,1);a(this).css({fontSize:g+"px",lineHeight:g+"px"})});a(".fixedFontSize11").each(function(e){var g=Math.max(11*d,1);a(this).css({fontSize:g+"px",lineHeight:g+"px"})});a(".fixedFontSize12").each(function(e){var g=Math.max(12*d,1);a(this).css({fontSize:g+"px",lineHeight:g+"px"})})}}}})(jQuery);(function(c){var a=c.scrollTo=function(f,e,d){c(window).scrollTo(f,e,d)};a.defaults={axis:"y",duration:1};a.window=function(d){return c(window).scrollable()};c.fn.scrollable=function(){return this.map(function(){var g=this.parentWindow||this.defaultView,e=this.nodeName=="#document"?g.frameElement||g:this,f=e.contentDocument||(e.contentWindow||e).document,d=e.setInterval;return e.nodeName=="IFRAME"||d&&c.browser.safari?f.body:d?f.documentElement:this})};c.fn.scrollTo=function(f,e,d){if(typeof e=="object"){d=e;e=0}if(typeof d=="function"){d={onAfter:d}}d=c.extend({},a.defaults,d);e=e||d.speed||d.duration;d.queue=d.queue&&d.axis.length>1;if(d.queue){e/=2}d.offset=b(d.offset);d.over=b(d.over);return this.scrollable().each(function(){var q=this,o=c(q),p=f,n,j={},r=o.is("html,body");switch(typeof p){case"number":case"string":if(/^([+-]=)?\d+(px)?$/.test(p)){p=b(p);break}p=c(p,this);case"object":if(p.is||p.style){n=(p=c(p)).offset()}}c.each(d.axis.split(""),function(x,y){var z=y=="x"?"Left":"Top",B=z.toLowerCase(),v="scroll"+z,s=q[v],u=y=="x"?"Width":"Height",A=u.toLowerCase();if(n){j[v]=n[B]+(r?0:s-o.offset()[B]);if(d.margin){j[v]-=parseInt(p.css("margin"+z))||0;j[v]-=parseInt(p.css("border"+z+"Width"))||0}j[v]+=d.offset[B]||0;if(d.over[B]){j[v]+=p[A]()*d.over[B]}}else{j[v]=p[B]}if(/^\d+$/.test(j[v])){j[v]=j[v]<=0?0:Math.min(j[v],g(u))}if(!x&&d.queue){if(s!=j[v]){m(d.onAfterFirst)}delete j[v]}});m(d.onAfter);function m(s){o.animate(j,e,d.easing,s&&function(){s.call(this,f,d)})}function g(u){var s="scroll"+u,v=q.ownerDocument;return r?Math.max(v.documentElement[s],v.body[s]):q[s]}}).end()};function b(d){return typeof d=="object"?d:{top:d,left:d}}})(jQuery);(function(d){d.fn.jqm=function(f){var e={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:r,ajaxText:"",target:r,modal:r,toTop:r,onShow:r,onHide:r,onLoad:r};return this.each(function(){if(this._jqm){return q[this._jqm].c=d.extend({},q[this._jqm].c,f)}u++;this._jqm=u;q[u]={c:d.extend(e,d.jqm.params,f),a:r,w:d(this).addClass("jqmID"+u),s:u};if(e.trigger){d(this).jqmAddTrigger(e.trigger)}})};d.fn.jqmAddClose=function(f){return p(this,f,"jqmHide")};d.fn.jqmAddTrigger=function(f){return p(this,f,"jqmShow")};d.fn.jqmShow=function(e){return this.each(function(){d.jqm.open(this._jqm,e)})};d.fn.jqmHide=function(e){return this.each(function(){d.jqm.close(this._jqm,e)})};d.jqm={hash:{},open:function(E,D){var v=q[E],x=v.c,m="."+x.closeClass,A=(parseInt(v.w.css("z-index"))),A=(A>0)?A:3000,f=d("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":A-1,opacity:x.overlay/100});if(v.a){return r}v.t=D;v.a=true;v.w.css("z-index",A);if(x.modal){if(!a[0]){o("bind")}a.push(E)}else{if(x.overlay>0){v.w.jqmAddClose(f)}else{f=r}}v.o=(f)?f.addClass(x.overlayClass).prependTo("body"):r;if(c){d("html,body").css({height:"100%",width:"100%"});if(f){f=f.css({position:"absolute"})[0];for(var B in {Top:1,Left:1}){f.style.setExpression(B.toLowerCase(),"(_=(document.documentElement.scroll"+B+" || document.body.scroll"+B+"))+'px'")}}}if(x.ajax){var e=x.target||v.w,C=x.ajax,e=(typeof e=="string")?d(e,v.w):d(e),C=(C.substr(0,1)=="@")?d(D).attr(C.substring(1)):C;e.html(x.ajaxText).load(C,function(){if(x.onLoad){x.onLoad.call(this,v)}if(m){v.w.jqmAddClose(d(m,v.w))}n(v)})}else{if(m){v.w.jqmAddClose(d(m,v.w))}}if(x.toTop&&v.o){v.w.before('<span id="jqmP'+v.w[0]._jqm+'"></span>').insertAfter(v.o)}(x.onShow)?x.onShow(v):v.w.show();n(v);return r},close:function(f){var e=q[f];if(!e.a){return r}e.a=r;if(a[0]){a.pop();if(!a[0]){o("unbind")}}if(e.c.toTop&&e.o){d("#jqmP"+e.w[0]._jqm).after(e.w).remove()}if(e.c.onHide){e.c.onHide(e)}else{e.w.hide();if(e.o){e.o.remove()}}return r},params:{}};var u=0,q=d.jqm.hash,a=[],c=d.browser.msie&&(d.browser.version=="6.0"),r=false,g=d('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),n=function(e){if(c){if(e.o){e.o.html('<p style="width:100%;height:100%"/>').prepend(g)}else{if(!d("iframe.jqm",e.w)[0]){e.w.prepend(g)}}}j(e)},j=function(f){try{d(":input:visible",f.w)[0].focus()}catch(e){}},o=function(e){d()[e]("keypress",b)[e]("keydown",b)[e]("mousedown",b)},b=function(s){var f=q[a[a.length-1]],m=(!d(s.target).parents(".jqmID"+f.s)[0]);if(m){j(f)}return !m},p=function(e,f,m){return e.each(function(){var v=this._jqm;d(f).each(function(){if(!this[m]){this[m]=[];d(this).click(function(){for(var x in {jqmShow:1,jqmHide:1}){for(var y in this[x]){if(q[this[x][y]]){q[this[x][y]].w[x](this)}}}return r})}this[m].push(v)})})}})(jQuery);(function(a){a.jGrowl=function(b,c){if(a("#jGrowl").size()==0){a('<div id="jGrowl"></div>').addClass(a.jGrowl.defaults.position).appendTo("body")}a("#jGrowl").jGrowl(b,c)};a.fn.jGrowl=function(b,d){if(a.isFunction(this.each)){var c=arguments;return this.each(function(){var e=this;if(a(this).data("jGrowl.instance")==undefined){a(this).data("jGrowl.instance",new a.fn.jGrowl());a(this).data("jGrowl.instance").startup(this)}if(a.isFunction(a(this).data("jGrowl.instance")[b])){a(this).data("jGrowl.instance")[b].apply(a(this).data("jGrowl.instance"),a.makeArray(c).slice(1))}else{a(this).data("jGrowl.instance").create(b,d)}})}};a.extend(a.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:false,position:"top-right",glue:"after",theme:"default",corners:"10px",check:250,life:3000,speed:"normal",easing:"swing",closer:true,closeTemplate:"&times;",closerTemplate:"<div>[ close all ]</div>",log:function(c,b,d){},beforeOpen:function(c,b,d){},open:function(c,b,d){},beforeClose:function(c,b,d){},close:function(c,b,d){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(b,c){var c=a.extend({},this.defaults,c);this.notifications[this.notifications.length]={message:b,options:c};c.log.apply(this.element,[this.element,b,c])},render:function(d){var b=this;var c=d.message;var e=d.options;var d=a('<div class="jGrowl-notification'+((e.group!=undefined&&e.group!="")?" "+e.group:"")+'"><div class="close">'+e.closeTemplate+'</div><div class="header">'+e.header+'</div><div class="message">'+c+"</div></div>").data("jGrowl",e).addClass(e.theme).children("div.close").bind("click.jGrowl",function(){a(this).parent().trigger("jGrowl.close")}).parent();(e.glue=="after")?a("div.jGrowl-notification:last",this.element).after(d):a("div.jGrowl-notification:first",this.element).before(d);a(d).bind("mouseover.jGrowl",function(){a(this).data("jGrowl").pause=true}).bind("mouseout.jGrowl",function(){a(this).data("jGrowl").pause=false}).bind("jGrowl.beforeOpen",function(){e.beforeOpen.apply(b.element,[b.element,c,e])}).bind("jGrowl.open",function(){e.open.apply(b.element,[b.element,c,e])}).bind("jGrowl.beforeClose",function(){e.beforeClose.apply(b.element,[b.element,c,e])}).bind("jGrowl.close",function(){a(this).trigger("jGrowl.beforeClose").animate(e.animateClose,e.speed,e.easing,function(){a(this).remove();e.close.apply(b.element,[b.element,c,e])})}).trigger("jGrowl.beforeOpen").animate(e.animateOpen,e.speed,e.easing,function(){a(this).data("jGrowl").created=new Date()}).trigger("jGrowl.open");if(a.fn.corner!=undefined){a(d).corner(e.corners)}if(a("div.jGrowl-notification:parent",this.element).size()>1&&a("div.jGrowl-closer",this.element).size()==0&&this.defaults.closer!=false){a(this.defaults.closerTemplate).addClass("jGrowl-closer").addClass(this.defaults.theme).appendTo(this.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){a(this).siblings().children("div.close").trigger("click.jGrowl");if(a.isFunction(b.defaults.closer)){b.defaults.closer.apply(a(this).parent()[0],[a(this).parent()[0]])}})}},update:function(){a(this.element).find("div.jGrowl-notification:parent").each(function(){if(a(this).data("jGrowl")!=undefined&&a(this).data("jGrowl").created!=undefined&&(a(this).data("jGrowl").created.getTime()+a(this).data("jGrowl").life)<(new Date()).getTime()&&a(this).data("jGrowl").sticky!=true&&(a(this).data("jGrowl").pause==undefined||a(this).data("jGrowl").pause!=true)){a(this).trigger("jGrowl.close")}});if(this.notifications.length>0&&(this.defaults.pool==0||a(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)){this.render(this.notifications.shift())}if(a(this.element).find("div.jGrowl-notification:parent").size()<2){a(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){a(this).remove()})}},startup:function(b){this.element=a(b).addClass("jGrowl").append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){jQuery(b).data("jGrowl.instance").update()},this.defaults.check);if(a.browser.msie&&parseInt(a.browser.version)<7&&!window.XMLHttpRequest){a(this.element).addClass("ie6")}},shutdown:function(){a(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval)}});a.jGrowl.defaults=a.fn.jGrowl.prototype.defaults})(jQuery);jQuery.cookie=function(b,m,p){if(typeof m!="undefined"){p=p||{};if(m===null){m="";p.expires=-1}var e="";if(p.expires&&(typeof p.expires=="number"||p.expires.toUTCString)){var f;if(typeof p.expires=="number"){f=new Date();f.setTime(f.getTime()+(p.expires*24*60*60*1000))}else{f=p.expires}e="; expires="+f.toUTCString()}var o=p.path?"; path="+(p.path):"";var g=p.domain?"; domain="+(p.domain):"";var a=p.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(m),e,o,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var n=document.cookie.split(";");for(var j=0;j<n.length;j++){var c=jQuery.trim(n[j]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};(function(a){a.simpleXpath=function(b,e){var g=b.split("/text()");b=g[0];var j=g[1].replace(/[\[\]]/g,"");b=b.replace(/\.\//g,">");b=b.replace(/\//g,">");var f=b.split(/[\[\]]/);for(var d=0,c=f.length;d<c;d++){if(Number(f[d])>0){f[d]=":eq("+(f[d]-1)+")"}}b=f.join("");return a(e+b).textNodes(true)[j]}})(jQuery);
/* 
    e-Mend - a web comment system.
    Copyright (C) 2006-2008 MemeFarmers, Collective.

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation; either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
*/
eMend.dictionary={comment:{delete_note_H:"Elimina questo commento",edit_note_H:"Modifica questo commento",author:"autore",baseURI:"images"},comment_more:{read_more:"Espandi il testo",read_less:"Riduci il testo",baseURI:"images"},commentForm:{comment:"commento",note:"nota",subject:"oggetto",cancel:"annulla",confirm:"conferma",tags:"tags"},commentGroup:{read_more:"Espandi il gruppo",read_less:"Riduci il gruppo",comment:"commento",comments:"commenti",baseURI:"images"},commentTrigger:{select_text:"seleziona il testo che vuoi commentare",activate_comment:"premi 'C' per commentare il testo selezionato",write_comment:"scrivi nel commento ci&ograve; che pensi",disable_HOL:"non mostrare pi&ugrave; i messaggi di aiuto",outside_boudaries:"la selezione &egrave; fuori dall'area commentabile",login_needed:"per inviare un commento &egrave; necessario il login"},sidebar:{hidelink:"Nascondi collegamento visuale",showlink:"Mostra collegamento visuale",baseURI:""}};(function(a){eMend.users=function(b){if(!(this instanceof arguments.callee)){return new eMend.users(b)}this.opts=a.extend({},eMend.users.defaults,b);this._currentUser=null};eMend.users.defaults={};eMend.users.prototype={login:function(b,c){if(c&&typeof c.name=="string"){this._currentUser=c.name;this.opts.dataset.loginAs(this._currentUser)}},logout:function(){this._currentUser=null},getCurrentUser:function(){return this._currentUser}}})(jQuery);(function(a){eMend.templates={comment:'<div class="actions"><a href="#" title="_(delete_note_H)" class="deletenote" onclick="return false;">&nbsp;</a><a href="#" title="_(edit_note_H)" class="editnote" onclick="return false;">&nbsp;</a></div><h6><img src="_(baseURI)/user${userIdx}.png" /><strong>${author}</strong> [${date}]:</h6><h5>${title}</h5><p><span class="commentbody">${body}</span></p>',comment_more:'...<img src="_(baseURI)/more.png" alt="_(readmore)" class="readmore" /><img src="_(baseURI)/less.png" alt="_(readless)" class="readless" style="display:none;" />',commentForm:'<form id="noteForm" class="Emend" onsubmit="return false; void(0);" style="background-image: url(_(baseURI)/bg-fff-diag.gif);"><fieldset><legend>_(comment)</legend><p><label for="noteSubject">_(subject):</label><span><input type="text" id="noteSubject" name="noteSubject" size="29" /></span><br/></p><p><label for="noteText">_(note):</label><span><textarea id="noteText" name="noteText" cols="28" rows="10" ></textarea></span><br class="clear"/></p><!--<p><label for="noteTags">_(tags):</label><span><input type="text" id="noteTags" name="noteTags" size="29" /></span><br/></p>--><p class="Emend-right"><button type="button" class="submit" id="submitNote" onclick="return false; void(0);" style="background: #FFFFFF url(_(baseURI)/bg_form_element.png) repeat-x;"><span class="ico confirm">_(confirm)<img src="_(baseURI)/ico-confirm.png" /></span></button></p><p class="Emend-left"><button type="button" class="submit" id="cancelNote" onclick="return false; void(0);" style="background: #FFFFFF url(_(baseURI)/bg_form_element.png) repeat-x;"><span class="ico cancel"><img src="_(baseURI)/ico-cancel.png" />_(cancel)</span></button></p></fieldset></form>',commentGroup:'<span><div class="nodetoggle"><img src="_(baseURI)/less_big.png" alt="_(readless)" class="closegroup"><img src="_(baseURI)/more_big.png" title="_(readmore)" class="opengroup" /></div></span>',commentTrigger:'<ul class="lavalamp"><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/selectText.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(select_text)</span></h2></div><label><input type="checkbox" id="emendHideHOLcheck"/>_(disable_HOL)</label></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/pressC.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(activate_comment)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/chat.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(write_comment)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/selectText.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(outside_boudaries)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/password.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(login_needed)</span></h2></div></li></ul>',sidebar:'<div class="sidebar-Y-header"><img src="_(baseURI)/ico-arrow-left.png" class="opensidebar" /><p class="version">0.3<br/>&beta;4</p><img src="_(baseURI)/emend-vertical.png" alt="e-mend"/></div><div class="sidebar-wrapper"><div class="sidebar-X-header"><!--<div class="extendsidebar"></div>--><img src="_(baseURI)/ico-arrow-right.png" class="closesidebar" /><div id="emend-modules"></div><img src="_(baseURI)/emend-horizontal.png" class="logo" alt="e-mend"/><sup class="version">0.3&beta;4</sup><div id="emend-modules-content"></div></div><div id="sidebar-body"></div><div id="memefarmers"><a href="http://memefarmers.net"><img src="_(baseURI)/memefarmers.png" /></a></div></div>'}})(jQuery);(function(a){eMend.dataset=function(b){if(!(this instanceof arguments.callee)){return new eMend.dataset(b)}this.opts=a.extend({},eMend.dataset.defaults,b);this._selections=[];this._comments=[];this._users=[];this._usersByName={};this._currentUser=-1;this._notesByDate={};this._notesFirstDate=null;this._notesLastDate=null;this._timeRange=[];this._filteredNodes={};this._nodeCommentsCount={};this._contentBkp=[];this.bkpContent(this.opts.target);this._contentEl=this.opts.target;this.initNodeFilters(this.opts.target,false);this.loginAsGuest()};eMend.dataset.defaults={};eMend.dataset.prototype={getContentEl:function(){return this._contentEl},getTimeRange:function(){if(!this._timeRange.length){this.initTimeRangeFilters()}return this._timeRange},getNotesFirstDate:function(){if(!this._notesFirstDate){this.updateNotesByDate()}return this._notesFirstDate},getNotesLastDate:function(){if(!this._notesLastDate){this.updateNotesByDate()}return this._notesLastDate},getSelections:function(){return this._selections},getComments:function(){return this._comments},getComment:function(b,c){return this._comments[b][c]},getCommentData:function(b,d){var e=this._comments[b][d];return{title:e[0],body:e[1],date:e[2],userIdx:b}},getCommentElement:function(b,d){var e=this._comments[b][d];return e.getElement()},getCurrentUser:function(){return this._currentUser},setCurrentUser:function(b){if(typeof b=="number"){this._currentUser=b}},getFilteredNodes:function(){return this._filteredNodes},getRawNodeMap:function(){return this.mapNodes(this._contentEl)},getMarkedNodeMap:function(){return this.markNodeMap()},bkpContent:function(b){this._contentBkp=[];if(this.opts.datastore){if(a("#eMend-content-backup").length==0){this.bkpContentOnDOM(b)}else{this.restoreContentFromDOM(b)}}var e=b.childNodes,f,g;for(var d in e){f=e[d];if(!f.nodeType||a(f).hasClass("write-protect")){continue}switch(f.nodeType){case 1:case 3:g=f.cloneNode(true);this._contentBkp.push(g);break}}},restoreContent:function(){var e=this._contentEl;var f=e.childNodes,g,c=this._contentBkp,j=0;while(f.length-j){if(a(e.firstChild).hasClass("write-protect")){j++;continue}e.removeChild(e.firstChild)}for(var d=c.length-1;d>-1;d--){e.insertBefore(c[d].cloneNode(true),e.firstChild)}document.body.normalize()},bkpContentOnDOM:function(c){var b=a.create("div",{id:"eMend-content-backup"});a(this.opts.datastore).append(b);var d=c.cloneNode(true);a(d).find("*[id]").each(function(){a(this)[0].id+="__bkp__"});b[0].innerHTML=d.innerHTML},restoreContentFromDOM:function(d){var c=a("#eMend-content-backup")[0];var e=c.cloneNode(true);a(e).find("*[id]").each(function(){var b=a(this)[0].id;a(this)[0].id=b.substr(0,b.indexOf("__bkp__"))});d.innerHTML=e.innerHTML;document.body.normalize()},addComment:function(n,o,p){if(typeof p=="undefined"){p=this._currentUser}var m=new Date();var f=m.format(Date.ISO8601c);var c=this._comments[p].length;var e=this._users[p];n=a.escapeReturns(n);o=a.escapeReturns(o);var j=0;var b={author:e,title:n,body:o,date:f,userIdx:p,noteIdx:c};var g=this._comments[p].push(new eMend.comment(b,{animate:false}));this.insertNoteByDate(f,p,g-1);this.lastComment={user:p,idx:g-1};a(document).trigger("emend.addComment");return(g-1)},modifyComment:function(f,n,e,g){var m=this._comments[e][g];var j=new Date();var c=j.format(Date.ISO8601c);var b=m[4];this._comments[e][g]=[f,n,c,n.length,b]},getLastComment:function(){if(this.lastComment){return this._comments[this.lastComment.user][this.lastComment.idx]}},remapSelectionToContent:function(o){var b=o.startContainer.parentNode,j=o.endContainer.parentNode,d=a(b).attr("node"),e=a(b).attr("fragment")||0,m=a(j).attr("node"),f=a(j).attr("fragment")||0;var n=e==0?o.startOffset:this._markedNodeMap.fM[d][e-1][1]+o.startOffset;var g=f==0?o.endOffset:this._markedNodeMap.fM[m][f-1][1]+o.endOffset;this.restoreContent();var c=a(this._contentEl).textNodes(true);return{startContainer:c[d],endContainer:c[m],startOffset:n,endOffset:g}},addSelection:function(o){if(typeof o=="undefined"){o=this._currentUser}var n=a.getSelection(true);switch(n.startContainer.parentNode.tagName){case"NODEBLOCK":case"NODEINNER":n=this.remapSelectionToContent(n);break}var g=a(n.startContainer).parents("*[id]");g=g[0]?g[0]:document.body;var j=g.id?g.id:"__noId__";var m=a(n.startContainer).generateXPath({context:g});var b=[n.startOffset,n.endOffset,{xpath:m,base:j}];if(n.startContainer!=n.endContainer){var f=a(n.endContainer).parents("*[id]");f=f[0]?f[0]:document.body;var d=f.id?f.id:"__noId__";var e=a(n.endContainer).generateXPath({context:f});b.push({xpath:e,base:d})}var c=this._selections[o].push(b);this.lastSelection={user:o,idx:c-1}},getLastSelection:function(){if(this.lastSelection){return this._selections[this.lastSelection.user][this.lastSelection.idx]}},removeLastSelection:function(){this._selections[this.lastSelection.user].splice(this.lastSelection.idx,1)},addUser:function(c){this._selections.push([]);this._comments.push([]);var b=this._users.push(c);this._usersByName[c]=b-1;return(b-1)},removeUser:function(b){if(b>0){this._selections.splice(b,1);this._comments.splice(b,1);this._users.splice(b,1)}},getUser:function(b){return this._users[b]},getOrCreateUser:function(b){var c=this._usersByName[b];if(c>=0){return c}return this.addUser(b)},loginAsGuest:function(){this.removeUser(this._currentUser);this._author="guest";this._authorHash="Sandbox";this._password="guest";this.addUser("guest");this._currentUser=0},loginAs:function(b){this._author=b;this._currentUser=this.addUser(b)},importEmendment:function(e,f){f.selection=e;var b=this.getOrCreateUser(f.author);f.userIdx=b;var d=this._selections[b].push(e);f.noteIdx=d-1;this.lastSelection={user:b,idx:d-1};var g=this._comments[b].push(new eMend.comment(f));this.lastComment={user:b,idx:g-1};this.insertNoteByDate(f.date,b,g-1)},initTimeRangeFilters:function(){if(!this.notesFirstDate){var c=new Date();var b=c.format(c,"%Y%%m%%d%");this._notesFirstDate=b;this._notesLastDate=b}this._timeRange[0]=this._notesFirstDate;this._timeRange[1]=this._notesLastDate},setTimeRangeFilter:function(c,b){this._timeRange[0]=Number(c);this._timeRange[1]=Number(b)},updateNotesByDate:function(){var n,e,j,c,f,b,m,g;n=new Date();e=n.format("%Y%%m%%d%");this._notesFirstDate=e;this._notesLastDate=e;j=this._notesByDate={};for(c=0,m=this._comments.length;c<m;c++){g=this._comments[c];for(f=0,b=g.length;f<b;f++){e=Number(g[f][2].substr(0,8));if(!j[e]){j[e]=[]}j[e].push(c+"_"+f);this._notesFirstDate=Math.min(e,this._notesFirstDate);this._notesLastDate=Math.max(e,this._notesLastDate)}}},insertNoteByDate:function(b,c,d){b=Number(b.substr(0,8));if(!this._notesByDate[b]){this._notesByDate[b]=[]}this._notesByDate[b].push(c+"_"+d);this._notesFirstDate=Math.min(b,this._notesFirstDate);this._notesLastDate=Math.max(b,this._notesLastDate)},mapNodes:function(c){var b=[];var j=[];var m=[];function g(o){switch(o.parentNode.tagName){case"SCRIPT":case"NOSCRIPT":return NodeFilter.FILTER_REJECT;break}return NodeFilter.FILTER_ACCEPT}function f(o){b.push(o);j.push([o.nodeValue]);m.push([[0,o.nodeValue.length,[]]])}function d(o){switch(o.parentNode.tagName){case"SCRIPT":case"NOSCRIPT":return;break}b.push(o);j.push([o.nodeValue]);m.push([[0,o.nodeValue.length,[]]])}if(document.createTreeWalker&&jQuery.browser.mozilla){function e(o){var q=o.currentNode;for(var p=o.firstChild();p!=null;p=o.nextSibling()){f(p);e(o)}o.currentNode=q}var n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,g,false);e(n);n=null}else{a(document.body).textNodes(true).each(function(){d(this)})}this._rawNodeMap={n:b,f:j,fM:m};return this._rawNodeMap},markNodeMap:function(){var W=this._selections,C=this._comments,G=this.getRawNodeMap();var L=G.n,J=G.f,b=G.fM;var y=this.getTimeRange();var g,f,O,X,Z,d,K,N,P,ac,aa,H,U,o,R,I;var c,ab,F,Q;var x=document.evaluate?0:1;for(var M=0,v=W.length;M<v;M++){g=W[M];f=C[M];for(var V=0,s=g.length;V<s;V++){X=Number(f[V].getISO8601c());if(X<y[0]||X>y[1]){continue}O=g[V];Z=O[0];d=O[1];K=O[2];N=O[3]?O[3]:O[2];switch(x){case 0:aa=K.base=="__noId__"?document.body:document.getElementById(K.base);H=N.base=="__noId__"?document.body:document.getElementById(N.base);try{P=document.evaluate(K.xpath,aa,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;ac=document.evaluate(N.xpath,H,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(Y){if(eMend.log){Y={};Y.funct="markNodeMap";Y.msg="invalid XPATH expression: "+K.xpath+" "+N.xpath;eMend.log.add("error",Y)}continue}break;case 1:aa=K.base=="__noId__"?"body":"#"+K.base;H=N.base=="__noId__"?"body":"#"+N.base;P=a.simpleXpath(K.xpath,aa);ac=a.simpleXpath(N.xpath,H);break}if(!P){if(eMend.log){Y={};Y.funct="markNodeMap";Y.msg="couldn't find node XcS.xpath: "+K.xpath;eMend.log.add("error",Y)}continue}if(!ac){if(eMend.log){Y={};Y.funct="markNodeMap";Y.msg="couldn't find node XcE.xpath: "+N.xpath;eMend.log.add("error",Y)}continue}U=o=-1;for(var T=0,q=L.length;T<q;T++){if(P==L[T]){U=T}if(ac==L[T]){o=T}if(U!=-1&&o!=-1){break}}if(U==-1||o==-1){continue}var n=J[U];var m=J[o];var A=b[U];var B=b[o];R=I=-1;for(var T=0,q=A.length;T<q;T++){if(R==-1&&Z>=A[T][0]&&Z<=A[T][1]){R=T;break}}for(var T=0,q=B.length;T<q;T++){if(I==-1&&d>=B[T][0]&&d<=B[T][1]){I=T;break}}if(I==-1){I=T-1}var p=n[R];var D=b[U][R];c=p.slice(0,Z-D[0]);if(c.length){n[R]=p.slice(Z-D[0]);n.splice(R,0,c);F=D[0];D[0]=Z;b[U].splice(R,0,[F,Z-1,D[2].slice(0)]);R++;if(U==o){I++}}var e=m[I];var E=b[o][I];ab=e.slice(d-E[0]);if(ab.length){m[I]=e.slice(0,d-E[0]);m.splice(I+1,0,ab);Q=E[1];E[1]=d;b[o].splice(I+1,0,[d,Q,E[2].slice(0)])}for(var T=U;T<=o;T++){var z=T==U?R:0;var ad=T==o?I+1:b[T].length;for(var S=z;S<ad;S++){b[T][S][2].push(M+"_"+V)}}}}this._markedNodeMap={n:L,f:J,fM:b};return this._markedNodeMap},initNodeFilters:function(d,c){var e=this.mapNodes(d);for(var b=0;b<e.n.length;b++){c?this.addNodeFilter(b):this.removeNodeFilter(b)}},filterAllNodes:function(){for(node in this._filteredNodes){this.addNodeFilter(node)}},unfilterAllNodes:function(){for(node in this._filteredNodes){this.removeNodeFilter(node)}},addNodeFilter:function(b){this._filteredNodes[b]=true},removeNodeFilter:function(b){this._filteredNodes[b]=false},toggleNodeFilter:function(n,g){var c=n.target;var d=emendARRAYutils.createFromWords(c.getAttribute("relNodes"));for(var j=0,m=d.length;j<m;j++){var o=d[j];var f=this._filteredNodes[o]=!this._filteredNodes[o];var b=document.getElementById("block"+o);b.setAttribute("hidenotes",f)}var f=this._filteredNodes[g];c.className="cMark_"+f+" fixedFontSize9";this.clearLinks();if(f){Emend.events.Notes.fadeNodeNotes.fire(c)}else{Emend.events.Notes.appearNodeNotes.fire(c)}}}})(jQuery);(function(a){eMend.highlight=function(s){var z=s.getMarkedNodeMap(),y=z.n,H=z.f,G=z.fM,v,u,g,x,F,B;var E=s.getFilteredNodes();for(var D=0,q=y.length;D<q;D++){var p=E[D];var A=y[D];var d=H[D];var r=G[D];var b=A.parentNode;var e=document.createElement("NODEBLOCK");e.id="block"+D;e.className="emend-block";e.setAttribute("hidenotes",p);e.setAttribute("node",D);var n=[];for(var C=0,o=d.length;C<o;C++){u=d[C];g=r[C];v=document.createElement("NODEINNER");v.setAttribute("node",D);v.setAttribute("fragment",C);if(g[2].length){n=n.concat(arrDiff(n,g[2]));B=Math.min(g[2].length,40);x=g[2].length+" comments";F="highlight n"+g[2].join(" n")+" a"+B;v.setAttribute("title",x);v.className=F}v.appendChild(document.createTextNode(u));e.appendChild(v)}b.replaceChild(e,A)}a(document).trigger("emend.highlight")}})(jQuery);(function(a){eMend.comment=function(d,c){if(d){this.data=d;this.data.textlength=d.body.length;var b=eMend.comment.defaults.shortlength;if(this.data.textlength>b){this.data.shorttext=d.body.substr(0,b)+"..."}}this.opts=a.extend({},eMend.comment.defaults,c);this.template=a.template(eMend.templates.comment,{regx:"gettext"}).apply(eMend.dictionary.comment);this.templateMore=a.template(eMend.templates.comment_more,{regx:"gettext"}).apply(eMend.dictionary.comment_more)};eMend.comment.defaults={shortlength:100,animate:true};eMend.comment.prototype={getElement:function(d){if(!this.element){var e=this.data.userIdx+"_"+this.data.noteIdx;var b=a.template(this.template).apply(this.data);var c=a.create("div",{id:"note"+e,note:e,className:d})[0];c.innerHTML=b;this.element=c}a(this.element).mouseover(this.over).mouseout(this.out);this.morelesstext(a(this.element).find(".commentbody")[0]);return this.element},getISO8601c:function(){return this.data.date.substr(0,8)},hide:function(){return this.opts.animate?a(this.element).slideUp(200):a(this.element).hide()},show:function(){return this.opts.animate?a(this.element).slideDown(200):a(this.element).show()},over:function(){var b=".n"+this.id.substr(4);a(b).addClass("eMend-highlight-over")},out:function(){var b=".n"+this.id.substr(4);a(b).removeClass("eMend-highlight-over")},morelesstext:function(c){var b=c.firstChild;if(b&&b.nodeType==3&&b.length>150){var d=a(c);d.attr("fulltext",b.data);d.html(b.data.substr(0,150)+this.templateMore);d.click(this.toggleText)}},toggleText:function(c){var d=a(this);var b=d.children(".readmore, .readless").toggle();if(d.attr("fulltext")){d.attr("shorttext",d[0].firstChild.data);d[0].firstChild.data=d.attr("fulltext");d.removeAttr("fulltext")}else{d.attr("fulltext",d[0].firstChild.data);d[0].firstChild.data=d.attr("shorttext");d.removeAttr("shorttext")}}}})(jQuery);(function(a){eMend.commentGroup=function(b){this.data=b;this.comments=[];this.template=a.template(eMend.templates.commentGroup,{regx:"gettext"}).apply(eMend.dictionary.commentGroup)};eMend.commentGroup.prototype={getElement:function(){if(!this.element){var d=this.data.nodeGroup;var c=this.data.nodeClass;this.element=a.create("div",{id:"noteGroup"+d,"class":c,node:d})[0];this.element.innerHTML=this.template;this.counter=a.create("h6",{unselectable:"on"})[0];this.element.appendChild(this.counter);var b=this;a(this.counter).click(function(){var e=a(this).parent().find(".emend-note").get(0);var f=a(e).attr("note");a(window).scrollTo(".n"+f,{duration:500,easing:"swing"})});a(this.element).find(".closegroup, .opengroup").click(function(){b.toggleGroup(b.element)})}return this.element},updateCounter:function(b){var c=b>1?b+" <em>"+eMend.dictionary.commentGroup.comments+"</em>":b+" <em>"+eMend.dictionary.commentGroup.comment+"</em>";a(this.counter).html(c);b=Math.min(b,40);this.counter.className="a"+b+" emendGroupTitle"},appendChild:function(b){this.comments.push(b);this.updateCounter(this.comments.length);this.element.appendChild(b)},prependChild:function(c){this.comments.unshift(c);var b=this.comments.length;this.updateCounter(b);if(b>1){this.element.insertBefore(c,this.comments[1])}else{this.element.appendChild(c)}},toggleGroup:function(b){a(b).children(".emend-note").toggle();a(b).toggleClass("readfull").toggleClass("readpart");a(document).trigger("emend.toggleGroup")},closeGroup:function(){a(this.element).addClass("readpart").removeClass("readfull").removeClass("minify")},openGroup:function(){a(this.element).addClass("readfull").removeClass("readpart").removeClass("minify")},minifyGroup:function(){a(this.element).removeClass("readfull").removeClass("readpart").addClass("minify")}}})(jQuery);(function(a){eMend.commentForm=function(b){if(!(this instanceof arguments.callee)){return new eMend.commentForm(b)}this.opts=a.extend({},eMend.commentForm.defaults,b);this.dataset=this.opts.dataset;this.active=false;this.template=a.template(eMend.templates.commentForm,{regx:"gettext"}).apply(eMend.dictionary.commentForm);this.create()};eMend.commentForm.defaults={};eMend.commentForm.prototype={create:function(){var d=a("#NoteFormContainer").remove()[0];if(!d){var c=a.template(this.template).apply(this.data);d=a.create("div",{id:"NoteFormContainer",className:"jqmWindow340 write-protect"})[0];d.innerHTML=c}a(this.opts.target).append(d);var b=this;a("#cancelNote").click(function(){b.cancel()});a("#submitNote").click(function(){b.submit()})},show:function(){this.active=true;this.dataset.addSelection();if(!a("#NoteFormContainer")[0]){this.create()}a("#noteSubject").attr("value","");a("#noteText").attr("value","");a("#NoteFormContainer").jqm({modal:true}).jqmShow();window.focus();a("#noteSubject")[0].focus()},submit:function(){var e=a("#noteSubject").attr("value");var d=a("#noteText").attr("value");var c=this.check(e,d);if(c){a("#NoteFormContainer").jqmHide();var b=this.dataset.addComment(e,d);this.active=false}},cancel:function(){this.dataset.removeLastSelection();a("#NoteFormContainer").jqmHide();this.active=false},check:function(c,e,b){var d=true;if(c==""){a("#noteSubject").addClass("warning");d=false}else{a("#noteSubject").removeClass("warning")}if(e==""){a("#noteText").addClass("warning");d=false}else{a("#noteText").removeClass("warning")}return d},isActive:function(){return this.active}}})(jQuery);(function(a){eMend.commentTrigger=function(c){if(!(this instanceof arguments.callee)){return new eMend.commentTrigger(c)}this.opts=c;if(!this.opts.hideHOL){var d=false;if(window.hideHOL){d=window.hideHOL}else{if(document.location.href.indexOf("emendDisableHOL")!=-1){d=true}else{if(document.location.href.indexOf("emendEnableHOL")!=-1){d=false}else{d=a.cookie("hideHOL")=="true"?true:false}}}this.opts.hideHOL=d}this.notifications=[];this.status=null;var b=this;a(document).mouseup(function(e){window.setTimeout(function(){var f=a.getSelectedText();if(!b.opts.form.isActive()&&f&&f.length){if(eMend.config.comment_target){var m=a.getSelection();var j=a(m.startContainer).parents(eMend.config.comment_target);var g=a(m.endContainer).parents(eMend.config.comment_target);if(eMend.config.login_needed_to_post&&b.opts.users.getCurrentUser()==null){b.show(4,1000);a(document).unbind("keyup.commentTrigger");a(document).unbind("keydown.commentTrigger")}else{if(j.length&g.length){b.show(1,1000)}else{b.show(3,1000);a(document).unbind("keyup.commentTrigger");a(document).unbind("keydown.commentTrigger")}}}else{b.show(1,1000)}}else{b.show(0,1000)}},10)});this.template=a.template(eMend.templates.commentTrigger,{regx:"gettext"}).apply(eMend.dictionary.commentTrigger);this.create()};eMend.commentTrigger.prototype={create:function(){var b=a("#HOLteaser").remove();if(!b.length){b=a.create("div",{id:"HOLteaser",style:"cursor: pointer;"});b[0].innerHTML=this.template}this.opts.target.appendChild(b[0]);a(b).find("li").hide();return b},show:function(f,d){if(this.status==f){return}var b=this;window.clearTimeout(this.timeOut);a(".eMend-jGrowl div.close").trigger("click.jGrowl");var c=a("#HOLteaser").find("li")[f];var e=this.opts.sidebar.isOpen()==false?"bottom-right":"bottom-left";a.jGrowl.defaults.closer=false;a.jGrowl.defaults.position=e;if(!this.opts.hideHOL){this.timeOut=window.setTimeout(function(){a.jGrowl(c.innerHTML,{theme:"eMend-jGrowl",life:6000,position:e,open:function(){a("#emendHideHOLcheck").click(function(){b.opts.hideHOL=true;a.cookie("hideHOL","true",{path:"/",expires:365})})}})},500)}this.status=f;b.isCtrl=false;a(document).bind("keyup.commentTrigger",function(g){if(g.which==17){b.isCtrl=false}if(g.which==67&&b.isCtrl==false){g.stopPropagation();b.activate()}}).bind("keydown.commentTrigger",function(g){if(g.which==17){b.isCtrl=true}})},hide:function(c,b){a(document).unbind("keyup.commentTrigger");a(document).unbind("keydown.commentTrigger")},activate:function(){if(this.status!=2){this.hide();this.show(2);this.opts.form.show()}}}})(jQuery);(function(a){eMend.linker=function(b){if(!(this instanceof arguments.callee)){return new eMend.linker(b)}this.opts=a.extend({},eMend.linker.defaults,b);this.noteReferences=[];this.hiddenNodeLinks={};this.lastScrollInfo={x:0,y:0};this.destroyCanvas()};eMend.linker.defaults={};eMend.linker.prototype={createCanvas:function(f){var c=this.containerWidth=a(window).width()-20,e=this.containerHeight=a(window).height(),g=a(window).scrollTop(),d=a("#EmendLinks");if(f&&d.length){d.attr("width",c);d.attr("height",e);d[0].style.top=g+"px"}else{d=a.create("canvas",{id:"EmendLinks","class":"EmendOverlay",height:e,width:c})[0];d.style.top=g+"px";a(this.opts.target).append(d);if(a.browser.msie){G_vmlCanvasManager.initElement(d);d=document.getElementById("EmendLinks")}this.canvas=d;this.ctx=d.getContext("2d");this.ctx.lineWidth=1;var b=this;a(d).click(function(){b.hideLinks()})}this.ctx.strokeStyle="#09f"},destroyCanvas:function(){a("#EmendLinks").remove()},hideLinks:function(){a("#EmendLinks").hide();a(this).trigger("emend.hidelinks");this._linksVisible=false},showLinks:function(){a("#EmendLinks").show();this._linksVisible=true},refreshLinks:function(b){this.createCanvas(true);this.clearLinks();this.renderLinks();if(!b){this.canvas.style.display="block"}},clearLinks:function(){if(this.canvas){this.canvas.getContext("2d").clearRect(0,0,this.containerWidth,this.containerHeight)}this._linksVisible=false},renderLinks:function(){var u=this.ctx,o={},m=this.opts.positions.getReferences(),d={x:a(window).scrollLeft(),y:a(window).scrollTop()},c=a.browser.opera&&a.browser.version>=9.5?12:5,g,j,f,n,q,s,e,r,b,p;for(j in m){f=a("#note"+j);q=m[j];g=q.node;if(this.hiddenNodeLinks[g]){continue}if(!f.length||f[0]&&f[0].style.display=="none"){if(o[g]){continue}o[g]=true;f=a("#noteGroup"+g)}n=a(f).offset({lite:true});s=q.left-d.x;e=q.top-d.y;r=e+c;b=n.left-d.x;p=n.top-d.y+8;u.beginPath();u.moveTo(s,e);u.lineTo(s,r);u.lineTo(b-25,r);u.lineTo(b-4,p);u.lineTo(b,p);u.stroke()}}}})(jQuery);(function(a){eMend.sidebar=function(b){if(!(this instanceof arguments.callee)){return new eMend.sidebar(b)}this.opts=a.extend({},eMend.sidebar.defaults,b);this.status="closed";this.template=a.template(eMend.templates.sidebar,{regx:"gettext"}).apply(eMend.dictionary.sidebar);this.create()};eMend.sidebar.defaults={body_open:"280px",body_closed:"27px"};eMend.sidebar.prototype={create:function(){var d=a("#eMend-sidebar")[0],c=a(window).height();if(!d){d=a.create("div",{id:"eMend-sidebar",style:"right: 0px; top: 0; height: "+c+"px;",unselectable:"on",className:this.status})[0];d.innerHTML=this.template;a(this.opts.target).append(d)}else{d.style.height=c+"px";this.status=a(d).attr("className")}var b=this;a(window).wresize(function(){b.refreshHeight()});a(document.body).css({marginRight:eMend.sidebar.defaults["body_"+this.status]});a(d).find(".sidebar-Y-header").click(function(){b.open()});a(d).find(".closesidebar").click(function(){b.close()});this.container=d},getContainer:function(){return a(this.container).find("#sidebar-body")[0]},destroy:function(){var b=a("eMend-sidebar");if(b){b.remove();delete this.container}},open:function(){a(".sidebar-wrapper").animate({right:"0"},500,"swing",function(){a(document.body).css({marginRight:"280px"});a(".sidebar-Y-header").css({right:"-60px"});a(document).trigger("emend.opensidebar")});a("#eMend-sidebar").attr("className","open");this.status="open";window.setTimeout(function(){a("#memefarmers").animate({bottom:"-20px"},1000,"swing")},10000)},close:function(){a(document.body).css({marginRight:"27px"});a(document).trigger("emend.closesidebar");a(".sidebar-wrapper").animate({right:"-260px"},500,"swing",function(){a(".sidebar-Y-header").css({right:"-280px"});a(".sidebar-Y-header").animate({right:"0"},500,"swing",function(){a(".sidebar-Y-header").css({bottom:"0"})})});a("#eMend-sidebar").attr("className","closed");this.status="closed"},extend:function(){a("#eMend-sidebar").css({width:"520px"});a(".sidebar-wrapper").animate({width:"520px"},500,"swing",function(){a(document.body).css({marginRight:"540px"});a(document).trigger("emend.opensidebar")})},refreshHeight:function(){var b=a(window).height();a(this.container).height(b+"px")},isOpen:function(){return(this.status=="open")}}})(jQuery);(function(a){eMend.navbar=function(b){if(!(this instanceof arguments.callee)){return new eMend.navbar(b)}this.opts=a.extend({},eMend.navbar.defaults,b);this.htmlEl=a("html");this.create();this.clear()};eMend.navbar.defaults={align:"right",width:"6px",height:"100%"};eMend.navbar.prototype={create:function(){this.htmlEl.css({height:"100%"});this.bar=a("#emend-navbar").remove()[0]||a.create("div",{id:"emend-navbar",style:b}," ")[0];var c=this.opts;var b=c.align+":0; top:0; width:"+c.width+"; height:"+c.height+"; position: absolute;";a(this.bar).attr("style",b);a(this.opts.target).append(this.bar)},refresh:function(){this.clear();this.render()},render:function(){var c=this.opts,b=a(document.body).height(),p=a(this.bar).height(),f=this.opts.positions.getHighlightsCollection();var e,j,r,d,n,q,u,g;for(var m=0;m<f.length;m++){e=f[m];j=e.className.split(" ").pop();r=a(e).height();d=a(e).offset({lite:true}).top;n=Math.round(r/b*p);q=Math.round(d/b*p);u="height:"+n+"px; width:"+c.width+"; position: absolute; top:"+q+"px; z-index:"+j.substr(1)+";";g=a.create("div",{"class":j,style:u})[0];this.bar.appendChild(g)}},clear:function(){a(this.bar).empty()}}})(jQuery);(function(a){eMend.positions=function(b){if(!(this instanceof arguments.callee)){return new eMend.positions(b)}this.highlightEls=null;this.highlights=null;this.references=null;this.opts=a.extend({},eMend.positions.defaults,b)};eMend.positions.prototype={invalidate:function(){var d,c,b;for(c=0,b=arguments.length;c<b;c++){d=arguments[c];switch(d){case"highlights":this.highlightEls=null;this.highlights=null;break;case"references":this.references=null;break}}},updateAll:function(){this.updateHighlightCollection();this.updateHighlights();this.updateReferences()},updateHighlightCollection:function(){this.highlightEls=a("nodeinner").filter(".highlight")},updateHighlights:function(){this.highlights={};var b=this.highlightEls;if(b&&b.length){var n,f,m,g;for(var e=b.length-1;e>=0;e--){n=b[e];f=n.className.split(" ");f.pop();f.shift();for(var d=0,c=f.length;d<c;d++){m=f[d].substring(1);if(!this.highlights[m]){g=a(n).offset({lite:true});this.highlights[m]=g;this.highlights[m].bottom=g.top+a(n).height()}}}}},updateReferences:function(){this.references={};var c=this.getHighlightsCollection();var b,n,d,g,q,e;for(var p=c.length-1;p>=0;p--){b=c[p];n=b.className.split(" ");n.pop();n.shift();for(var m=0,f=n.length;m<f;m++){d=n[m].substring(1);if(!this.references[d]){g=document.createElement("span");g.style.fontSize="1px";g.innerHTML="|";b.appendChild(g);e=a(g).offset({lite:true});this.references[d]=e;this.references[d].node=g.parentNode.getAttribute("node");b.removeChild(g)}}}},getVisibleHighlights:function(){var g,f=a(window).scrollTop(),c=a(window).height(),d=[],e=[],b=this.getHighlights();for(ntID in b){g=b[ntID];if(g.bottom>=f&&g.top<=c+f){d.push(ntID)}else{e.push(ntID)}}return{visible:d,invisible:e}},getInvisibleHighlights:function(){var f,e=a(window).scrollTop(),d=a(window).height(),g=[],b=this.getHighlights();for(ntID in b){f=b[ntID];if(f.bottom<=e||f.top>=d+e){g.push(ntID)}}return g},getReferences:function(){if(this.references==null){this.updateReferences()}return this.references},getReference:function(b){if(this.references==null){this.updateReferences()}return this.references[b]},getHighlights:function(){if(this.highlights==null){this.updateHighlights()}return this.highlights},getHighlight:function(b){if(this.highlights==null){this.updateHighlights()}return this.highlights[b]},getHighlightsCollection:function(){if(!this.highlightEls){this.updateHighlightCollection()}return this.highlightEls}}})(jQuery);(function(a){eMend.renderNotes=function(c){if(!(this instanceof arguments.callee)){return new eMend.renderNotes(c)}this.opts=a.extend({},eMend.renderNotes.defaults,c);this.container=this.opts.target;this.dataset=this.opts.dataset;this.positions=this.opts.positions;this.nodeStatus={};this.nodeLinkHidden={};this.renderedNotes={};var b=this;a(this.container).hover(function(){a(b).trigger("emend.notesHover")},function(){a(b).trigger("emend.notesUnHover")});this.clearNotes()};eMend.renderNotes.defaults={};eMend.renderNotes.prototype={clearNotes:function(){a(this.container).find(".noteGroup").remove()},renderNotes:function(){var o=this.container;var A=false,m=false,n=null,o=this.container,q=this.dataset;if(!A){this.clearNotes()}var c=a(".highlight"),r={},p={},e={},y={},g,v,b,z,C;for(var u=c.length-1;u>=0;u--){hlEL=c[u];z=a(hlEL.parentNode).attr("node");ntIDs=a(hlEL).attr("className").split(" ");ntIDs.pop();ntIDs.shift();if(!r[z]){C="noteGroup";C+=this.nodeStatus[z]?" readpart":" readfull";C+=this.nodeLinkHidden[z]?" unlinked":" linked";b=new eMend.commentGroup({nodeGroup:z,nodeClass:C});v=b.getElement();if(A){o.replaceChild(v,a("noteGroup"+refreshNode))}else{if(n){o.insertBefore(v,n)}else{o.appendChild(v)}}n=v;g=null;r[z]=true;count=0}for(var s=0,x=ntIDs.length;s<x;s++){ntID=ntIDs[s].substring(1);if(!p[ntID]){if(!this.nodeStatus[z]){uc=ntID.split("_");var f=q.getComment(uc[0],uc[1]);var d=f.getElement("emend-note even_"+m);m=!m;b.prependChild(d);g=d;this.renderedNotes[ntID]={group:b,comment:f}}p[ntID]=true;count++}}switch(count){case 0:y[z]=true;break;case 1:delete y[z];break;default:delete y[z]}}for(z in y){a("#noteGroup"+z).remove()}var B=a.create("div",{className:"noteGroup"});a(B).css({height:"50px",visibility:"hidden"});o.appendChild(B[0]);a(this).trigger("emend.rendernotes")},refreshView:function(){var c=this.positions.getVisibleHighlights(),p=c.invisible,j=c.visible,m,e,g=p.length,f=j.length;for(i=0;i<g;i++){var m=this.renderedNotes[p[i]];if(m){m.comment.hide();m.group.closeGroup();if(f>3||g>3){m.group.minifyGroup()}}}for(i=0;i<f;i++){var e=this.renderedNotes[j[i]];if(e){e.comment.show();e.group.openGroup()}}var d=j[j.length-1];var b=a("#note"+d);if(b.length){var n=(b.offset().top-a(window).scrollTop()+36)+"px";this.scrollTo(n)}else{window.setTimeout(function(){a(document).trigger("emend.afterviewscroll")},350)}},scrollTo:function(b){a("#sidebar-body").scrollTo({top:b},350,{onAfter:function(){a(document).trigger("emend.afterviewscroll")},stop:true})}}})(jQuery);(function(a){eMend.prefetch=function(f){var b=eMend.config;var o=typeof b.baseURI!="undefined"?b.baseURI:"../dist";var n=a("#eMend-comment-assets");if(!n.length){n=a(a.create("div",{id:"eMend-comment-assets"}));for(var g=0;g<21;g++){n.append(a.create("img",{src:o+"images/user"+g+".png"}))}n.append(a.create("img",{src:o+"images/more_big.png"}));n.append(a.create("img",{src:o+"images/less_big.png"}));n.append(a.create("img",{src:o+"images/more.png"}));n.append(a.create("img",{src:o+"images/less.png"}));a(f.datastore).append(n);var m=eMend.dictionary;m.comment.baseURI=m.comment_more.baseURI=m.commentGroup.baseURI=m.commentTrigger.baseURI=m.commentForm.baseURI=m.sidebar.baseURI=o+"images"}else{var e=a(n[0].firstChild).attr("src"),j=e.substr(0,e.lastIndexOf("/")),m=eMend.dictionary;m.comment.baseURI=m.comment_more.baseURI=m.commentGroup.baseURI=m.commentTrigger.baseURI=m.commentForm.baseURI=m.sidebar.baseURI=j}delete eMendBaseURI}})(jQuery);(function(a){eMend.backstore=eMend.backstore||{};eMend.backstore.tiddly=function(c){if(!(this instanceof arguments.callee)){return new eMend.backstore.tiddly(c)}this.opts=a.extend({},eMend.backstore.tiddly.defaults,c);var b=a("#eMend-backstore-tiddly");if(b.length){this.importData(b)}else{b=this.createDataContainer()}this.container=b};eMend.backstore.tiddly.defaults={};eMend.backstore.tiddly.prototype={createDataContainer:function(c){var b=a.create("div",{id:"eMend-backstore-tiddly"});a(this.opts.datastore).append(b);return a(b)},addComment:function(){var d=this.opts.dataset.getLastSelection()||null;var f=this.opts.dataset.getLastComment()||null;var e=f?f.data:null;var b=a.create("div",{});if(d&&e){a(b).attr("data",a.toJSON({s:d,c:e}));b[0].innerHTML=f.body;this.container.append(b)}},importData:function(b){var c=this.opts.dataset;b.children().each(function(){var d=a.evalJSON(a(this).attr("data"));c.importEmendment(d.s,d.c)});a(document).trigger("emend.importData")}}})(jQuery);(function(a){eMend.backstore=eMend.backstore||{};eMend.backstore.sfEmendPlugin=function(b){if(!(this instanceof arguments.callee)){return new eMend.backstore.sfEmendPlugin(b)}this.opts=a.extend({},eMend.backstore.sfEmendPlugin.defaults,b);var c=window.location.pathname.split("/");c.shift();this.resourceID=c.join("_");this.getCurrentUser();this.getComments()};eMend.backstore.sfEmendPlugin.defaults={};eMend.backstore.sfEmendPlugin.prototype={addComment:function(){var b=this.opts.dataset.getLastSelection(),d=a.extend(true,{},this.opts.dataset.getLastComment().data);d.selection=a.toJSON(b);d.body=a.escapeString(d.body);d.title=a.escapeString(d.title);a.ajax({url:"/emend_addComment/"+this.resourceID,data:d,success:function(c){},error:function(c){}})},getComments:function(b){var c=this.opts.dataset;a.ajax({url:"/emend_getComments/"+this.resourceID,success:function(f,m){var g=a.evalJSON(f);var e,d,j;for(e=0,d=g.comments.length;e<d;e++){j=g.comments[e];c.importEmendment(j.s,j.c)}a(document).trigger("emend.importData")},error:function(d,f,e){this}})},getCurrentUser:function(b){a.ajax({url:"/get_logged_user",success:function(c,e){var d=a.evalJSON(c);if(typeof d.name!="undefined"){a(document).trigger("emend.loggedIn",d)}else{a(document).trigger("emend.loggedOut")}},error:function(c,e,d){this}})}}})(jQuery);(function(a){eMend.backstore=eMend.backstore||{};eMend.backstore.sfEmendPluginLog=function(b){if(!(this instanceof arguments.callee)){return new eMend.backstore.sfEmendPluginLog(b)}this.username="anonymous";this.opts=a.extend({},eMend.backstore.sfEmendPluginLog.defaults,b);var c=window.location.pathname.split("/");c.shift();this.resourceID=c.join("_");this.getCurrentUser()};eMend.backstore.sfEmendPluginLog.defaults={};eMend.backstore.sfEmendPluginLog.prototype={add:function(c,e){var d="";if(typeof e=="object"){for(k in e){d+="<p>"+k+": <strong>"+e[k]+"</strong></p>"}}else{d+=e}d+="<p> resource id: <strong>"+this.resourceID+"</strong></p>";d+="<p> username:"+this.username+"</p>";d+="<p> user agent: "+navigator.userAgent+"</p>";var b={msg_type:c,msg:d};a.ajax({url:"/emend_addLog/"+this.resourceID,data:b,success:function(f){}})},getCurrentUser:function(b){a.ajax({url:"/get_logged_user",success:function(c,e){var d=a.evalJSON(c);if(typeof d.name!="undefined"){this.username=d.name}else{this.username="anonymous"}},error:function(c,e,d){this}})}}})(jQuery);if(!window.console||!window.console.firebug){if(window.opera&&!window.console){window.console={};function fn(){opera.postError(arguments)}["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"].forEach(function(a){window.console[a]=fn})}else{var names=["dir","dirxml","group","groupEnd","trace","profile","profileEnd","log","debug","info","warn","error","time","timeEnd","assert","count"];window.console={};for(i in names){window.console[names[i]]=function(){}}}}(function(a){eMend.init=function(o){if(eMend.status=="running"){return}var r=eMend.config;if(r.backend_debug){switch(r.backend_debug){case"sfEmendPluginLog":eMend.log=eMend.backstore.sfEmendPluginLog();break}}o("pre").addClass("keep-whitespace");document.body.normalize();o.fixOperaRangeSelectionBug();var C=o(r.comment_target).get(0)||document.body;var z=C.innerHTML;z=z.replace(/[\t\n\r\f]/gm," ");z=z.replace(/>\s+</gm,"><");z=z.replace(/\s{2,}/gm," ");C.innerHTML=z;o(r.comment_target).cleanWhitespace(true);o("a").each(function(){this.nodeValue=o.trim(this.nodeValue)});document.body.normalize();var x=o("#eMend-DATA-Overlay").remove()[0]||o.create("div",{id:"eMend-DATA-Overlay",className:"hidden write-protect"})[0];var E=o("#eMend-VISUAL-Overlay").remove()[0]||o.create("div",{id:"eMend-VISUAL-Overlay",className:"write-protect"})[0];if(o.browser.msie||o.browser.safari){o(document.body).append(x).append(E)}else{o(document.body.parentNode).append(x).append(E)}var P=eMend.prefetch({datastore:x});var N=eMend.sidebar({target:E});var p=N.getContainer();var F=eMend.dataset({target:document.body,datastore:x}),K=eMend.positions(),v=eMend.users({dataset:F}),y=eMend.renderNotes({dataset:F,target:p,positions:K}),s=eMend.navbar({target:p.parentNode,positions:K}),D=eMend.commentForm({dataset:F,target:E}),m=eMend.commentTrigger({target:E,form:D,sidebar:N,users:v}),u=eMend.linker({target:E,positions:K});if(r.backend){switch(r.backend){case"sfEmendPlugin":var I=eMend.backstore.sfEmendPlugin({dataset:F});o(document).bind("emend.addComment",function(){I.addComment()});break}}var f=-1;var G=o.getScroll().t;var d=function(c,n){if(N.isOpen()){u.refreshLinks()}},A=function(c,n){if(N.isOpen()){y.refreshView()}},M=function(c,n){u.hideLinks()},B=function(c,n){u.clearLinks()},b=function(c,n){s.refresh()},H=function(c,n){K.invalidate("highlights","references")},j=function(c,n){eMend.highlight(F);y.renderNotes()},q=function(c,n){N.open()},g=function(c,n){window.clearTimeout(f);f=window.setTimeout(function(){o(document).trigger("emend.afterscroll")},450)};delayedRefresh=function(){var c=o.getScroll().t;if(G!=c){M();g();G=c}};o(document).bind("emend.opensidebar",function(){d()});o(document).bind("emend.opensidebar",b);o(document).bind("emend.closesidebar",function(){M();window.setTimeout(B,500)});o(document).bind("emend.addComment",j);o(document).bind("emend.addComment",function(){m.show(0)});o(document).bind("emend.importData",function(){j()});o(document).bind("emend.highlight",H);o(y).bind("emend.notesHover",d);o(y).bind("emend.rendernotes",q);o(document).bind("emend.afterscroll",A);o(document).bind("emend.afterviewscroll",d);o(document).bind("emend.toggleGroup",function(){d()});o(window).wresize(H);o(window).wresize(d);o(window).wresize(b);if(r.scroll_refresh_delay){o(window).scroll(delayedRefresh)}else{o(window).scroll(d);o(window).scroll(g)}if(r.backend){o(document).bind("emend.loggedIn",function(c,n){v.login(c,n);m.show(0)});o(document).bind("emend.loggedOut",function(c,n){v.logout();m.show(4)})}if(r.backstore_tiddly){var e=eMend.backstore.tiddly({dataset:F,datastore:x});o(document).bind("emend.addComment",function(){e.addComment()})}if(r.modules){var O=o("#emend-modules"),L,J;for(L=0;L<r.modules.length;L++){J=r.modules[L];o("<img>").attr({id:"emend-plugin-"+J,src:r.baseURI+"modules/"+J+"/"+J+".png"}).appendTo(O);eMend.loadJS(r.baseURI+"modules/"+J+"/"+J+".load.js",true)}}eMend.status="running"};if(typeof eMendInit!="undefined"&&eMendInit==true){eMend.init(jQuery)}a(document).ready(function(){eMend.init(jQuery)})})(jQuery);if(eMend.config.jquery_noconflict){};