(function(a){if(!a.every){a.every=function(e,d){for(var c=0,b=this.length;--b>=0;c++){if(c in this&&!e.call(d,this[c],c,this)){return false}}return true}}if(!a.filter){a.filter=function(f,e){var g=[];for(var c,d=0,b=this.length;--b>=0;d++){if(d in this&&f.call(e,c=this[d],d,this)){g.push(c)}}return g}}if(!a.forEach){a.forEach=function(e,d){for(var c=0,b=this.length;--b>=0;c++){if(c in this){e.call(d,this[c],c,this)}}}}if(!a.indexOf){a.indexOf=function(d,c){var b=this.length;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=b}for(;c<b;c++){if(c in this&&this[c]===d){return c}}return -1}}if(!a.lastIndexOf){a.lastIndexOf=function(d,c){var b=this.length;if(isNaN(c)){c=b-1}else{c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=b}else{if(c>=b){c=b-1}}}for(;c>-1;c--){if(c in this&&this[c]===d){return c}}return -1}}if(!a.map){a.map=function(e,d){var b=this.length;var f=new Array(b);for(var c=0;--b>=0;c++){if(c in this){f[c]=e.call(d,this[c],c,this)}}return f}}if(!a.some){a.some=function(e,d){for(var c=0,b=this.length;--b>=0;c++){if(c in this&&e.call(d,this[c],c,this)){return true}}return false}}})(Array.prototype);if(!document.createElement("canvas").getContext){(function(){var z=Math;var A=z.round;var v=z.sin;var I=z.cos;var p=z.abs;var H=z.sqrt;var a=10;var q=a/2;function k(){return this.context_||(this.context_=new s(this))}var y=Array.prototype.slice;function J(m,K,L){var j=y.call(arguments,2);return function(){return m.apply(K,j.concat(y.call(arguments)))}}var n={init:function(j){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var m=j||document;m.createElement("canvas");m.attachEvent("onreadystatechange",J(this.init_,this,m))}},init_:function(L){if(!L.namespaces.g_vml_){L.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!L.namespaces.g_o_){L.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!L.styleSheets.ex_canvas_){var K=L.createStyleSheet();K.owningElement.id="ex_canvas_";K.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var m=L.getElementsByTagName("canvas");for(var j=0;j<m.length;j++){this.initElement(m[j])}},initElement:function(m){if(!m.getContext){m.getContext=k;m.innerHTML="";m.attachEvent("onpropertychange",G);m.attachEvent("onresize",b);var j=m.attributes;if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"}else{m.width=m.clientWidth}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"}else{m.height=m.clientHeight}}return m}};function G(m){var j=m.srcElement;switch(m.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function b(m){var j=m.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}n.init();var e=[];for(var D=0;D<16;D++){for(var C=0;C<16;C++){e[D*16+C]=D.toString(16)+C.toString(16)}}function u(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(L,K){var m=u();for(var j=0;j<3;j++){for(var O=0;O<3;O++){var M=0;for(var N=0;N<3;N++){M+=L[j][N]*K[N][O]}m[j][O]=M}}return m}function B(m,j){j.fillStyle=m.fillStyle;j.lineCap=m.lineCap;j.lineJoin=m.lineJoin;j.lineWidth=m.lineWidth;j.miterLimit=m.miterLimit;j.shadowBlur=m.shadowBlur;j.shadowColor=m.shadowColor;j.shadowOffsetX=m.shadowOffsetX;j.shadowOffsetY=m.shadowOffsetY;j.strokeStyle=m.strokeStyle;j.globalAlpha=m.globalAlpha;j.arcScaleX_=m.arcScaleX_;j.arcScaleY_=m.arcScaleY_;j.lineScale_=m.lineScale_}function c(m){var M,L=1;m=String(m);if(m.substring(0,3)=="rgb"){var O=m.indexOf("(",3);var j=m.indexOf(")",O+1);var N=m.substring(O+1,j).split(",");M="#";for(var K=0;K<3;K++){M+=e[Number(N[K])]}if(N.length==4&&m.substr(3,1)=="a"){L=N[3]}}else{M=m}return{color:M,alpha:L}}function x(j){switch(j){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function s(m){this.m_=u();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=a*1;this.globalAlpha=1;this.canvas=m;var j=m.ownerDocument.createElement("div");j.style.width=m.clientWidth+"px";j.style.height=m.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";m.appendChild(j);this.element_=j;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var o=s.prototype;o.clearRect=function(){this.element_.innerHTML=""};o.beginPath=function(){this.currentPath_=[]};o.moveTo=function(m,j){var K=this.getCoords_(m,j);this.currentPath_.push({type:"moveTo",x:K.x,y:K.y});this.currentX_=K.x;this.currentY_=K.y};o.lineTo=function(m,j){var K=this.getCoords_(m,j);this.currentPath_.push({type:"lineTo",x:K.x,y:K.y});this.currentX_=K.x;this.currentY_=K.y};o.bezierCurveTo=function(K,m,Q,P,O,M){var j=this.getCoords_(O,M);var N=this.getCoords_(K,m);var L=this.getCoords_(Q,P);r(this,N,L,j)};function r(j,L,K,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:L.x,cp1y:L.y,cp2x:K.x,cp2y:K.y,x:m.x,y:m.y});j.currentX_=m.x;j.currentY_=m.y}o.quadraticCurveTo=function(O,K,m,j){var N=this.getCoords_(O,K);var M=this.getCoords_(m,j);var P={x:this.currentX_+2/3*(N.x-this.currentX_),y:this.currentY_+2/3*(N.y-this.currentY_)};var L={x:P.x+(M.x-this.currentX_)/3,y:P.y+(M.y-this.currentY_)/3};r(this,P,L,M)};o.arc=function(R,P,Q,M,m,K){Q*=a;var V=K?"at":"wa";var S=R+I(M)*Q-q;var U=P+v(M)*Q-q;var j=R+I(m)*Q-q;var T=P+v(m)*Q-q;if(S==j&&!K){S+=0.125}var L=this.getCoords_(R,P);var O=this.getCoords_(S,U);var N=this.getCoords_(j,T);this.currentPath_.push({type:V,x:L.x,y:L.y,radius:Q,xStart:O.x,yStart:O.y,xEnd:N.x,yEnd:N.y})};o.rect=function(K,m,j,L){this.moveTo(K,m);this.lineTo(K+j,m);this.lineTo(K+j,m+L);this.lineTo(K,m+L);this.closePath()};o.strokeRect=function(K,m,j,L){var M=this.currentPath_;this.beginPath();this.moveTo(K,m);this.lineTo(K+j,m);this.lineTo(K+j,m+L);this.lineTo(K,m+L);this.closePath();this.stroke();this.currentPath_=M};o.fillRect=function(K,m,j,L){var M=this.currentPath_;this.beginPath();this.moveTo(K,m);this.lineTo(K+j,m);this.lineTo(K+j,m+L);this.lineTo(K,m+L);this.closePath();this.fill();this.currentPath_=M};o.createLinearGradient=function(m,L,j,K){var M=new E("gradient");M.x0_=m;M.y0_=L;M.x1_=j;M.y1_=K;return M};o.createRadialGradient=function(L,N,K,m,M,j){var O=new E("gradientradial");O.x0_=L;O.y0_=N;O.r0_=K;O.x1_=m;O.y1_=M;O.r1_=j;return O};o.drawImage=function(Y,K){var Q,O,S,af,V,T,aa,ah;var R=Y.runtimeStyle.width;var X=Y.runtimeStyle.height;Y.runtimeStyle.width="auto";Y.runtimeStyle.height="auto";var P=Y.width;var ad=Y.height;Y.runtimeStyle.width=R;Y.runtimeStyle.height=X;if(arguments.length==3){Q=arguments[1];O=arguments[2];V=T=0;aa=S=P;ah=af=ad}else{if(arguments.length==5){Q=arguments[1];O=arguments[2];S=arguments[3];af=arguments[4];V=T=0;aa=P;ah=ad}else{if(arguments.length==9){V=arguments[1];T=arguments[2];aa=arguments[3];ah=arguments[4];Q=arguments[5];O=arguments[6];S=arguments[7];af=arguments[8]}else{throw Error("Invalid number of arguments")}}}var ag=this.getCoords_(Q,O);var L=aa/2;var m=ah/2;var ae=[];var j=10;var N=10;ae.push(" <g_vml_:group",' coordsize="',a*j,",",a*N,'"',' coordorigin="0,0"',' style="width:',j,"px;height:",N,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var M=[];M.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",A(ag.x/a),",","Dy=",A(ag.y/a),"");var ac=ag;var ab=this.getCoords_(Q+S,O);var Z=this.getCoords_(Q,O+af);var U=this.getCoords_(Q+S,O+af);ac.x=z.max(ac.x,ab.x,Z.x,U.x);ac.y=z.max(ac.y,ab.y,Z.y,U.y);ae.push("padding:0 ",A(ac.x/a),"px ",A(ac.y/a),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",M.join(""),", sizingmethod='clip');")}else{ae.push("top:",A(ag.y/a),"px;left:",A(ag.x/a),"px;")}ae.push(' ">','<g_vml_:image src="',Y.src,'"',' style="width:',a*S,"px;"," height:",a*af,'px;"',' cropleft="',V/P,'"',' croptop="',T/ad,'"',' cropright="',(P-V-aa)/P,'"',' cropbottom="',(ad-T-ah)/ad,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",ae.join(""))};o.stroke=function(aj){var O=[];var P=false;var av=c(aj?this.fillStyle:this.strokeStyle);var af=av.color;var ap=av.alpha*this.globalAlpha;var L=10;var R=10;O.push("<g_vml_:shape",' filled="',!!aj,'"',' style="position:absolute;width:',L,"px;height:",R,'px;"',' coordorigin="0 0" coordsize="',a*L," ",a*R,'"',' stroked="',!aj,'"',' path="');var Q=false;var au={x:null,y:null};var ab={x:null,y:null};for(var ao=0;ao<this.currentPath_.length;ao++){var an=this.currentPath_[ao];var at;switch(an.type){case"moveTo":at=an;O.push(" m ",A(an.x),",",A(an.y));break;case"lineTo":O.push(" l ",A(an.x),",",A(an.y));break;case"close":O.push(" x ");an=null;break;case"bezierCurveTo":O.push(" c ",A(an.cp1x),",",A(an.cp1y),",",A(an.cp2x),",",A(an.cp2y),",",A(an.x),",",A(an.y));break;case"at":case"wa":O.push(" ",an.type," ",A(an.x-this.arcScaleX_*an.radius),",",A(an.y-this.arcScaleY_*an.radius)," ",A(an.x+this.arcScaleX_*an.radius),",",A(an.y+this.arcScaleY_*an.radius)," ",A(an.xStart),",",A(an.yStart)," ",A(an.xEnd),",",A(an.yEnd));break}if(an){if(au.x==null||an.x<au.x){au.x=an.x}if(ab.x==null||an.x>ab.x){ab.x=an.x}if(au.y==null||an.y<au.y){au.y=an.y}if(ab.y==null||an.y>ab.y){ab.y=an.y}}}O.push(' ">');if(!aj){var aa=this.lineScale_*this.lineWidth;if(aa<1){ap*=aa}O.push("<g_vml_:stroke",' opacity="',ap,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',x(this.lineCap),'"',' weight="',aa,'px"',' color="',af,'" />')}else{if(typeof this.fillStyle=="object"){var S=this.fillStyle;var Y=0;var am={x:0,y:0};var ag=0;var V=1;if(S.type_=="gradient"){var U=S.x0_/this.arcScaleX_;var m=S.y0_/this.arcScaleY_;var T=S.x1_/this.arcScaleX_;var aw=S.y1_/this.arcScaleY_;var ar=this.getCoords_(U,m);var aq=this.getCoords_(T,aw);var N=aq.x-ar.x;var M=aq.y-ar.y;Y=Math.atan2(N,M)*180/Math.PI;if(Y<0){Y+=360}if(Y<0.000001){Y=0}}else{var ar=this.getCoords_(S.x0_,S.y0_);var j=ab.x-au.x;var K=ab.y-au.y;am={x:(ar.x-au.x)/j,y:(ar.y-au.y)/K};j/=this.arcScaleX_*a;K/=this.arcScaleY_*a;var al=z.max(j,K);ag=2*S.r0_/al;V=2*S.r1_/al-ag}var ae=S.colors_;ae.sort(function(ax,W){return ax.offset-W.offset});var Z=ae.length;var ad=ae[0].color;var ac=ae[Z-1].color;var ai=ae[0].alpha*this.globalAlpha;var ah=ae[Z-1].alpha*this.globalAlpha;var ak=[];for(var ao=0;ao<Z;ao++){var X=ae[ao];ak.push(X.offset*V+ag+" "+X.color)}O.push('<g_vml_:fill type="',S.type_,'"',' method="none" focus="100%"',' color="',ad,'"',' color2="',ac,'"',' colors="',ak.join(","),'"',' opacity="',ah,'"',' g_o_:opacity2="',ai,'"',' angle="',Y,'"',' focusposition="',am.x,",",am.y,'" />')}else{O.push('<g_vml_:fill color="',af,'" opacity="',ap,'" />')}}O.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",O.join(""))};o.fill=function(){this.stroke(true)};o.closePath=function(){this.currentPath_.push({type:"close"})};o.getCoords_=function(L,K){var j=this.m_;return{x:a*(L*j[0][0]+K*j[1][0]+j[2][0])-q,y:a*(L*j[0][1]+K*j[1][1]+j[2][1])-q}};o.save=function(){var j={};B(this,j);this.aStack_.push(j);this.mStack_.push(this.m_);this.m_=d(u(),this.m_)};o.restore=function(){B(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function g(K){for(var M=0;M<3;M++){for(var L=0;L<2;L++){if(!isFinite(K[M][L])||isNaN(K[M][L])){return false}}}return true}function F(K,j,L){if(!g(j)){return}K.m_=j;if(L){var M=j[0][0]*j[1][1]-j[0][1]*j[1][0];K.lineScale_=H(p(M))}}o.translate=function(K,m){var j=[[1,0,0],[0,1,0],[K,m,1]];F(this,d(j,this.m_),false)};o.rotate=function(m){var L=I(m);var K=v(m);var j=[[L,K,0],[-K,L,0],[0,0,1]];F(this,d(j,this.m_),false)};o.scale=function(K,m){this.arcScaleX_*=K;this.arcScaleY_*=m;var j=[[K,0,0],[0,m,0],[0,0,1]];F(this,d(j,this.m_),true)};o.transform=function(M,L,O,N,m,j){var K=[[M,L,0],[O,N,0],[m,j,1]];F(this,d(K,this.m_),true)};o.setTransform=function(N,M,P,O,L,K){var j=[[N,M,0],[P,O,0],[L,K,1]];F(this,j,true)};o.clip=function(){};o.arcTo=function(){};o.createPattern=function(){return new f};function E(j){this.type_=j;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}E.prototype.addColorStop=function(m,j){j=c(j);this.colors_.push({offset:m,color:j.color,alpha:j.alpha})};function f(){}G_vmlCanvasManager=n;CanvasRenderingContext2D=s;CanvasGradient=E;CanvasPattern=f})()}(function(u,q,k){function s(d){this.e=d;this.i=0;this.js=["with(XPath){return ","}"];this.expression(1,1)||this.error();return new Function("n","nsr",this.js.join(""))}s.ie=/MSIE/.test(navigator.userAgent);s.prototype={match:function(p,e){var d,f;if(!(d=p.exec(this.e.substr(this.i)))||(typeof e=="number"&&!(f=d[e]))||(typeof e=="object"&&!(f=e[d[1]]))){return false}this.m=d;this.i+=d[0].length;return f||d},error:function(f){f=(f||"Syntax error")+" at index "+this.i+": "+this.e.substr(this.i);var p;try{p=new n(51,f)}catch(d){p=new Error(f)}throw p},step:function(d,y,p,z){var f=3;if(this.match(/^(\/\/?|\.\.?|@)\s*/,1)){switch(this.m[1]){case"/":if(p){this.error()}if(!z){return this.step(d,y,1)}this.js.splice(d,0,' axis(axes["',"document-root",'"],');f+=this.nodeTypes.node.call(this,d+f);p=1;break;case"//":if(p){this.error()}this.js.splice(d,0,' axis(axes["',"descendant-or-self",'"],');f+=this.nodeTypes.node.call(this,d+f);p=1;break;case".":if(!p&&!z){this.error()}this.js.splice(d,0,' axis(axes["',"self",'"],');f+=this.nodeTypes.node.call(this,d+f);p=0;break;case"..":if(!p&&!z){this.error()}this.js.splice(d,0,' axis(axes["',"parent",'"],');f+=this.nodeTypes.node.call(this,d+f);p=0;break;case"@":if(!p&&!z){this.error()}this.js.splice(d,0,' axis(axes["',"attribute",'"],');f+=this.nodeTest(d+f,"node")||this.error("Missing nodeTest after @");p=0}}else{if(!p&&!z){return p?this.error():0}else{if(this.match(/^([a-z]+(?:-[a-z]+)*)\s*::\s*/,s.axes)){this.js.splice(d,0,' axis(axes["',this.m[1],'"],');f+=this.nodeTest(d+f,(this.m[1]=="attribute")?"node":"element")||this.error("Missing nodeTest after ::");p=0}else{if(f=this.nodeTest(d,"element")){this.js.splice(d,0,' axis(axes["',"child",'"],');f+=3;p=0}else{return 0}}}}for(var e;e=this.predicate(d+f);f+=e){}if(z){this.js.splice(y+f++,0,z)}f+=this.step(d,y+f,p);this.js.splice(y+f++,0,")");return f},expression:function(d,f,y){var z,e=this.operand(d);while(z=this.match(/^(or|and|!?=|[<>]=?|[|*+-]|div|mod)\s*/,this.operators)){if(y&&y[0]>=z[0]){this.i-=this.m[0].length;break}this.js.splice(d,0,z[1]);e++;this.js.splice(d+e++,0,z[2]);e+=this.expression(d+e,f,z)||this.error("Missing operand");this.js.splice(d+e++,0,z[3])}return e},operand:function(d){if(this.match(/^(-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)|"[^"]*"|'[^']*')\s*/,1)){this.js.splice(d,0,this.m[1]);return 1}var p;if(p=this.match(/^([a-z]+(?:-[a-z]+)*)\s*\(\s*/,this.functions)){var f=1,e;this.js.splice(d,0,p[1]);do{if(e){this.js.splice(d+f++,0,",")}f+=(e=this.expression(d+f,d+f))}while(e&&this.match(/^,\s*/));this.match(/^\)\s*/)||this.error("Missing (");if(p[0]){if(e){this.js.splice(d+f++,0,",")}this.js.splice(d+f++,0,p[0])}if(p[2]){this.js.splice(d+f++,0,p[2])}else{if(e>1){this.error("Function has arguments")}}f+=this.step(d,d+f);return f}if(this.match(/^\(\s*/)){var f=1;this.js.splice(d,0,"(");f+=this.expression(d+f,d+f);this.match(/^\)\s*/)||this.error("Missing )");this.js.splice(d+f++,")");return f}return this.step(d,d,0,"[n]")},operators:{"|":[1,"union(",",",")"],or:[1,"bool(",")||bool(",")"],and:[2,"bool(",")&&bool(",")"],"=":[3,"compare(eq,",",",")"],"!=":[3,"compare(ne,",",",")"],"<":[4,"compare(lt,",",",")"],">":[4,"compare(gt,",",",")"],"<=":[4,"compare(le,",",",")"],">=":[4,"compare(ge,",",",")"],"+":[5,"number(",")+number(",")"],"-":[5,"number(",")-number(",")"],"*":[6,"number(",")*number(",")"],div:[6,"number(",")/number(",")"],mod:[6,"number(",")%number(",")"]},functions:{last:[0,"nl.length"],position:[0,"(i+1)"],count:["nl","(",".length||0)"],id:["n","id(",")"],"local-name":["nl","localName(",")"],"namespace-uri":["nl","namespaceURI(",")"],name:["nl","qName(",")"],string:["n","string(",")"],concat:[0,"concat(",")"],"starts-with":[0,"startsWith(",")"],contains:[0,"contains(",")"],"substring-before":[0,"substringBefore(",")"],"substring-after":[0,"substringAfter(",")"],substring:[0,"substring(",")"],"string-length":["n","string(",").length"],"normalize-space":["n","normalizeSpace(",")"],translate:[0,"translate(",")"],"boolean":[0,"bool(",")"],not:[0,"!bool(",")"],"true":[0,"true "],"false":[0,"false "],number:["n","number(",")"],floor:[0,"Math.floor(number(","))"],ceiling:[0,"Math.ceil(number(","))"],round:[0,"Math.round(number(","))"],sum:[0,"sum(",")"]},predicate:function(d){var e=0;if(this.match(/^\[\s*/)){if(e=this.expression(d,d)){this.js.splice(d,0,"function(n,i,nl){with(XPath){var r=");e++;this.js.splice(d+e++,0,';return typeof r=="number"?Math.round(r)==i+1:bool(r)}},')}this.match(/^\]\s*/)||this.error("Missing ]")}return e},nodeTest:function(d,e){var f;if(f=this.match(/^([a-z]+(?:-[a-z]+)*)\(([^)]*)\)\s*/,this.nodeTypes)){return f.call(this,d,this.m[2])}if(this.match(/^\*\s*/)){return this.nodeTypes[e].call(this,d)}return this.nodeName(d)},nodeType:function(d,e){this.js.splice(d,0,"function(n){return n.nodeType==",e,"},");return 3},nodeTypes:{node:function(d){this.js.splice(d,0,"null,");return 1},element:function(d){return this.nodeType(d,1)},attribute:function(d){return this.nodeType(d,2)},text:function(d){return this.nodeType(d,3)},"processing-instruction":function(d,e){if(!e){return this.nodeType(d,7)}this.js.splice(d,0,"function(n){return n.nodeType==7&&n.target==",e,"},");return 3},comment:function(d){return this.nodeType(d,8)}},nodeName:function(d){if(!this.match(/^([a-zA-Z_]+(?:-?[a-zA-Z0-9]+)*)(?::([a-zA-Z_]+(?:-?[a-zA-Z0-9]+)*))?\s*/,1)){return 0}if(this.m[2]){this.js.splice(d,0,'function(n){if(!nsr)throw new XPathException(14);return "',this.m[2],'"==',s.ie?"n.baseName":"n.localName",'&&nsr.lookupNamespaceURI("',this.m[1],'")==n.namespaceURI},');return 7}else{this.js.splice(d,0,"function(n){return/^",this.m[1],"$/i.test(n.nodeName)},");return 3}}};s.order=function(e,f){var d=e.compareDocumentPosition?e.compareDocumentPosition(f):s.compareDocumentPosition.call(e,f);if(d&32){e=Array.prototype.indexOf.call(e.attributes,e);f=Array.prototype.indexOf.call(f.attributes,f);return(e<f)?-1:(e>f)?1:0}if(!d){if(e==f){return 0}if((e=e.ownerElement)&&(f=f.ownerElement)){return s.order(e,f)}return s.ie?1:0}return 3-((d&6)||3)};s.compare=function(y,e,z){if(e instanceof Array&&z instanceof Array){var d=e.map(this.string),f=z.map(this.string);for(e=d.length;--e>=0;){for(z=f.length;--z>=0;){if(!y(d[e],f[z])){return false}}}return true}if(e instanceof Array){for(var p=e.length;--p>=0;){if(!y(this[typeof z](e[p]),z)){return false}}return e.length>0}if(z instanceof Array){for(var p=z.length;--p>=0;){if(!y(e,this[typeof e](z[p]))){return false}}return z.length>0}if(typeof e=="boolean"||typeof z=="boolean"){return y(this.bool(e),this.bool(z))}if(typeof e=="number"||typeof z=="number"){return y(this.number(e),this.number(z))}return y(this.string(e),this.string(z))};s.eq=function(d,e){return d==e};s.ne=function(d,e){return d!=e};s.lt=function(d,e){return d<e};s.gt=function(d,e){return d>e};s.le=function(d,e){return d<=e};s.ge=function(d,e){return d>=e};s.id=function(f,r){if(arguments.length==1){r=f}var d=[];for(var p=this.string(f).split(/\s+/),e=p.length;--e>=0;){if(f=(r.ownerDocument||r).getElementById(p[e])){d.push(f)}}return d.sort(this.order)};s.localName=new Function("nl","return (nl.length&&nl[0]."+(s.ie?"baseName":"localName")+')||""');s.namespaceURI=function(d){return(d.length&&d[0].namespaceURI)||""};s.qName=function(d){return(d.length&&d[0].nodeName)||""};s.union=function(f,d){if(!f.length){return d}if(!d.length){return f}var e=[],r=f.length-1,p=d.length-1;for(;;){switch(this.order(f[r],d[p])){case -1:e.unshift(d[p--]);break;case 0:p--;case 1:e.unshift(f[r--]);break;default:throw new Error("Invalid order")}if(r<0){if(++p>0){e.unshift.apply(e,e.slice.call(d,0,p))}break}if(p<0){if(++r>0){e.unshift.apply(e,e.slice.call(f,0,r))}break}}return e};s.string=s.object=function(d){if(d instanceof Array&&typeof(d=d[0])=="undefined"){return""}if(typeof d=="string"){return d}switch(d.nodeType){case 1:case 9:case 11:return Array.prototype.map.call(d.childNodes,this.string,this).join("");default:return d.nodeValue||""}return String(d)};s.concat=function(){return Array.prototype.map.call(arguments,this.string,this).join("")};s.startsWith=function(e,d){return this.string(e).substr(0,(d=this.string(d)).length)==d};s.contains=function(e,d){return this.string(e).indexOf(this.string(d))!=-1};s.substringBefore=function(e,d){e=this.string(e);d=e.indexOf(this.string(d));return d!=-1?e.substr(0,d):""};s.substringAfter=function(e,d){e=this.string(e);d=this.string(d);var f=e.indexOf(d);return f!=-1?e.substr(f+d.length):""};s.substring=function(f,e,d){f=this.string(f);e=Math.round(this.number(e))-1;return(arguments.length==2)?f.substr(e<0?0:e):f.substr(e<0?0:e,Math.round(this.number(d))-Math.max(0,-e))};s.normalizeSpace=function(d){return this.string(d).replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ")};s.translate=function(p,e,A){p=this.string(p);e=this.string(e);A=this.string(A);var z=[],f=p.length,y=0,r,d;while(--f>=0){if((r=e.indexOf(d=p.charAt(y++)))==-1||(d=A.charAt(r))){z.push(d)}}return z.join("")};s.bool=s["boolean"]=function(d){if(typeof d=="boolean"){return d}if(d instanceof Array||typeof d=="string"){return d.length>0}return Boolean(d)};s.number=function(d){if(d instanceof Array&&typeof(d=d[0])=="undefined"){return 0}if(typeof d=="number"){return d}if(typeof d=="boolean"){return d?1:0}return Number(this.string(d))};s.sum=function(d){var f=0,e=d.length;while(--e>=0){f+=this.number(d[e])}return f};s.walk=function(p,e){var d,f=p.firstChild;while(f){e.push(f);if(d=f.firstChild){f=d}else{for(d=f;!(f=d.nextSibling)&&(d=d.parentNode)&&(d!=p);){}}}return e};s.axes={ancestor:function(e){var d=[];while(e=e.parentNode){d.unshift(e)}return d},"ancestor-or-self":function(e){var d=[];do{d.unshift(e)}while(e=e.parentNode);return d},attribute:new Function("n","var nl = [], a = n.attributes;if(a){attr:for(var x,i=a.length;--i>=0;){if(!(x=a[i]).specified){"+(s.ie?'switch(x.nodeName){case"selected":case"value":if(x.nodeValue)break;default:continue attr;}':"continue;")+"}nl.unshift(x);}}return nl;"),child:function(d){return d.childNodes||[]},descendant:function(d){return this.walk(d,[])},"descendant-or-self":function(d){return this.walk(d,[d])},following:function(f){var e=[],d;while(f){if(d=f.nextSibling){e.push(f=d);if(d=f.firstChild){e.push(f=d)}}else{f=f.parentNode}}return e},"following-sibling":function(e){var d=[];while(e=e.nextSibling){d.push(e)}return d},parent:function(d){return d.parentNode?[d.parentNode]:[]},preceding:function(r){var e=[],d,f=r.parentNode;while(r){if(d=r.previousSibling){for(r=d;d=r.lastChild;r=d){}e.unshift(r)}else{if(r=r.parentNode){if(r==f){f=f.parentNode}else{e.unshift(r)}}}}return e},"preceding-sibling":function(e){var d=[];while(e=e.previousSibling){d.unshift(e)}return d},self:function(d){return[d]},"document-root":function(d){return[d.ownerDocument||d]}};s.axis=function(C,B){var d,D,A=arguments.length-1,e=arguments[A],y=Array.prototype;for(var z=0,p,f=e.length;--f>=0;){D=C.call(this,e[z++]);if(B&&D.length){D=y.filter.call(D,B,this)}for(p=2;p<A&&D.length;D=y.filter.call(D,arguments[p++],this)){}d=d?this.union(d,D):D}return d||[]};s.cache={};function b(A){if(this==A){return 0}if(this.nodeType==2&&A.nodeType==2){return(this.ownerElement&&this.ownerElement==A.ownerElement)?32:0}var d=this.ownerElement||this,p=A.ownerElement||A;if(d.sourceIndex>=0&&p.sourceIndex>=0&&d.contains&&p.contains){return(((d.contains(p)&&16)||(p.contains(d)&&8))|((d.sourceIndex<p.sourceIndex&&4)||(p.sourceIndex<d.sourceIndex&&2)))||1}var y=d,z=p,e=0,f=0;while(y=y.parentNode){e++}while(z=z.parentNode){f++}if(e>f){while(e--!=f){d=d.parentNode}if(d==p){return 2|8}}else{if(f>e){while(f--!=e){p=p.parentNode}if(p==d){return 4|16}}}while((y=d.parentNode)!=(z=p.parentNode)){if(!(d=y)||!(p=z)){return 1}}while(d=d.nextSibling){if(d==p){return 4}}return 2}if(u.Node){var x=u.Node.prototype;if(k||!x.compareDocumentPosition){x.compareDocumentPosition=b}if(k||!x.contains){x.contains=function(d){return Boolean(this.compareDocumentPosition(d)&16)}}}else{s.compareDocumentPosition=b}if(k||!u.XPathException){function n(e,d){this.name="XPathException";this.code=e;this.message=d}var o=n,c=new Error;c.toString=function(){return this.name+":"+this.message};o.prototype=c;o.NAMESPACE_ERR=14;o.INVALID_EXPRESSION_ERR=51;o.TYPE_ERR=52;u.XPathException=o}if(k||!u.XPathNSResolver){function j(p){this.ns={};for(var d,e,f=p.attributes.length;--f>=0;){if(d=/xmlns:(.+)/.exec((e=p.attributes[f]).nodeName)){this.ns[d[1]]=e.nodeValue}}this.ns[""]=p.getAttribute("targetNamespace")}j.prototype={lookupNamespaceURI:function(d){return this.ns[d||""]}};u.XPathNSResolver=j}if(k||!u.XPathExpression){function v(f,d){this.fn=s.cache[f]||(s.cache[f]=new s(f));this.nsr=d}v.prototype={evaluate:function(e,d){return new g(this.fn(e,this.nsr),d)}};u.XPathExpression=v}if(k||!u.XPathResult){function g(e,d){if(d==0){switch(typeof e){default:d++;case"boolean":d++;case"string":d++;case"number":d++}}this.resultType=d;switch(d){case 1:this.numberValue=s.number(e);return;case 2:this.stringValue=s.string(e);return;case 3:this.booleanValue=s.bool(e);return;case 4:case 5:if(e instanceof Array){this.value=e;this.index=0;this.invalidIteratorState=false;return}break;case 6:case 7:if(e instanceof Array){this.value=e;this.snapshotLength=e.length;return}break;case 8:case 9:if(e instanceof Array){this.singleNodeValue=e[0];return}}throw new n(52)}var a=g;a.ANY_TYPE=0;a.NUMBER_TYPE=1;a.STRING_TYPE=2;a.BOOLEAN_TYPE=3;a.UNORDERED_NODE_ITERATOR_TYPE=4;a.ORDERED_NODE_ITERATOR_TYPE=5;a.UNORDERED_NODE_SNAPSHOT_TYPE=6;a.ORDERED_NODE_SNAPSHOT_TYPE=7;a.ANY_UNORDERED_NODE_TYPE=8;a.FIRST_ORDERED_NODE_TYPE=9;a.prototype={iterateNext:function(){switch(this.resultType){case 4:case 5:return this.value[this.index++]}throw new n(52)},snapshotItem:function(d){switch(this.resultType){case 6:case 7:return this.value[d]}throw new n(52)}};u.XPathResult=a}if(k||!u.XPathEvaluator){function m(){}var o=m;o.prototype={createExpression:function(f,d){return new v(f,d)},createNSResolver:function(d){return new j(d)},evaluate:function(p,r,f,d){return new v(p,f).evaluate(r,d)}};o.install=function(p,e){for(var d in m.prototype){if(e||!p[d]){p[d]=m.prototype[d]}}};u.XPathEvaluator=o;if(u.Document){o.install(u.Document.prototype,k)}else{o.install(document,k)}u.XPath=s}})(window,document,/WebKit/.test(navigator.userAgent));arrDiff=function(u,s,b){if(!u.length){u.push("");s.push("");var a=1}var r=[],q=-1,o,n,g,f;for(n=s.length,f=u.length;n--;){for(g=f;g&&(o=s[n]!==u[--g]);){}o&&(r[++q]=b?n:s[n])}if(a){u.pop();s.pop()}return r};Date.prototype.format=function(c,g){var k=this,e,b=function(d,a){return(d=d+"").length<a?new Array(++a-d.length).join("0")+d:d};var g=g||{},j={j:function(){return k.getDate()},w:function(){return k.getDay()},y:function(){return(k.getFullYear()+"").slice(2)},Y:function(){return k.getFullYear()},n:function(){return k.getMonth()+1},m:function(){return b(j.n(),2)},g:function(){return k.getHours()%12||12},G:function(){return k.getHours()},H:function(){return b(k.getHours(),2)},h:function(){return b(j.g(),2)},d:function(){return b(j.j(),2)},N:function(){return j.w()+1},i:function(){return b(k.getMinutes(),2)},s:function(){return b(k.getSeconds(),2)},ms:function(){return b(k.getMilliseconds(),3)},a:function(){return k.getHours()>11?"pm":"am"},A:function(){return j.a().toUpperCase()},O:function(){return k.getTimezoneOffset()/60},z:function(){return(k-new Date(k.getFullYear()+"/1/1"))/86400000>>0},L:function(){var a=j.Y();return(!(a&3)&&(a%100||!(a%400)))?1:0},t:function(){var a;return(a=k.getMonth()+1)==2?28+j.L():a&1&&a<8||!(a&1)&&a>7?31:30},W:function(){var f=j.z(),d=364+j.L()-f,m=(new Date(k.getFullYear()+"/1/1").getDay()||7)-1;return(d<=2&&((k.getDay()||7)-1)<=2-d)?1:(f<=2&&m>=4&&f>=(6-m))?new Date(k.getFullYear()-1+"/12/31").format("%W%"):(1+(m<=3?((f+m)/7):(f-(7-m))/7)>>0)}};return String(c).replace(/%(.*?)%/g,function(a,d){return g[d]?g[d](k,function(f){return j[f]&&j[f]()}):j[d]?j[d]():"%"+(d&&d+"%")})};Date.ISO8601="%Y%-%m%-%d%T%H%:%i%:%s%%O%";Date.ISO8601c="%Y%%m%%d%T%H%:%i%:%s%%O%";Date.prototype.setISO8601=function(b){var c="(^[0-9]{4})(-?([0-9]{2})(-?([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";var f=b.match(new RegExp(c));var e=0;var a=new Date(f[1],0,1);if(f[3]){a.setMonth(f[3]-1)}if(f[5]){a.setDate(f[5])}if(f[7]){a.setHours(f[7])}if(f[8]){a.setMinutes(f[8])}if(f[10]){a.setSeconds(f[10])}if(f[12]){a.setMilliseconds(Number("0."+f[12])*1000)}if(f[14]){e=(Number(f[16])*60)+Number(f[17]);e*=((f[15]=="-")?1:-1)}e-=a.getTimezoneOffset();time=(Number(a)+(e*60*1000));this.setTime(Number(time))};jQuery.getScroll=function(a){if(a){t=a.scrollTop;l=a.scrollLeft;w=a.scrollWidth;h=a.scrollHeight}else{if(document.documentElement&&document.documentElement.scrollTop){t=document.documentElement.scrollTop;l=document.documentElement.scrollLeft;w=document.documentElement.scrollWidth;h=document.documentElement.scrollHeight}else{if(document.body){t=document.body.scrollTop;l=document.body.scrollLeft;w=document.body.scrollWidth;h=document.body.scrollHeight}}}return{t:t,l:l,w:w,h:h}};(function(a){a.escapeReturns=function(b){b=escape(b);for(i=0;i<b.length;i++){if(b.indexOf("%0D%0A")>-1){b=b.replace("%0D%0A","<br/>")}else{if(b.indexOf("%0A")>-1){b=b.replace("%0A","<br/>")}else{if(b.indexOf("%0D")>-1){b=b.replace("%0D","<br/>")}}}}b=unescape(b);return b}})(jQuery);(function(a){a.fixOperaRangeSelectionBug=function(){function b(k){if(k.nodeType!=3){return false}var j=/\u00A0/;return k.nodeValue.match(j)}var f=document.body.getElementsByTagName("br");for(var g=0;g<f.length;g++){var d=f[g];var c=d.previousSibling;if(c!=null){var e=b(c);if(!e){d.parentNode.insertBefore(document.createTextNode("\u00A0"),d)}}}}})(jQuery);if(jQuery&&jQuery.browser.opera&&jQuery.browser.version>=9.5){var height_=jQuery.fn.height;jQuery.fn.height=function(){if(this[0]==window){return window.innerHeight}else{return height_.apply(this,arguments)}};var width_=jQuery.fn.width;jQuery.fn.width=function(){if(this[0]==window){return window.innerWidth}else{return width_.apply(this,arguments)}}}jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,f,a,j,g){return jQuery.easing[jQuery.easing.def](e,f,a,j,g)},easeInQuad:function(e,f,a,j,g){return j*(f/=g)*f+a},easeOutQuad:function(e,f,a,j,g){return -j*(f/=g)*(f-2)+a},easeInOutQuad:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f+a}return -j/2*((--f)*(f-2)-1)+a},easeInCubic:function(e,f,a,j,g){return j*(f/=g)*f*f+a},easeOutCubic:function(e,f,a,j,g){return j*((f=f/g-1)*f*f+1)+a},easeInOutCubic:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f*f+a}return j/2*((f-=2)*f*f+2)+a},easeInQuart:function(e,f,a,j,g){return j*(f/=g)*f*f*f+a},easeOutQuart:function(e,f,a,j,g){return -j*((f=f/g-1)*f*f*f-1)+a},easeInOutQuart:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f*f*f+a}return -j/2*((f-=2)*f*f*f-2)+a},easeInQuint:function(e,f,a,j,g){return j*(f/=g)*f*f*f*f+a},easeOutQuint:function(e,f,a,j,g){return j*((f=f/g-1)*f*f*f*f+1)+a},easeInOutQuint:function(e,f,a,j,g){if((f/=g/2)<1){return j/2*f*f*f*f*f+a}return j/2*((f-=2)*f*f*f*f+2)+a},easeInSine:function(e,f,a,j,g){return -j*Math.cos(f/g*(Math.PI/2))+j+a},easeOutSine:function(e,f,a,j,g){return j*Math.sin(f/g*(Math.PI/2))+a},easeInOutSine:function(e,f,a,j,g){return -j/2*(Math.cos(Math.PI*f/g)-1)+a},easeInExpo:function(e,f,a,j,g){return(f==0)?a:j*Math.pow(2,10*(f/g-1))+a},easeOutExpo:function(e,f,a,j,g){return(f==g)?a+j:j*(-Math.pow(2,-10*f/g)+1)+a},easeInOutExpo:function(e,f,a,j,g){if(f==0){return a}if(f==g){return a+j}if((f/=g/2)<1){return j/2*Math.pow(2,10*(f-1))+a}return j/2*(-Math.pow(2,-10*--f)+2)+a},easeInCirc:function(e,f,a,j,g){return -j*(Math.sqrt(1-(f/=g)*f)-1)+a},easeOutCirc:function(e,f,a,j,g){return j*Math.sqrt(1-(f=f/g-1)*f)+a},easeInOutCirc:function(e,f,a,j,g){if((f/=g/2)<1){return -j/2*(Math.sqrt(1-f*f)-1)+a}return j/2*(Math.sqrt(1-(f-=2)*f)+1)+a},easeInElastic:function(f,j,e,o,n){var k=1.70158;var m=0;var g=o;if(j==0){return e}if((j/=n)==1){return e+o}if(!m){m=n*0.3}if(g<Math.abs(o)){g=o;var k=m/4}else{var k=m/(2*Math.PI)*Math.asin(o/g)}return -(g*Math.pow(2,10*(j-=1))*Math.sin((j*n-k)*(2*Math.PI)/m))+e},easeOutElastic:function(f,j,e,o,n){var k=1.70158;var m=0;var g=o;if(j==0){return e}if((j/=n)==1){return e+o}if(!m){m=n*0.3}if(g<Math.abs(o)){g=o;var k=m/4}else{var k=m/(2*Math.PI)*Math.asin(o/g)}return g*Math.pow(2,-10*j)*Math.sin((j*n-k)*(2*Math.PI)/m)+o+e},easeInOutElastic:function(f,j,e,o,n){var k=1.70158;var m=0;var g=o;if(j==0){return e}if((j/=n/2)==2){return e+o}if(!m){m=n*(0.3*1.5)}if(g<Math.abs(o)){g=o;var k=m/4}else{var k=m/(2*Math.PI)*Math.asin(o/g)}if(j<1){return -0.5*(g*Math.pow(2,10*(j-=1))*Math.sin((j*n-k)*(2*Math.PI)/m))+e}return g*Math.pow(2,-10*(j-=1))*Math.sin((j*n-k)*(2*Math.PI)/m)*0.5+o+e},easeInBack:function(e,f,a,k,j,g){if(g==undefined){g=1.70158}return k*(f/=j)*f*((g+1)*f-g)+a},easeOutBack:function(e,f,a,k,j,g){if(g==undefined){g=1.70158}return k*((f=f/j-1)*f*((g+1)*f+g)+1)+a},easeInOutBack:function(e,f,a,k,j,g){if(g==undefined){g=1.70158}if((f/=j/2)<1){return k/2*(f*f*(((g*=(1.525))+1)*f-g))+a}return k/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+a},easeInBounce:function(e,f,a,j,g){return j-jQuery.easing.easeOutBounce(e,g-f,0,j,g)+a},easeOutBounce:function(e,f,a,j,g){if((f/=g)<(1/2.75)){return j*(7.5625*f*f)+a}else{if(f<(2/2.75)){return j*(7.5625*(f-=(1.5/2.75))*f+0.75)+a}else{if(f<(2.5/2.75)){return j*(7.5625*(f-=(2.25/2.75))*f+0.9375)+a}else{return j*(7.5625*(f-=(2.625/2.75))*f+0.984375)+a}}}},easeInOutBounce:function(e,f,a,j,g){if(f<g/2){return jQuery.easing.easeInBounce(e,f*2,0,j,g)*0.5+a}return jQuery.easing.easeOutBounce(e,f*2-g,0,j,g)*0.5+j*0.5+a}});jQuery.extend(jQuery.easing,{easeIn:function(e,f,a,j,g){return jQuery.easing.easeInQuad(e,f,a,j,g)},easeOut:function(e,f,a,j,g){return jQuery.easing.easeOutQuad(e,f,a,j,g)},easeInOut:function(e,f,a,j,g){return jQuery.easing.easeInOutQuad(e,f,a,j,g)},expoin:function(e,f,a,j,g){return jQuery.easing.easeInExpo(e,f,a,j,g)},expoout:function(e,f,a,j,g){return jQuery.easing.easeOutExpo(e,f,a,j,g)},expoinout:function(e,f,a,j,g){return jQuery.easing.easeInOutExpo(e,f,a,j,g)},bouncein:function(e,f,a,j,g){return jQuery.easing.easeInBounce(e,f,a,j,g)},bounceout:function(e,f,a,j,g){return jQuery.easing.easeOutBounce(e,f,a,j,g)},bounceinout:function(e,f,a,j,g){return jQuery.easing.easeInOutBounce(e,f,a,j,g)},elasin:function(e,f,a,j,g){return jQuery.easing.easeInElastic(e,f,a,j,g)},elasout:function(e,f,a,j,g){return jQuery.easing.easeOutElastic(e,f,a,j,g)},elasinout:function(e,f,a,j,g){return jQuery.easing.easeInOutElastic(e,f,a,j,g)},backin:function(e,f,a,j,g){return jQuery.easing.easeInBack(e,f,a,j,g)},backout:function(e,f,a,j,g){return jQuery.easing.easeOutBack(e,f,a,j,g)},backinout:function(e,f,a,j,g){return jQuery.easing.easeInOutBack(e,f,a,j,g)}});(function(a){a.fn.cleanWhitespace=function(c){var d=this[0];if(a(d).hasClass("keep-whitespace")){return d}var e=d.firstChild;while(e){var b=e.nextSibling;if(e.nodeType==3){if(!/\S/.test(e.nodeValue)){d.removeChild(e)}else{var f=e.nodeValue;f=f.replace(/[\t\n\r\f]/g,"");f=f.replace(/\ {2,}/g," ");f=f.replace(/^\ */,"");e.nodeValue=f}}else{if(c&&e.nodeType==1){a(e).cleanWhitespace(c)}}e=b}return d}})(jQuery);(function(a){a.fn.textNodes=function(b){var c=[];this.each(function(){var e=this.childNodes;for(var d=0;d<e.length;d++){var f=e[d];if(f.nodeType==3){c.push(f)}else{if(b&&f.nodeType==1){Array.prototype.push.apply(c,jQuery(f).textNodes(b,true))}}}});return arguments[1]?c:this.pushStack(c)}})(jQuery);(function(a){a.getSelectedText=function(){if(window.getSelection){var b=window.getSelection();return b.toString()}else{if(document.selection){var b=document.selection,c=b.createRange();return c.text}}};a.getSelection=function(G){if(window.getSelection){var q=window.getSelection();if(false&&q.getRangeAt){var o=q.getRangeAt(0)}else{var o=document.createRange();o.setStart(q.anchorNode,q.anchorOffset);o.setEnd(q.focusNode,q.focusOffset)}y=o.cloneRange(),u=o.cloneRange();y.collapse(true);u.collapse(false);var H=y.startContainer,L=u.endContainer,A=y.startOffset,c=u.endOffset,s=q.toString();if(H.nodeType==1){H=a(H).textNodes(true)[A];A=0}if(L.nodeType==1){var m=a(L).textNodes(true);var k=s.length;var e="",z="",d=-1;maxcount=0;var n="";for(var B=0,C=Number(m.length);B<C;B++){tn=m[B].data.replace(/\s/g," ");e=s.substr(k-tn.length).replace(/\s/g," ");for(var x=B-1;tn==e;x--){tn=m[x].data.replace(/\s/g," ")+tn;e=s.substr(k-tn.length).replace(/\s/g," ");if(tn.indexOf(e)!=-1||e.indexOf(tn)!=-1){console.log(tn);console.log(e);console.log(">>>>>>>>>>>>>>>>>>>")}}}L=m[d];c=L.length}if(G){q.removeAllRanges()}}else{if(document.selection){var q=document.selection,o=q.createRange();var s=o.text;if(s.length==0){return null}var y=o.duplicate(),u=o.duplicate();y.collapse(true);u.collapse(false);var F=y.parentElement();var f=u.parentElement();var g=document.body.createTextRange(),C=g.text.length;g.moveToElementText(F);g.collapse(true);var A=0;while(o.compareEndPoints("StartToStart",g)!=0&&A<C){A++;g.move("character")}g.moveToElementText(f);C=g.text.length;g.collapse(true);var c=0;while(o.compareEndPoints("EndToEnd",g)!=0&&c<C){c++;g.move("character")}var D=a(F).textNodes(true),H;if(D.length==1){H=D[0]}else{var K=0,p=0,b=0;while(p<=A){b=p;p+=D[K].length;K++}A-=b;H=D[--K]}var J=a(f).textNodes(true),L;if(J.length==1){L=J[0]}else{var E=0,p=0,b=0;while(p<=c&&E<J.length){b=p;p+=J[E].length;E++}c-=b;L=J[--E]}c=Math.min(c,L.length);if(G){q.empty()}}}if(H!=L||A!=c){var I={startContainer:H,endContainer:L,startOffset:A,endOffset:c,text:s};return I}else{return null}}})(jQuery);(function(a){a.create=function(){var c=[],b=arguments,d,f;b=b[0].constructor==Array?b[0]:b;for(d=0;d<b.length;d++){if(b[d+1]&&b[d+1].constructor==Object){f=document.createElement(b[d]);a(f).attr(b[++d]);if(b[d+1]&&b[d+1].constructor==Array){a(f).append(a.create(b[++d]))}c.push(f)}else{c.push(document.createTextNode(b[d]))}}return c};a.tpl=function(d,c){var b=[];jQuery.each(d.constructor==Array?d:[d],function(){var f=a.create(c.apply(this));for(var e=0;e<f.length;e++){b.push(f[e])}});return b}})(jQuery);(function($){$.template=function(html,options){return new $.template.instance(html,options)};$.template.instance=function(html,options){if(options&&options.regx){options.regx=this.regx[options.regx]}this.options=$.extend({compile:false,regx:this.regx.standard},options||{});this.html=html;if(this.options.compile){this.compile()}this.isTemplate=true};$.template.regx=$.template.instance.prototype.regx={jsp:/\$\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,ext:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,jtemplates:/\{\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}\}/g};$.extend($.template.regx,{gettext:/\_\(([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\)/g});$.template.regx.standard=$.template.regx.jsp;$.template.helpers=$.template.instance.prototype.helpers={substr:function(value,start,length){return String(value).substr(start,length)}};$.extend($.template.instance.prototype,{apply:function(values){if(this.options.compile){return this.compiled(values)}else{var tpl=this;var fm=this.helpers;var fn=function(m,name,format,args){if(format){if(format.substr(0,5)=="this."){return tpl.call(format.substr(5),values[name],values)}else{if(args){var re=/^\s*['"](.*)["']\s*$/;args=args.split(",");for(var i=0,len=args.length;i<len;i++){args[i]=args[i].replace(re,"$1")}args=[values[name]].concat(args)}else{args=[values[name]]}return fm[format].apply(fm,args)}}else{return values[name]!==undefined?values[name]:""}};return this.html.replace(this.options.regx,fn)}},compile:function(){var sep=$.browser.mozilla?"+":",";var fm=this.helpers;var fn=function(m,name,format,args){if(format){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="(values['"+name+"'] == undefined ? '' : "}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"};var body;if($.browser.mozilla){body="this.compiled = function(values){ return '"+this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn)+"';};"}else{body=["this.compiled = function(values){ return ['"];body.push(this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn));body.push("'].join('');};");body=body.join("")}eval(body);return this}});var $_old={domManip:$.fn.domManip,text:$.fn.text,html:$.fn.html};$.fn.domManip=function(args,table,reverse,callback){if(args[0].isTemplate){args[0]=args[0].apply(args[1]);delete args[1]}var r=$_old.domManip.apply(this,arguments);return r};$.fn.html=function(value,o){if(value&&value.isTemplate){var value=value.apply(o)}var r=$_old.html.apply(this,[value]);return r};$.fn.text=function(value,o){if(value&&value.isTemplate){var value=value.apply(o)}var r=$_old.text.apply(this,[value]);return r}})(jQuery);(function(a){a.fn.generateXPath=function(c){a.fn.generateXPath.defaults={depth:0,maxDepth:99,context:document.body,namespace:null,kwds:{showId:1}};var e=a.extend({},a.fn.generateXPath.defaults,c);return b(this[0],e.depth,e.maxDepth,e.context,e.namespace,e.kwds);function b(k,o,g,f,m,j){var r="";if(!k){return""}if(k==f){return"."}if((k.parentNode)&&(o<g)){r+=b(k.parentNode,o+1,g,f,m,j)}switch(k.nodeType){case 1:var p=k.nodeName;var u=[];var s=false;if(j.showClass&&a(k).attr("class")){u.push("@class='"+k.getAttribute("class")+"'")}if(j.showId&&a(k).attr("id")){u.push("@id='"+k.getAttribute("id")+"'");s=true}if(!s){var q=d(k);if(q){if(u.length>0){u.push("position()="+q)}else{u.push(q)}}}if(j.showNS){if(k.prefix){p=k.prefix+":"+p}else{if(m){p="default:"+p}}}if(j.toLowercase){p=p.toLowerCase()}r+="/"+p;if(u.length>0){r+="[";for(var n=0;n<u.length;n++){if(n>0){r+=" and "}r+=u[n]}r+="]"}break;case 9:break;case 3:r+="/text()";var q=d(k);if(q){r+="["+q+"]"}break}return r}function d(g){var o=g.parentNode.childNodes;var n=0;var f;if(g.nodeType==1){var j=g.nodeName;for(var k=0;k<o.length;k++){var m=o.item(k);if(m.nodeType==1){if(m.nodeName==j){n++}if(m==g){f=n}}}}else{if(g.nodeType==3){for(var k=0;k<o.length;k++){var m=o.item(k);if(m.nodeType==3){n++;if(m==g){f=n}}}}}if(n>1){return f}}}})(jQuery);(function(a){a.fn.wresize=function(c){version="1.1";wresize={fired:false,width:0};function b(){if(a.browser.msie){if(!wresize.fired){wresize.fired=true}else{var e=parseInt(a.browser.version,10);wresize.fired=false;if(e<7){return false}else{if(e==7){var f=a(window).width();if(f!=wresize.width){wresize.width=f;return false}}}}}return true}function d(f){if(b()){return c.apply(this,[f])}}this.each(function(){if(this==window){a(this).resize(d)}else{a(this).resize(c)}});return this}})(jQuery);(function(a){a.textResizeDetector=function(b){this.opts=a.extend({},a.textResizeDetector.defaults,b);this.initialize()};a.textResizeDetector.defaults={};a.textResizeDetector.prototype={id:"ResizeDetector",delay:800,create:function(){a("#"+this.id+"_text").remove();var d="position: absolute; padding: 0; left: -9999px; font-size:"+30+"px; line-height:"+30+"px;";var f="position: absolute; left: -9999px; width:10%; height:10%;";var b=a.create("span",{id:this.id+"_text",style:d,className:"write-protect"})[0];b.innerHTML="&nbsp;";var e=this.opts.target;e.appendChild(b);this.sizeT=30;return b},initialize:function(){this.create();this.check=window.setInterval(this.detect,this.delay)},detect:function(){var c=a("#ResizeDetector_text");if(!c.length){c=this.create()}var b=c.height();if(b!=this.sizeT){var d=30/b;a(document).trigger("textResize",d);this.sizeT=b;a(".fixedFontSize9").each(function(e){var g=Math.max(9*d,1);a(this).css({fontSize:g+"px",lineHeight:g+"px"})});a(".fixedFontSize11").each(function(e){var g=Math.max(11*d,1);a(this).css({fontSize:g+"px",lineHeight:g+"px"})});a(".fixedFontSize12").each(function(e){var g=Math.max(12*d,1);a(this).css({fontSize:g+"px",lineHeight:g+"px"})})}}}})(jQuery);(function(c){var a=c.scrollTo=function(f,e,d){c(window).scrollTo(f,e,d)};a.defaults={axis:"y",duration:1};a.window=function(d){return c(window).scrollable()};c.fn.scrollable=function(){return this.map(function(){var g=this.parentWindow||this.defaultView,e=this.nodeName=="#document"?g.frameElement||g:this,f=e.contentDocument||(e.contentWindow||e).document,d=e.setInterval;return e.nodeName=="IFRAME"||d&&c.browser.safari?f.body:d?f.documentElement:this})};c.fn.scrollTo=function(f,e,d){if(typeof e=="object"){d=e;e=0}if(typeof d=="function"){d={onAfter:d}}d=c.extend({},a.defaults,d);e=e||d.speed||d.duration;d.queue=d.queue&&d.axis.length>1;if(d.queue){e/=2}d.offset=b(d.offset);d.over=b(d.over);return this.scrollable().each(function(){var p=this,n=c(p),o=f,m,j={},q=n.is("html,body");switch(typeof o){case"number":case"string":if(/^([+-]=)?\d+(px)?$/.test(o)){o=b(o);break}o=c(o,this);case"object":if(o.is||o.style){m=(o=c(o)).offset()}}c.each(d.axis.split(""),function(v,x){var y=x=="x"?"Left":"Top",A=y.toLowerCase(),u="scroll"+y,r=p[u],s=x=="x"?"Width":"Height",z=s.toLowerCase();if(m){j[u]=m[A]+(q?0:r-n.offset()[A]);if(d.margin){j[u]-=parseInt(o.css("margin"+y))||0;j[u]-=parseInt(o.css("border"+y+"Width"))||0}j[u]+=d.offset[A]||0;if(d.over[A]){j[u]+=o[z]()*d.over[A]}}else{j[u]=o[A]}if(/^\d+$/.test(j[u])){j[u]=j[u]<=0?0:Math.min(j[u],g(s))}if(!v&&d.queue){if(r!=j[u]){k(d.onAfterFirst)}delete j[u]}});k(d.onAfter);function k(r){n.animate(j,e,d.easing,r&&function(){r.call(this,f,d)})}function g(s){var r="scroll"+s,u=p.ownerDocument;return q?Math.max(u.documentElement[r],u.body[r]):p[r]}}).end()};function b(d){return typeof d=="object"?d:{top:d,left:d}}})(jQuery);(function(d){d.fn.jqm=function(f){var e={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:q,ajaxText:"",target:q,modal:q,toTop:q,onShow:q,onHide:q,onLoad:q};return this.each(function(){if(this._jqm){return p[this._jqm].c=d.extend({},p[this._jqm].c,f)}r++;this._jqm=r;p[r]={c:d.extend(e,d.jqm.params,f),a:q,w:d(this).addClass("jqmID"+r),s:r};if(e.trigger){d(this).jqmAddTrigger(e.trigger)}})};d.fn.jqmAddClose=function(f){return o(this,f,"jqmHide")};d.fn.jqmAddTrigger=function(f){return o(this,f,"jqmShow")};d.fn.jqmShow=function(e){return this.each(function(){d.jqm.open(this._jqm,e)})};d.fn.jqmHide=function(e){return this.each(function(){d.jqm.close(this._jqm,e)})};d.jqm={hash:{},open:function(E,D){var v=p[E],x=v.c,m="."+x.closeClass,A=(parseInt(v.w.css("z-index"))),A=(A>0)?A:3000,f=d("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":A-1,opacity:x.overlay/100});if(v.a){return q}v.t=D;v.a=true;v.w.css("z-index",A);if(x.modal){if(!a[0]){n("bind")}a.push(E)}else{if(x.overlay>0){v.w.jqmAddClose(f)}else{f=q}}v.o=(f)?f.addClass(x.overlayClass).prependTo("body"):q;if(c){d("html,body").css({height:"100%",width:"100%"});if(f){f=f.css({position:"absolute"})[0];for(var B in {Top:1,Left:1}){f.style.setExpression(B.toLowerCase(),"(_=(document.documentElement.scroll"+B+" || document.body.scroll"+B+"))+'px'")}}}if(x.ajax){var e=x.target||v.w,C=x.ajax,e=(typeof e=="string")?d(e,v.w):d(e),C=(C.substr(0,1)=="@")?d(D).attr(C.substring(1)):C;e.html(x.ajaxText).load(C,function(){if(x.onLoad){x.onLoad.call(this,v)}if(m){v.w.jqmAddClose(d(m,v.w))}k(v)})}else{if(m){v.w.jqmAddClose(d(m,v.w))}}if(x.toTop&&v.o){v.w.before('<span id="jqmP'+v.w[0]._jqm+'"></span>').insertAfter(v.o)}(x.onShow)?x.onShow(v):v.w.show();k(v);return q},close:function(f){var e=p[f];if(!e.a){return q}e.a=q;if(a[0]){a.pop();if(!a[0]){n("unbind")}}if(e.c.toTop&&e.o){d("#jqmP"+e.w[0]._jqm).after(e.w).remove()}if(e.c.onHide){e.c.onHide(e)}else{e.w.hide();if(e.o){e.o.remove()}}return q},params:{}};var r=0,p=d.jqm.hash,a=[],c=d.browser.msie&&(d.browser.version=="6.0"),q=false,g=d('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),k=function(e){if(c){if(e.o){e.o.html('<p style="width:100%;height:100%"/>').prepend(g)}else{if(!d("iframe.jqm",e.w)[0]){e.w.prepend(g)}}}j(e)},j=function(f){try{d(":input:visible",f.w)[0].focus()}catch(e){}},n=function(e){d()[e]("keypress",b)[e]("keydown",b)[e]("mousedown",b)},b=function(s){var f=p[a[a.length-1]],m=(!d(s.target).parents(".jqmID"+f.s)[0]);if(m){j(f)}return !m},o=function(e,f,m){return e.each(function(){var u=this._jqm;d(f).each(function(){if(!this[m]){this[m]=[];d(this).click(function(){for(var v in {jqmShow:1,jqmHide:1}){for(var x in this[v]){if(p[this[v][x]]){p[this[v][x]].w[v](this)}}}return q})}this[m].push(u)})})}})(jQuery);(function(a){a.jGrowl=function(b,c){if(a("#jGrowl").size()==0){a('<div id="jGrowl"></div>').addClass(a.jGrowl.defaults.position).appendTo(a.jGrowl.defaults.appendTo)}a("#jGrowl").jGrowl(b,c)};a.fn.jGrowl=function(b,d){if(a.isFunction(this.each)){var c=arguments;return this.each(function(){var e=this;if(a(this).data("jGrowl.instance")==undefined){a(this).data("jGrowl.instance",new a.fn.jGrowl());a(this).data("jGrowl.instance").startup(this)}if(a.isFunction(a(this).data("jGrowl.instance")[b])){a(this).data("jGrowl.instance")[b].apply(a(this).data("jGrowl.instance"),a.makeArray(c).slice(1))}else{a(this).data("jGrowl.instance").notification(b,d)}})}};a.extend(a.fn.jGrowl.prototype,{defaults:{header:"",sticky:false,position:"top-right",glue:"after",theme:"default",corners:"10px",check:500,life:3000,speed:"normal",easing:"swing",closer:true,closerTemplate:"<div>[ close all ]</div>",log:function(c,b,d){},beforeOpen:function(c,b,d){},open:function(c,b,d){},beforeClose:function(c,b,d){},close:function(c,b,d){},appendTo:"body",animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},element:null,interval:null,notification:function(c,e){var b=this;var e=a.extend({},this.defaults,e);e.log.apply(this.element,[this.element,c,e]);var d=a('<div class="jGrowl-notification"><div class="close">&times;</div><div class="header">'+e.header+'</div><div class="message">'+c+"</div></div>").data("jGrowl",e).addClass(e.theme).children("div.close").bind("click.jGrowl",function(){a(this).unbind("click.jGrowl").parent().trigger("jGrowl.beforeClose").animate(e.animateClose,e.speed,e.easing,function(){a(this).trigger("jGrowl.close").remove()})}).parent();(e.glue=="after")?a("div.jGrowl-notification:last",this.element).after(d):a("div.jGrowl-notification:first",this.element).before(d);a(d).bind("mouseover.jGrowl",function(){a(this).data("jGrowl").pause=true}).bind("mouseout.jGrowl",function(){a(this).data("jGrowl").pause=false}).bind("jGrowl.beforeOpen",function(){e.beforeOpen.apply(b.element,[b.element,c,e])}).bind("jGrowl.open",function(){e.open.apply(b.element,[b.element,c,e])}).bind("jGrowl.beforeClose",function(){e.beforeClose.apply(b.element,[b.element,c,e])}).bind("jGrowl.close",function(){e.close.apply(b.element,[b.element,c,e])}).trigger("jGrowl.beforeOpen").animate(e.animateOpen,e.speed,e.easing,function(){a(this).data("jGrowl").created=new Date()}).trigger("jGrowl.open");if(a.fn.corner!=undefined){a(d).corner(e.corners)}if(a("div.jGrowl-notification:parent",this.element).size()>1&&a("div.jGrowl-closer",this.element).size()==0&&this.defaults.closer!=false){a(this.defaults.closerTemplate).addClass("jGrowl-closer").addClass(this.defaults.theme).appendTo(this.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){a(this).siblings().children("div.close").trigger("click.jGrowl");if(a.isFunction(b.defaults.closer)){b.defaults.closer.apply(a(this).parent()[0],[a(this).parent()[0]])}})}},update:function(){a(this.element).find("div.jGrowl-notification:parent").each(function(){if(a(this).data("jGrowl")!=undefined&&a(this).data("jGrowl").created!=undefined&&(a(this).data("jGrowl").created.getTime()+a(this).data("jGrowl").life)<(new Date()).getTime()&&a(this).data("jGrowl").sticky!=true&&(a(this).data("jGrowl").pause==undefined||a(this).data("jGrowl").pause!=true)){a(this).children("div.close").trigger("click.jGrowl")}});if(a(this.element).find("div.jGrowl-notification:parent").size()<2){a(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){a(this).remove()})}},startup:function(b){this.element=a(b).addClass("jGrowl").append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){jQuery(b).data("jGrowl.instance").update()},this.defaults.check);if(a.browser.msie&&parseInt(a.browser.version)<7){a(this.element).addClass("ie6")}},shutdown:function(){a(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval)}});a.jGrowl.defaults=a.fn.jGrowl.prototype.defaults})(jQuery);(function(a){a.aqCookie={domain:"",secToExpire:3153600000,get:function(b){if(typeof b=="string"){b=[b]}var g=[];var d=document.cookie.split(";");for(var f=0;f<d.length;f++){var m=d[f];while(m.charAt(0)==" "){m=m.substring(1,m.length)}for(var e=0;e<b.length;e++){var k=b[e]+"=";if(m.indexOf(k)==0){g[b[e]]=m.substring(k.length,m.length)}}}return g},set:function(c,b){if(b){var d=new Date();d.setTime(d.getTime()+a.aqCookie.secToExpire);document.cookie=c+"="+b+"; path=/; domain="+a.aqCookie.domain+"; expires="+d.toGMTString()+'";'}else{document.cookie=c+"=; path=/; domain="+a.aqCookie.domain+"; expires=Thu, 01-Jan-1970 00:00:01 GMT;"}},all:function(f){var g=[];var b=document.cookie.split(";");var e=new RegExp(f);for(var d=0;d<b.length;d++){var j=b[d];while(j.charAt(0)==" "){j=j.substring(1,j.length)}if(!j.match(e)){continue}g.push(j.substring(0,j.indexOf("=")))}return g},del:function(b){a.aqCookie.set(b)}}})(jQuery);(function(a){a.simpleXpath=function(b,e){var g=b.split("/text()");b=g[0];var j=g[1].replace(/[\[\]]/g,"");b=b.replace(/\.\//g,">");b=b.replace(/\//g,">");var f=b.split(/[\[\]]/);for(var d=0,c=f.length;d<c;d++){if(Number(f[d])>0){f[d]=":eq("+(f[d]-1)+")"}}b=f.join("");return a(e+b).textNodes(true)[j]}})(jQuery);eMend.dictionary={comment:{delete_note_H:"Elimina questo commento",edit_note_H:"Modifica questo commento",author:"autore",baseURI:"images"},comment_more:{read_more:"Espandi il testo",read_less:"Riduci il testo",baseURI:"images"},commentForm:{comment:"commento",note:"nota",subject:"oggetto",cancel:"annulla",confirm:"conferma",tags:"tags"},commentGroup:{read_more:"Espandi il gruppo",read_less:"Riduci il gruppo",comment:"commento",comments:"commenti",baseURI:"images"},commentTrigger:{select_text:"seleziona il testo che vuoi commentare",activate_comment:"premi 'C' per commentare il testo selezionato",write_comment:"scrivi nel commento ci&ograve; che pensi",disable_HOL:"non mostrare pi&ugrave; i messaggi di aiuto",outside_boudaries:"la selezione &egrave; fuori dall'area commentabile",login_needed:"per inviare un commento &egrave; necessario il login"},sidebar:{hidelink:"Nascondi collegamento visuale",showlink:"Mostra collegamento visuale",baseURI:""}};(function(a){eMend.users=function(b){if(!(this instanceof arguments.callee)){return new eMend.users(b)}this.opts=a.extend({},eMend.users.defaults,b);this._currentUser=null};eMend.users.defaults={};eMend.users.prototype={login:function(b,c){this._currentUser=c.name;this.opts.dataset.loginAs(this._currentUser)},logout:function(){this._currentUser=null},getCurrentUser:function(){return this._currentUser}}})(jQuery);(function(a){eMend.templates={comment:'<div class="actions"><a href="#" title="_(delete_note_H)" class="deletenote" onclick="return false;">&nbsp;</a><a href="#" title="_(edit_note_H)" class="editnote" onclick="return false;">&nbsp;</a></div><h6><img src="_(baseURI)/user${userIdx}.png" /><strong>${author}</strong> [${date}]:</h6><h5>${title}</h5><p><span class="commentbody">${body}</span></p>',comment_more:'...<img src="_(baseURI)/more.png" alt="_(readmore)" class="readmore" /><img src="_(baseURI)/less.png" alt="_(readless)" class="readless" style="display:none;" />',commentForm:'<form id="noteForm" class="Emend" onsubmit="return false; void(0);" style="background-image: url(_(baseURI)/bg-fff-diag.gif);"><fieldset><legend>_(comment)</legend><p><label for="noteSubject">_(subject):</label><span><input type="text" id="noteSubject" name="noteSubject" size="29" /></span><br/></p><p><label for="noteText">_(note):</label><span><textarea id="noteText" name="noteText" cols="28" rows="10" ></textarea></span><br class="clear"/></p><!--<p><label for="noteTags">_(tags):</label><span><input type="text" id="noteTags" name="noteTags" size="29" /></span><br/></p>--><p class="Emend-right"><button type="button" class="submit" id="submitNote" onclick="return false; void(0);" style="background: #FFFFFF url(_(baseURI)/bg_form_element.png) repeat-x;"><span class="ico confirm">_(confirm)<img src="_(baseURI)/ico-confirm.png" /></span></button></p><p class="Emend-left"><button type="button" class="submit" id="cancelNote" onclick="return false; void(0);" style="background: #FFFFFF url(_(baseURI)/bg_form_element.png) repeat-x;"><span class="ico cancel"><img src="_(baseURI)/ico-cancel.png" />_(cancel)</span></button></p></fieldset></form>',commentGroup:'<span><div class="nodetoggle"><img src="_(baseURI)/less_big.png" alt="_(readless)" class="closegroup"><img src="_(baseURI)/more_big.png" title="_(readmore)" class="opengroup" /></div></span>',commentTrigger:'<ul class="lavalamp"><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/selectText.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(select_text)</span></h2></div><label><input type="checkbox" class="emendHideHOL"/>_(disable_HOL)</label></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/pressC.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(activate_comment)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/chat.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(write_comment)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/selectText.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(outside_boudaries)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><img src="_(baseURI)/password.png"/><h2 class="helpOnLine"><span class="pulse" unselectable="on">_(login_needed)</span></h2></div></li></ul>',sidebar:'<div class="sidebar-Y-header"><img src="_(baseURI)/ico-arrow-left.png" class="opensidebar" /><p class="version">0.3<br/>&beta;4</p><img src="_(baseURI)/emend-vertical.png" alt="e-mend"/></div><div class="sidebar-wrapper"><div class="sidebar-X-header"><!--<div class="extendsidebar"></div>--><img src="_(baseURI)/ico-arrow-right.png" class="closesidebar" /><img src="_(baseURI)/emend-horizontal.png" class="logo" alt="e-mend"/><sup class="version">0.3&beta;4</sup></div><div id="sidebar-body"></div><div id="memefarmers"><a href="http://memefarmers.net"><img src="_(baseURI)/memefarmers.png" /></a></div></div>'}})(jQuery);(function(a){eMend.dataset=function(b){if(!(this instanceof arguments.callee)){return new eMend.dataset(b)}this.opts=a.extend({},eMend.dataset.defaults,b);this._selections=[];this._comments=[];this._users=[];this._usersByName={};this._currentUser=-1;this._notesByDate={};this._notesFirstDate=null;this._notesLastDate=null;this._timeRange=[];this._filteredNodes={};this._nodeCommentsCount={};this._contentBkp=[];this.bkpContent(this.opts.target);this._contentEl=this.opts.target;this.initNodeFilters(this.opts.target,false);this.loginAsGuest()};eMend.dataset.defaults={};eMend.dataset.prototype={getContentEl:function(){return this._contentEl},getTimeRange:function(){if(!this._timeRange.length){this.initTimeRangeFilters()}return this._timeRange},getNotesFirstDate:function(){if(!this._notesFirstDate){this.updateNotesByDate()}return this._notesFirstDate},getNotesLastDate:function(){if(!this._notesLastDate){this.updateNotesByDate()}return this._notesLastDate},getSelections:function(){return this._selections},getComments:function(){return this._comments},getComment:function(b,c){return this._comments[b][c]},getCommentData:function(b,d){var e=this._comments[b][d];return{title:e[0],body:e[1],date:e[2],userIdx:b}},getCommentElement:function(b,d){var e=this._comments[b][d];return e.getElement()},getCurrentUser:function(){return this._currentUser},setCurrentUser:function(b){if(typeof b=="number"){this._currentUser=b}},getFilteredNodes:function(){return this._filteredNodes},getRawNodeMap:function(){return this.mapNodes(this._contentEl)},getMarkedNodeMap:function(){return this.markNodeMap()},bkpContent:function(b){this._contentBkp=[];if(this.opts.datastore){if(a("#eMend-content-backup").length==0){this.bkpContentOnDOM(b)}else{this.restoreContentFromDOM(b)}}var e=b.childNodes,f,g;for(var d in e){f=e[d];if(!f.nodeType||a(f).hasClass("write-protect")){continue}switch(f.nodeType){case 1:case 3:g=f.cloneNode(true);this._contentBkp.push(g);break}}},restoreContent:function(){var e=this._contentEl;var f=e.childNodes,g,c=this._contentBkp,j=0;while(f.length-j){if(a(e.firstChild).hasClass("write-protect")){j++;continue}e.removeChild(e.firstChild)}for(var d=c.length-1;d>-1;d--){e.insertBefore(c[d].cloneNode(true),e.firstChild)}document.body.normalize()},bkpContentOnDOM:function(c){var b=a.create("div",{id:"eMend-content-backup"});a(this.opts.datastore).append(b);var d=c.cloneNode(true);a(d).find("*[id]").each(function(){a(this)[0].id+="__bkp__"});b[0].innerHTML=d.innerHTML},restoreContentFromDOM:function(d){var c=a("#eMend-content-backup")[0];var e=c.cloneNode(true);a(e).find("*[id]").each(function(){var b=a(this)[0].id;a(this)[0].id=b.substr(0,b.indexOf("__bkp__"))});d.innerHTML=e.innerHTML;document.body.normalize()},addComment:function(m,n,o){if(typeof o=="undefined"){o=this._currentUser}var k=new Date();var f=k.format(Date.ISO8601c);var c=this._comments[o].length;var e=this._users[o];m=a.escapeReturns(m);n=a.escapeReturns(n);var j=0;var b={author:e,title:m,body:n,date:f,userIdx:o,noteIdx:c};var g=this._comments[o].push(new eMend.comment(b,{animate:false}));this.insertNoteByDate(f,o,g-1);this.lastComment={user:o,idx:g-1};a(document).trigger("emend.addComment");return(g-1)},modifyComment:function(f,m,e,g){var k=this._comments[e][g];var j=new Date();var c=j.format(Date.ISO8601c);var b=k[4];this._comments[e][g]=[f,m,c,m.length,b]},getLastComment:function(){return this._comments[this.lastComment.user][this.lastComment.idx]},remapSelectionToContent:function(n){var b=n.startContainer.parentNode,j=n.endContainer.parentNode,d=a(b).attr("node"),e=a(b).attr("fragment")||0,k=a(j).attr("node"),f=a(j).attr("fragment")||0;var m=e==0?n.startOffset:this._markedNodeMap.fM[d][e-1][1]+n.startOffset;var g=f==0?n.endOffset:this._markedNodeMap.fM[k][f-1][1]+n.endOffset;this.restoreContent();var c=a(this._contentEl).textNodes(true);return{startContainer:c[d],endContainer:c[k],startOffset:m,endOffset:g}},addSelection:function(n){if(typeof n=="undefined"){n=this._currentUser}var m=a.getSelection(true);switch(m.startContainer.parentNode.tagName){case"NODEBLOCK":case"NODEINNER":m=this.remapSelectionToContent(m);break}var g=a(m.startContainer).parents("*[id]");g=g[0]?g[0]:document.body;var j=g.id?g.id:"__noId__";var k=a(m.startContainer).generateXPath({context:g});var b=[m.startOffset,m.endOffset,{xpath:k,base:j}];if(m.startContainer!=m.endContainer){var f=a(m.endContainer).parents("*[id]");f=f[0]?f[0]:document.body;var d=f.id?f.id:"__noId__";var e=a(m.endContainer).generateXPath({context:f});b.push({xpath:e,base:d})}var c=this._selections[n].push(b);this.lastSelection={user:n,idx:c-1}},getLastSelection:function(){return this._selections[this.lastSelection.user][this.lastSelection.idx]},removeLastSelection:function(){this._selections[this.lastSelection.user].splice(this.lastSelection.idx,1)},addUser:function(c){this._selections.push([]);this._comments.push([]);var b=this._users.push(c);this._usersByName[c]=b-1;return(b-1)},removeUser:function(b){if(b>0){this._selections.splice(b,1);this._comments.splice(b,1);this._users.splice(b,1)}},getUser:function(b){return this._users[b]},getOrCreateUser:function(b){var c=this._usersByName[b];if(c>=0){return c}return this.addUser(b)},loginAsGuest:function(){this.removeUser(this._currentUser);this._author="guest";this._authorHash="Sandbox";this._password="guest";this.addUser("guest");this._currentUser=0},loginAs:function(b){this._author=b;this._currentUser=this.addUser(b)},importEmendment:function(e,f){f.selection=e;var b=this.getOrCreateUser(f.author);f.userIdx=b;var d=this._selections[b].push(e);f.noteIdx=d-1;this.lastSelection={user:b,idx:d-1};var g=this._comments[b].push(new eMend.comment(f));this.lastComment={user:b,idx:g-1};this.insertNoteByDate(f.date,b,g-1)},initTimeRangeFilters:function(){if(!this.notesFirstDate){var c=new Date();var b=c.format(c,"%Y%%m%%d%");this._notesFirstDate=b;this._notesLastDate=b}this._timeRange[0]=this._notesFirstDate;this._timeRange[1]=this._notesLastDate},setTimeRangeFilter:function(c,b){this._timeRange[0]=Number(c);this._timeRange[1]=Number(b)},updateNotesByDate:function(){var n,e,j,c,f,b,m,g;n=new Date();e=n.format("%Y%%m%%d%");this._notesFirstDate=e;this._notesLastDate=e;j=this._notesByDate={};for(c=0,m=this._comments.length;c<m;c++){g=this._comments[c];for(f=0,b=g.length;f<b;f++){e=Number(g[f][2].substr(0,8));if(!j[e]){j[e]=[]}j[e].push(c+"_"+f);this._notesFirstDate=Math.min(e,this._notesFirstDate);this._notesLastDate=Math.max(e,this._notesLastDate)}}},insertNoteByDate:function(b,c,d){b=Number(b.substr(0,8));if(!this._notesByDate[b]){this._notesByDate[b]=[]}this._notesByDate[b].push(c+"_"+d);this._notesFirstDate=Math.min(b,this._notesFirstDate);this._notesLastDate=Math.max(b,this._notesLastDate)},mapNodes:function(c){var b=[];var j=[];var k=[];function g(n){switch(n.parentNode.tagName){case"SCRIPT":case"NOSCRIPT":return NodeFilter.FILTER_REJECT;break}return NodeFilter.FILTER_ACCEPT}function f(n){b.push(n);j.push([n.nodeValue]);k.push([[0,n.nodeValue.length,[]]])}function d(n){switch(n.parentNode.tagName){case"SCRIPT":case"NOSCRIPT":return;break}b.push(n);j.push([n.nodeValue]);k.push([[0,n.nodeValue.length,[]]])}if(document.createTreeWalker&&jQuery.browser.mozilla){function e(n){var p=n.currentNode;for(var o=n.firstChild();o!=null;o=n.nextSibling()){f(o);e(n)}n.currentNode=p}var m=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,g,false);e(m);m=null}else{a(document.body).textNodes(true).each(function(){d(this)})}this._rawNodeMap={n:b,f:j,fM:k};return this._rawNodeMap},markNodeMap:function(){var W=this._selections,C=this._comments,G=this.getRawNodeMap();var L=G.n,J=G.f,b=G.fM;var y=this.getTimeRange();var g,f,O,X,Y,d,K,N,P,ab,Z,H,U,n,R,I;var c,aa,F,Q;var x=document.evaluate?0:1;for(var M=0,v=W.length;M<v;M++){g=W[M];f=C[M];for(var V=0,s=g.length;V<s;V++){X=Number(f[V].getISO8601c());if(X<y[0]||X>y[1]){continue}O=g[V];Y=O[0];d=O[1];K=O[2];N=O[3]?O[3]:O[2];switch(x){case 0:Z=K.base=="__noId__"?document.body:document.getElementById(K.base);H=N.base=="__noId__"?document.body:document.getElementById(N.base);P=document.evaluate(K.xpath,Z,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;ab=document.evaluate(N.xpath,H,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;break;case 1:Z=K.base=="__noId__"?"body":"#"+K.base;H=N.base=="__noId__"?"body":"#"+N.base;P=a.simpleXpath(K.xpath,Z);ab=a.simpleXpath(N.xpath,H);break}U=n=-1;for(var T=0,q=L.length;T<=q;T++){if(P==L[T]){U=T}if(ab==L[T]){n=T}if(U!=-1&&n!=-1){break}}if(U==-1||n==-1){continue}var o=J[U];var m=J[n];var A=b[U];var B=b[n];R=I=-1;for(var T=0,q=A.length;T<q;T++){if(R==-1&&Y>=A[T][0]&&Y<=A[T][1]){R=T;break}}for(var T=0,q=B.length;T<q;T++){if(I==-1&&d>=B[T][0]&&d<=B[T][1]){I=T;break}}if(I==-1){I=T-1}var p=o[R];var D=b[U][R];c=p.slice(0,Y-D[0]);if(c.length){o[R]=p.slice(Y-D[0]);o.splice(R,0,c);F=D[0];D[0]=Y;b[U].splice(R,0,[F,Y-1,D[2].slice(0)]);R++;if(U==n){I++}}var e=m[I];var E=b[n][I];aa=e.slice(d-E[0]);if(aa.length){m[I]=e.slice(0,d-E[0]);m.splice(I+1,0,aa);Q=E[1];E[1]=d;b[n].splice(I+1,0,[d,Q,E[2].slice(0)])}for(var T=U;T<=n;T++){var z=T==U?R:0;var ac=T==n?I+1:b[T].length;for(var S=z;S<ac;S++){b[T][S][2].push(M+"_"+V)}}}}this._markedNodeMap={n:L,f:J,fM:b};return this._markedNodeMap},initNodeFilters:function(d,c){var e=this.mapNodes(d);for(var b=0;b<e.n.length;b++){c?this.addNodeFilter(b):this.removeNodeFilter(b)}},filterAllNodes:function(){for(node in this._filteredNodes){this.addNodeFilter(node)}},unfilterAllNodes:function(){for(node in this._filteredNodes){this.removeNodeFilter(node)}},addNodeFilter:function(b){this._filteredNodes[b]=true},removeNodeFilter:function(b){this._filteredNodes[b]=false},toggleNodeFilter:function(m,g){var c=m.target;var d=emendARRAYutils.createFromWords(c.getAttribute("relNodes"));for(var j=0,k=d.length;j<k;j++){var n=d[j];var f=this._filteredNodes[n]=!this._filteredNodes[n];var b=document.getElementById("block"+n);b.setAttribute("hidenotes",f)}var f=this._filteredNodes[g];c.className="cMark_"+f+" fixedFontSize9";this.clearLinks();if(f){Emend.events.Notes.fadeNodeNotes.fire(c)}else{Emend.events.Notes.appearNodeNotes.fire(c)}}}})(jQuery);(function(a){eMend.highlight=function(s){var z=s.getMarkedNodeMap(),y=z.n,H=z.f,G=z.fM,v,u,g,x,F,B;var E=s.getFilteredNodes();for(var D=0,q=y.length;D<q;D++){var p=E[D];var A=y[D];var d=H[D];var r=G[D];var b=A.parentNode;var e=document.createElement("NODEBLOCK");e.id="block"+D;e.className="emend-block";e.setAttribute("hidenotes",p);e.setAttribute("node",D);var n=[];for(var C=0,o=d.length;C<o;C++){u=d[C];g=r[C];v=document.createElement("NODEINNER");v.setAttribute("node",D);v.setAttribute("fragment",C);if(g[2].length){n=n.concat(arrDiff(n,g[2]));B=Math.min(g[2].length,40);x=g[2].length+" comments";F="highlight n"+g[2].join(" n")+" a"+B;v.setAttribute("title",x);v.className=F}v.appendChild(document.createTextNode(u));e.appendChild(v)}b.replaceChild(e,A)}a(document).trigger("emend.highlight")}})(jQuery);(function(a){eMend.comment=function(d,c){if(d){this.data=d;this.data.textlength=d.body.length;var b=eMend.comment.defaults.shortlength;if(this.data.textlength>b){this.data.shorttext=d.body.substr(0,b)+"..."}}this.opts=a.extend({},eMend.comment.defaults,c);this.template=a.template(eMend.templates.comment,{regx:"gettext"}).apply(eMend.dictionary.comment);this.templateMore=a.template(eMend.templates.comment_more,{regx:"gettext"}).apply(eMend.dictionary.comment_more)};eMend.comment.defaults={shortlength:100,animate:true};eMend.comment.prototype={getElement:function(d){if(!this.element){var e=this.data.userIdx+"_"+this.data.noteIdx;var b=a.template(this.template).apply(this.data);var c=a.create("div",{id:"note"+e,note:e,className:d})[0];c.innerHTML=b;this.element=c}a(this.element).mouseover(this.over).mouseout(this.out);this.morelesstext(a(this.element).find(".commentbody")[0]);return this.element},getISO8601c:function(){return this.data.date.substr(0,8)},hide:function(){return this.opts.animate?a(this.element).slideUp(200):a(this.element).hide()},show:function(){return this.opts.animate?a(this.element).slideDown(200):a(this.element).show()},over:function(){var b=".n"+this.id.substr(4);a(b).css({borderTop:"1px dashed red",borderBottom:"1px dashed red"})},out:function(){var b=".n"+this.id.substr(4);a(b).css({borderTop:"none",borderBottom:"none"})},morelesstext:function(c){var b=c.firstChild;if(b&&b.nodeType==3&&b.length>150){var d=a(c);d.attr("fulltext",b.data);d.html(b.data.substr(0,150)+this.templateMore);d.click(this.toggleText)}},toggleText:function(c){var d=a(this);var b=d.children(".readmore, .readless").toggle();if(d.attr("fulltext")){d.attr("shorttext",d[0].firstChild.data);d[0].firstChild.data=d.attr("fulltext");d.removeAttr("fulltext")}else{d.attr("fulltext",d[0].firstChild.data);d[0].firstChild.data=d.attr("shorttext");d.removeAttr("shorttext")}}}})(jQuery);(function(a){eMend.commentGroup=function(b){this.data=b;this.comments=[];this.template=a.template(eMend.templates.commentGroup,{regx:"gettext"}).apply(eMend.dictionary.commentGroup)};eMend.commentGroup.prototype={getElement:function(){if(!this.element){var d=this.data.nodeGroup;var c=this.data.nodeClass;this.element=a.create("div",{id:"noteGroup"+d,"class":c,node:d})[0];this.element.innerHTML=this.template;this.counter=a.create("h6",{unselectable:"on"})[0];this.element.appendChild(this.counter);var b=this;a(this.counter).click(function(){var e=a(this).parent().find(".emend-note").get(0);var f=a(e).attr("note");a(window).scrollTo(".n"+f,{duration:500,easing:"swing"})});a(this.element).find(".closegroup, .opengroup").click(function(){b.toggleGroup(b.element)})}return this.element},updateCounter:function(b){var c=b>1?b+" "+eMend.dictionary.commentGroup.comments:b+" "+eMend.dictionary.commentGroup.comment;a(this.counter).text(c);b=Math.min(b,40);this.counter.className="a"+b+" emendGroupTitle"},appendChild:function(b){this.comments.push(b);this.updateCounter(this.comments.length);this.element.appendChild(b)},prependChild:function(c){this.comments.unshift(c);var b=this.comments.length;this.updateCounter(b);if(b>1){this.element.insertBefore(c,this.comments[1])}else{this.element.appendChild(c)}},toggleGroup:function(b){a(b).children(".emend-note").toggle();a(b).toggleClass("readfull").toggleClass("readpart");a(document).trigger("emend.toggleGroup")},closeGroup:function(){a(this.element).addClass("readpart").removeClass("readfull")},openGroup:function(){a(this.element).addClass("readfull").removeClass("readpart")}}})(jQuery);(function(a){eMend.commentForm=function(b){if(!(this instanceof arguments.callee)){return new eMend.commentForm(b)}this.opts=a.extend({},eMend.commentForm.defaults,b);this.dataset=this.opts.dataset;this.active=false;this.template=a.template(eMend.templates.commentForm,{regx:"gettext"}).apply(eMend.dictionary.commentForm);this.create()};eMend.commentForm.defaults={};eMend.commentForm.prototype={create:function(){var d=a("#NoteFormContainer").remove()[0];if(!d){var c=a.template(this.template).apply(this.data);d=a.create("div",{id:"NoteFormContainer",className:"jqmWindow340 write-protect"})[0];d.innerHTML=c}a(this.opts.target).append(d);var b=this;a("#cancelNote").click(function(){b.cancel()});a("#submitNote").click(function(){b.submit()})},show:function(){this.active=true;this.dataset.addSelection();if(!a("#NoteFormContainer")[0]){this.create()}a("#noteSubject").attr("value","");a("#noteText").attr("value","");a("#NoteFormContainer").jqm({modal:true}).jqmShow();window.focus();a("#noteSubject")[0].focus()},submit:function(){var e=a("#noteSubject").attr("value");var d=a("#noteText").attr("value");var c=this.check(e,d);if(c){a("#NoteFormContainer").jqmHide();var b=this.dataset.addComment(e,d);this.active=false}},cancel:function(){this.dataset.removeLastSelection();a("#NoteFormContainer").jqmHide();this.active=false},check:function(c,e,b){var d=true;if(c==""){a("#noteSubject").addClass("warning");d=false}else{a("#noteSubject").removeClass("warning")}if(e==""){a("#noteText").addClass("warning");d=false}else{a("#noteText").removeClass("warning")}return d},isActive:function(){return this.active}}})(jQuery);(function(a){eMend.commentTrigger=function(c){if(!(this instanceof arguments.callee)){return new eMend.commentTrigger(c)}this.opts=c;if(!this.opts.hideHOL){var d=false;if(window.hideHOL){d=window.hideHOL}else{if(document.location.href.indexOf("emendDisableHOL")!=-1){d=true}else{if(document.location.href.indexOf("emendEnableHOL")!=-1){d=false;a.aqCookie.del("hideHOL")}else{d=a.aqCookie.get("hideHOL")==true?true:false}}}this.opts.hideHOL=d}this.notifications=[];this.status=null;var b=this;a(document).mouseup(function(e){window.setTimeout(function(){var f=a.getSelectedText();if(!b.opts.form.isActive()&&f&&f.length){if(eMend.config.comment_target){var k=a.getSelection();var j=a(k.startContainer).parents(eMend.config.comment_target);var g=a(k.endContainer).parents(eMend.config.comment_target);if(eMend.config.login_needed_to_post&&b.opts.users.getCurrentUser()==null){b.show(4,1000);a(document).unbind("keyup.commentTrigger");a(document).unbind("keydown.commentTrigger")}else{if(j.length&g.length){b.show(1,1000)}else{b.show(3,1000);a(document).unbind("keyup.commentTrigger");a(document).unbind("keydown.commentTrigger")}}}else{b.show(1,1000)}}else{b.show(0,1000)}},10)});this.template=a.template(eMend.templates.commentTrigger,{regx:"gettext"}).apply(eMend.dictionary.commentTrigger);this.create()};eMend.commentTrigger.prototype={create:function(){var b=a("#HOLteaser").remove();if(!b.length){b=a.create("div",{id:"HOLteaser",style:"cursor: pointer;"});b[0].innerHTML=this.template}this.opts.target.appendChild(b[0]);a(b).find("li").hide();return b},show:function(f,d){if(this.status==f){return}var b=this;window.clearTimeout(this.timeOut);a(".eMend-jGrowl div.close").trigger("click.jGrowl");var c=a("#HOLteaser").find("li")[f];var e=this.opts.sidebar.isOpen()==false?"bottom-right":"bottom-left";a.jGrowl.defaults.closer=false;a.jGrowl.defaults.position=e;if(!this.opts.hideHOL){this.timeOut=window.setTimeout(function(){a.jGrowl(c.innerHTML,{theme:"eMend-jGrowl",life:6000,position:e});a(".emendHideHOL").click(function(){b.opts.hideHOL=true;a.aqCookie.set("hideHOL","true")})},500)}this.status=f;b.isCtrl=false;a(document).bind("keyup.commentTrigger",function(g){if(g.which==17){b.isCtrl=false}if(g.which==67&&b.isCtrl==false){g.stopPropagation();b.activate()}}).bind("keydown.commentTrigger",function(g){if(g.which==17){b.isCtrl=true}})},hide:function(c,b){a(document).unbind("keyup.commentTrigger");a(document).unbind("keydown.commentTrigger")},activate:function(){if(this.status!=2){this.hide();this.show(2);this.opts.form.show()}}}})(jQuery);(function(a){eMend.linker=function(b){if(!(this instanceof arguments.callee)){return new eMend.linker(b)}this.opts=a.extend({},eMend.linker.defaults,b);this.noteReferences=[];this.hiddenNodeLinks={};this.lastScrollInfo={x:0,y:0};this.destroyCanvas()};eMend.linker.defaults={};eMend.linker.prototype={createCanvas:function(e){var b=this.containerWidth=a(window).width()-20,d=this.containerHeight=a(window).height(),f=a(window).scrollTop(),c=a("#EmendLinks");if(e&&c.length){c.attr("width",b);c.attr("height",d);c[0].style.top=f+"px"}else{c=a.create("canvas",{id:"EmendLinks","class":"EmendOverlay",height:d,width:b})[0];c.style.top=f+"px";a(this.opts.target).append(c);if(a.browser.msie){G_vmlCanvasManager.initElement(c);c=document.getElementById("EmendLinks")}this.canvas=c;this.ctx=c.getContext("2d");this.ctx.lineWidth=1;a(c).click(this.hideLinks)}this.ctx.strokeStyle="#09f"},destroyCanvas:function(){a("#EmendLinks").remove()},hideLinks:function(){a("#EmendLinks").hide();a(this).trigger("emend.hidelinks");this._linksVisible=false},showLinks:function(){a("#EmendLinks").show();this._linksVisible=true},refreshLinks:function(b){this.createCanvas(true);this.clearLinks();this.renderLinks();if(!b){this.canvas.style.display="block"}},clearLinks:function(){if(this.canvas){this.canvas.getContext("2d").clearRect(0,0,this.containerWidth,this.containerHeight)}this._linksVisible=false},renderLinks:function(){var s=this.ctx,n={},k=this.opts.positions.getReferences(),d={x:a(window).scrollLeft(),y:a(window).scrollTop()},c=a.browser.opera&&a.browser.version>=9.5?12:5,g,j,f,m,p,r,e,q,b,o;for(j in k){f=a("#note"+j);p=k[j];g=p.node;if(this.hiddenNodeLinks[g]){continue}if(!f.length||f[0]&&f[0].style.display=="none"){if(n[g]){continue}n[g]=true;f=a("#noteGroup"+g)}m=a(f).offset({lite:true});r=p.left-d.x;e=p.top-d.y;q=e+c;b=m.left-d.x;o=m.top-d.y+8;s.beginPath();s.moveTo(r,e);s.lineTo(r,q);s.lineTo(b-25,q);s.lineTo(b-4,o);s.lineTo(b,o);s.stroke()}}}})(jQuery);(function(a){eMend.sidebar=function(b){if(!(this instanceof arguments.callee)){return new eMend.sidebar(b)}this.opts=a.extend({},eMend.sidebar.defaults,b);this.status="closed";this.template=a.template(eMend.templates.sidebar,{regx:"gettext"}).apply(eMend.dictionary.sidebar);this.create()};eMend.sidebar.defaults={body_open:"280px",body_closed:"27px"};eMend.sidebar.prototype={create:function(){var d=a("#eMend-sidebar")[0],c=a(window).height();if(!d){d=a.create("div",{id:"eMend-sidebar",style:"right: 0px; top: 0; height: "+c+"px;",unselectable:"on",className:this.status})[0];d.innerHTML=this.template;a(this.opts.target).append(d)}else{d.style.height=c+"px";this.status=a(d).attr("className")}var b=this;a(window).wresize(function(){b.refreshHeight()});a(document.body).css({marginRight:eMend.sidebar.defaults["body_"+this.status]});a(d).find(".sidebar-Y-header").click(function(){b.open()});a(d).find(".closesidebar").click(function(){b.close()});this.container=d},getContainer:function(){return a(this.container).find("#sidebar-body")[0]},destroy:function(){var b=a("eMend-sidebar");if(b){b.remove();delete this.container}},open:function(){a(".sidebar-wrapper").animate({right:"0"},500,"swing",function(){a(document.body).css({marginRight:"280px"});a(".sidebar-Y-header").css({right:"-60px"});a(document).trigger("emend.opensidebar")});a("#eMend-sidebar").attr("className","open");this.status="open";window.setTimeout(function(){a("#memefarmers").animate({bottom:"-20px"},1000,"swing")},3000)},close:function(){a(document.body).css({marginRight:"27px"});a(document).trigger("emend.closesidebar");a(".sidebar-wrapper").animate({right:"-260px"},500,"swing",function(){a(".sidebar-Y-header").css({right:"-280px"});a(".sidebar-Y-header").animate({right:"0"},500,"swing",function(){a(".sidebar-Y-header").css({bottom:"0"})})});a("#eMend-sidebar").attr("className","closed");this.status="closed"},extend:function(){a("#eMend-sidebar").css({width:"520px"});a(".sidebar-wrapper").animate({width:"520px"},500,"swing",function(){a(document.body).css({marginRight:"540px"});a(document).trigger("emend.opensidebar")})},refreshHeight:function(){var b=a(window).height();a(this.container).height(b+"px")},isOpen:function(){return(this.status=="open")}}})(jQuery);(function(a){eMend.navbar=function(b){if(!(this instanceof arguments.callee)){return new eMend.navbar(b)}this.opts=a.extend({},eMend.navbar.defaults,b);this.htmlEl=a("html");this.create();this.clear()};eMend.navbar.defaults={align:"right",width:"6px",height:"100%"};eMend.navbar.prototype={create:function(){this.htmlEl.css({height:"100%"});this.bar=a("#emend-navbar").remove()[0]||a.create("div",{id:"emend-navbar",style:b}," ")[0];var c=this.opts;var b=c.align+":0; top:0; width:"+c.width+"; height:"+c.height+"; position: absolute;";a(this.bar).attr("style",b);a(this.opts.target).append(this.bar)},refresh:function(){this.clear();this.render()},render:function(){var c=this.opts,b=a(document.body).height(),n=a(this.bar).height(),f=this.opts.positions.getHighlightsCollection();var e,j,q,d,m,p,r,g;for(var k=0;k<f.length;k++){e=f[k];j=e.className.split(" ").pop();q=a(e).height();d=a(e).offset({lite:true}).top;m=Math.round(q/b*n);p=Math.round(d/b*n);r="height:"+m+"px; width:"+c.width+"; position: absolute; top:"+p+"px; z-index:"+j.substr(1)+";";g=a.create("div",{"class":j,style:r})[0];this.bar.appendChild(g)}},clear:function(){a(this.bar).empty()}}})(jQuery);(function(a){eMend.positions=function(b){if(!(this instanceof arguments.callee)){return new eMend.positions(b)}this.highlightEls=null;this.highlights=null;this.references=null;this.opts=a.extend({},eMend.positions.defaults,b)};eMend.positions.prototype={invalidate:function(){var d,c,b;for(c=0,b=arguments.length;c<b;c++){d=arguments[c];switch(d){case"highlights":this.highlightEls=null;this.highlights=null;break;case"references":this.references=null;break}}},updateAll:function(){this.updateHighlightCollection();this.updateHighlights();this.updateReferences()},updateHighlightCollection:function(){this.highlightEls=a("nodeinner").filter(".highlight")},updateHighlights:function(){this.highlights={};var b=this.highlightEls;var m,f,k,g;for(var e=b.length-1;e>=0;e--){m=b[e];f=m.className.split(" ");f.pop();f.shift();for(var d=0,c=f.length;d<c;d++){k=f[d].substring(1);if(!this.highlights[k]){g=a(m).offset({lite:true});this.highlights[k]=g;this.highlights[k].bottom=g.top+a(m).height()}}}},updateReferences:function(){this.references={};var c=this.getHighlightsCollection();var b,m,d,g,p,e;for(var n=c.length-1;n>=0;n--){b=c[n];m=b.className.split(" ");m.pop();m.shift();for(var k=0,f=m.length;k<f;k++){d=m[k].substring(1);if(!this.references[d]){g=document.createElement("span");g.style.fontSize="1px";g.innerHTML="|";b.appendChild(g);e=a(g).offset({lite:true});this.references[d]=e;this.references[d].node=g.parentNode.getAttribute("node");b.removeChild(g)}}}},getVisibleHighlights:function(){var g,f=a(window).scrollTop(),c=a(window).height(),d=[],e=[],b=this.getHighlights();for(ntID in b){g=b[ntID];if(g.bottom>=f&&g.top<=c+f){d.push(ntID)}else{e.push(ntID)}}return{visible:d,invisible:e}},getInvisibleHighlights:function(){var f,e=a(window).scrollTop(),d=a(window).height(),g=[],b=this.getHighlights();for(ntID in b){f=b[ntID];if(f.bottom<=e||f.top>=d+e){g.push(ntID)}}return g},getReferences:function(){if(this.references==null){this.updateReferences()}return this.references},getReference:function(b){if(this.references==null){this.updateReferences()}return this.references[b]},getHighlights:function(){if(this.highlights==null){this.updateHighlights()}return this.highlights},getHighlight:function(b){if(this.highlights==null){this.updateHighlights()}return this.highlights[b]},getHighlightsCollection:function(){if(!this.highlightEls){this.updateHighlightCollection()}return this.highlightEls}}})(jQuery);(function(a){eMend.renderNotes=function(c){if(!(this instanceof arguments.callee)){return new eMend.renderNotes(c)}this.opts=a.extend({},eMend.renderNotes.defaults,c);this.container=this.opts.target;this.dataset=this.opts.dataset;this.positions=this.opts.positions;this.nodeStatus={};this.nodeLinkHidden={};this.renderedNotes={};var b=this;a(this.container).hover(function(){a(b).trigger("emend.notesHover")},function(){a(b).trigger("emend.notesUnHover")});this.clearNotes()};eMend.renderNotes.defaults={};eMend.renderNotes.prototype={clearNotes:function(){a(this.container).find(".noteGroup").remove()},renderNotes:function(){var n=this.container;var z=false,k=false,m=null,n=this.container,p=this.dataset;if(!z){this.clearNotes()}var c=a(".highlight"),q={},o={},e={},x={},g,u,b,y,B;for(var s=c.length-1;s>=0;s--){hlEL=c[s];y=a(hlEL.parentNode).attr("node");ntIDs=a(hlEL).attr("className").split(" ");ntIDs.pop();ntIDs.shift();if(!q[y]){B="noteGroup";B+=this.nodeStatus[y]?" readpart":" readfull";B+=this.nodeLinkHidden[y]?" unlinked":" linked";b=new eMend.commentGroup({nodeGroup:y,nodeClass:B});u=b.getElement();if(z){n.replaceChild(u,a("noteGroup"+refreshNode))}else{if(m){n.insertBefore(u,m)}else{n.appendChild(u)}}m=u;g=null;q[y]=true;count=0}for(var r=0,v=ntIDs.length;r<v;r++){ntID=ntIDs[r].substring(1);if(!o[ntID]){if(!this.nodeStatus[y]){uc=ntID.split("_");var f=p.getComment(uc[0],uc[1]);var d=f.getElement("emend-note even_"+k);k=!k;b.prependChild(d);g=d;this.renderedNotes[ntID]={group:b,comment:f}}o[ntID]=true;count++}}switch(count){case 0:x[y]=true;break;case 1:delete x[y];break;default:delete x[y]}}for(y in x){a("#noteGroup"+y).remove()}var A=a.create("div",{className:"noteGroup"});a(A).css({height:"50px",visibility:"hidden"});n.appendChild(A[0]);a(this).trigger("emend.rendernotes")},refreshView:function(){var k=this.positions.getVisibleHighlights(),e=k.invisible,g=k.visible,b,f;for(i=0,l=e.length;i<l;i++){var b=this.renderedNotes[e[i]];b.comment.hide();b.group.closeGroup()}for(i=0,l=g.length;i<l;i++){var f=this.renderedNotes[g[i]];f.comment.show();f.group.openGroup()}var j=g[g.length-1];var d=a("#note"+j);if(d.length){var c=(d.offset().top-a(window).scrollTop()+36)+"px";this.scrollTo(c)}else{window.setTimeout(function(){a(document).trigger("emend.afterviewscroll")},350)}},scrollTo:function(b){a("#sidebar-body").scrollTo({top:b},350,{onAfter:function(){a(document).trigger("emend.afterviewscroll")},stop:true})}}})(jQuery);(function(a){eMend.prefetch=function(f){var b=eMend.config;var n=typeof b.baseURI!="undefined"?b.baseURI:"../dist";var m=a("#eMend-comment-assets");if(!m.length){m=a(a.create("div",{id:"eMend-comment-assets"}));for(var g=0;g<21;g++){m.append(a.create("img",{src:n+"images/user"+g+".png"}))}m.append(a.create("img",{src:n+"images/more_big.png"}));m.append(a.create("img",{src:n+"images/less_big.png"}));m.append(a.create("img",{src:n+"images/more.png"}));m.append(a.create("img",{src:n+"images/less.png"}));a(f.datastore).append(m);var k=eMend.dictionary;k.comment.baseURI=k.comment_more.baseURI=k.commentGroup.baseURI=k.commentTrigger.baseURI=k.commentForm.baseURI=k.sidebar.baseURI=n+"images"}else{var e=a(m[0].firstChild).attr("src"),j=e.substr(0,e.lastIndexOf("/")),k=eMend.dictionary;k.comment.baseURI=k.comment_more.baseURI=k.commentGroup.baseURI=k.commentTrigger.baseURI=k.commentForm.baseURI=k.sidebar.baseURI=j}delete eMendBaseURI}})(jQuery);(function($){function toIntegersAtLease(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(date){return this.getUTCFullYear()+"-"+toIntegersAtLease(this.getUTCMonth())+"-"+toIntegersAtLease(this.getUTCDate())};var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};$.quoteString=function(string){if(escapeable.test(string)){return'"'+string.replace(escapeable,function(a){var c=meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};$.toJSON=function(o,compact){var type=typeof(o);if(type=="undefined"){return"undefined"}else{if(type=="number"||type=="boolean"){return o+""}else{if(o===null){return"null"}}}if(type=="string"){return $.quoteString(o)}if(type=="object"&&typeof o.toJSON=="function"){return o.toJSON(compact)}if(type!="function"&&typeof(o.length)=="number"){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i],compact))}if(compact){return"["+ret.join(",")+"]"}else{return"["+ret.join(", ")+"]"}}if(type=="function"){throw new TypeError("Unable to convert object of type 'function' to json.")}ret=[];for(var k in o){var name;var type=typeof(k);if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}val=$.toJSON(o[k],compact);if(typeof(val)!="string"){continue}if(compact){ret.push(name+":"+val)}else{ret.push(name+": "+val)}}return"{"+ret.join(", ")+"}"};$.compactJSON=function(o){return $.toJSON(o,true)};$.evalJSON=function(src){return eval("("+src+")")};$.secureEvalJSON=function(src){var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}}})(jQuery);(function(a){eMend.backstore=eMend.backstore||{};eMend.backstore.tiddly=function(c){if(!(this instanceof arguments.callee)){return new eMend.backstore.tiddly(c)}this.opts=a.extend({},eMend.backstore.tiddly.defaults,c);var b=a("#eMend-backstore-tiddly");if(b.length){this.importData(b)}else{b=this.createDataContainer()}this.container=b};eMend.backstore.tiddly.defaults={};eMend.backstore.tiddly.prototype={createDataContainer:function(c){var b=a.create("div",{id:"eMend-backstore-tiddly"});a(this.opts.datastore).append(b);return a(b)},addComment:function(){var d=this.opts.dataset.getLastSelection(),e=this.opts.dataset.getLastComment().data,b=a.create("div",{});a(b).attr("data",a.toJSON({s:d,c:e}));b[0].innerHTML=e.body;this.container.append(b)},importData:function(b){var c=this.opts.dataset;b.children().each(function(){var d=a.evalJSON(a(this).attr("data"));c.importEmendment(d.s,d.c)});a(document).trigger("emend.importData")}}})(jQuery);(function(a){eMend.backstore=eMend.backstore||{};eMend.backstore.sfEmendPlugin=function(b){if(!(this instanceof arguments.callee)){return new eMend.backstore.sfEmendPlugin(b)}this.opts=a.extend({},eMend.backstore.sfEmendPlugin.defaults,b);var c=window.location.pathname.split("/");c.shift();this.resourceID=c.join("_");this.getCurrentUser();this.getComments()};eMend.backstore.sfEmendPlugin.defaults={};eMend.backstore.sfEmendPlugin.prototype={addComment:function(){var b=this.opts.dataset.getLastSelection(),d=this.opts.dataset.getLastComment().data;d.selection=a.toJSON(b);a.ajax({url:"/fe_dev.php/emend.addComment/"+this.resourceID,data:d,success:function(c){}})},getComments:function(b){var c=this.opts.dataset;a.ajax({url:"/fe_dev.php/emend.getComments/"+this.resourceID,success:function(f,k){var g=a.evalJSON(f);var e,d,j;for(e=0,d=g.comments.length;e<d;e++){j=g.comments[e];c.importEmendment(j.s,j.c)}a(document).trigger("emend.importData")},error:function(d,f,e){this}})},getCurrentUser:function(b){a.ajax({url:"/get_logged_user",success:function(c,e){var d=a.evalJSON(c);if(typeof d.name!="undefined"){a(document).trigger("emend.loggedIn",d)}else{a(document).trigger("emend.loggedOut")}},error:function(c,e,d){this}})}}})(jQuery);(function(a){eMend.init=function(k){if(eMend.status=="running"){return}document.body.normalize();k.fixOperaRangeSelectionBug();k(document).cleanWhitespace(true);document.body.normalize();var r=k("#eMend-DATA-Overlay").remove()[0]||k.create("div",{id:"eMend-DATA-Overlay",className:"hidden write-protect"})[0];var y=k("#eMend-VISUAL-Overlay").remove()[0]||k.create("div",{id:"eMend-VISUAL-Overlay",className:"write-protect"})[0];if(k.browser.msie||k.browser.safari){k(document.body).append(r).append(y)}else{k(document.body.parentNode).append(r).append(y)}var G=eMend.prefetch({datastore:r});var F=eMend.sidebar({target:y});var m=F.getContainer();var z=eMend.dataset({target:document.body,datastore:r}),D=eMend.positions(),q=eMend.users({dataset:z}),s=eMend.renderNotes({dataset:z,target:m,positions:D}),o=eMend.navbar({target:m.parentNode,positions:D}),x=eMend.commentForm({dataset:z,target:y}),j=eMend.commentTrigger({target:y,form:x,sidebar:F,users:q}),p=eMend.linker({target:y,positions:D});if(eMend.config.backend){switch(eMend.config.backend){case"sfEmendPlugin":var C=eMend.backstore.sfEmendPlugin({dataset:z});k(document).bind("emend.addComment",function(){C.addComment()});break}}var e=-1;var A=k.getScroll().t;var c=function(H,I){if(F.isOpen()){p.refreshLinks()}},u=function(H,I){if(F.isOpen()){s.refreshView()}},E=function(H,I){p.hideLinks()},v=function(H,I){p.clearLinks()},b=function(H,I){o.refresh()},B=function(H,I){D.invalidate("highlights","references")},g=function(H,I){eMend.highlight(z);s.renderNotes()},n=function(H,I){F.open()},f=function(H,I){window.clearTimeout(e);e=window.setTimeout(function(){k(document).trigger("emend.afterscroll")},450)};delayedRefresh=function(){var H=k.getScroll().t;if(A!=H){E();f();A=H}};k(document).bind("emend.opensidebar",function(){c()});k(document).bind("emend.opensidebar",b);k(document).bind("emend.closesidebar",function(){E();window.setTimeout(v,500)});k(document).bind("emend.addComment",g);k(document).bind("emend.addComment",function(){j.show(0)});k(document).bind("emend.importData",function(){g()});k(document).bind("emend.highlight",B);k(s).bind("emend.notesHover",c);k(s).bind("emend.rendernotes",n);k(document).bind("emend.afterscroll",u);k(document).bind("emend.afterviewscroll",c);k(document).bind("emend.toggleGroup",function(){c()});k(window).wresize(B);k(window).wresize(c);k(window).wresize(b);if(eMend.config.scroll_refresh_delay){k(window).scroll(delayedRefresh)}else{k(window).scroll(c);k(window).scroll(f)}if(eMend.config.backend){k(document).bind("emend.loggedIn",function(H,I){q.login(H,I);j.show(0)});k(document).bind("emend.loggedOut",function(H,I){q.logout();j.show(4)})}if(eMend.config.backstore_tiddly){var d=eMend.backstore.tiddly({dataset:z,datastore:r});k(document).bind("emend.addComment",function(){d.addComment()})}eMend.status="running"};if(typeof eMendInit!="undefined"&&eMendInit==true){eMend.init(jQuery)}a(document).ready(function(){eMend.init(jQuery)})})(jQuery);if(eMend.config.jquery_noconflict){jQuery.noConflict()};