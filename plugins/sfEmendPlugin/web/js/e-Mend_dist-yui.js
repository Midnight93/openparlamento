(function(A){if(!A.every){A.every=function(E,D){for(var C=0,B=this.length;--B>=0;C++){if(C in this&&!E.call(D,this[C],C,this)){return false}}return true}}if(!A.filter){A.filter=function(F,E){var G=[];for(var C,D=0,B=this.length;--B>=0;D++){if(D in this&&F.call(E,C=this[D],D,this)){G.push(C)}}return G}}if(!A.forEach){A.forEach=function(E,D){for(var C=0,B=this.length;--B>=0;C++){if(C in this){E.call(D,this[C],C,this)}}}}if(!A.indexOf){A.indexOf=function(D,C){var B=this.length;C=(C<0)?Math.ceil(C):Math.floor(C);if(C<0){C+=B}for(;C<B;C++){if(C in this&&this[C]===D){return C}}return -1}}if(!A.lastIndexOf){A.lastIndexOf=function(D,C){var B=this.length;if(isNaN(C)){C=B-1}else{C=(C<0)?Math.ceil(C):Math.floor(C);if(C<0){C+=B}else{if(C>=B){C=B-1}}}for(;C>-1;C--){if(C in this&&this[C]===D){return C}}return -1}}if(!A.map){A.map=function(E,D){var B=this.length;var F=new Array(B);for(var C=0;--B>=0;C++){if(C in this){F[C]=E.call(D,this[C],C,this)}}return F}}if(!A.some){A.some=function(E,D){for(var C=0,B=this.length;--B>=0;C++){if(C in this&&E.call(D,this[C],C,this)){return true}}return false}}})(Array.prototype);if(!window.CanvasRenderingContext2D){(function(){var N=Math;var O=N.round;var L=N.sin;var U=N.cos;var A=10;var I=A/2;var G={init:function(W){var X=W||document;if(/MSIE/.test(navigator.userAgent)&&!window.opera){var V=this;X.attachEvent("onreadystatechange",function(){V.init_(X)})}},init_:function(Y){if(Y.readyState=="complete"){if(!Y.namespaces.g_vml_){Y.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml")}var X=Y.createStyleSheet();X.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}";var W=Y.getElementsByTagName("canvas");for(var V=0;V<W.length;V++){if(!W[V].getContext){this.initElement(W[V])}}}},fixElement_:function(X){var Z=X.outerHTML;var Y=X.ownerDocument.createElement(Z);if(Z.slice(-2)!="/>"){var V="/"+X.tagName;var W;while((W=X.nextSibling)&&W.tagName!=V){W.removeNode()}if(W){W.removeNode()}}X.parentNode.replaceChild(Y,X);return Y},initElement:function(W){W=this.fixElement_(W);W.getContext=function(){if(this.context_){return this.context_}return this.context_=new J(this)};W.attachEvent("onpropertychange",T);W.attachEvent("onresize",B);var V=W.attributes;if(V.width&&V.width.specified){W.style.width=V.width.nodeValue+"px"}else{W.width=W.clientWidth}if(V.height&&V.height.specified){W.style.height=V.height.nodeValue+"px"}else{W.height=W.clientHeight}return W}};function T(W){var V=W.srcElement;switch(W.propertyName){case"width":V.style.width=V.attributes.width.nodeValue+"px";V.getContext().clearRect();break;case"height":V.style.height=V.attributes.height.nodeValue+"px";V.getContext().clearRect();break}}function B(W){var V=W.srcElement;if(V.firstChild){V.firstChild.style.width=V.clientWidth+"px";V.firstChild.style.height=V.clientHeight+"px"}}G.init();var D=[];for(var R=0;R<16;R++){for(var Q=0;Q<16;Q++){D[R*16+Q]=R.toString(16)+Q.toString(16)}}function K(){return[[1,0,0],[0,1,0],[0,0,1]]}function E(Y,X){var W=K();for(var V=0;V<3;V++){for(var b=0;b<3;b++){var Z=0;for(var a=0;a<3;a++){Z+=Y[V][a]*X[a][b]}W[V][b]=Z}}return W}function P(W,V){V.fillStyle=W.fillStyle;V.lineCap=W.lineCap;V.lineJoin=W.lineJoin;V.lineWidth=W.lineWidth;V.miterLimit=W.miterLimit;V.shadowBlur=W.shadowBlur;V.shadowColor=W.shadowColor;V.shadowOffsetX=W.shadowOffsetX;V.shadowOffsetY=W.shadowOffsetY;V.strokeStyle=W.strokeStyle;V.arcScaleX_=W.arcScaleX_;V.arcScaleY_=W.arcScaleY_}function C(W){var Z,Y=1;W=String(W);if(W.substring(0,3)=="rgb"){var b=W.indexOf("(",3);var V=W.indexOf(")",b+1);var a=W.substring(b+1,V).split(",");Z="#";for(var X=0;X<3;X++){Z+=D[Number(a[X])]}if((a.length==4)&&(W.substr(3,1)=="a")){Y=a[3]}}else{Z=W}return[Z,Y]}function M(V){switch(V){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function J(W){this.m_=K();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=A*1;this.globalAlpha=1;this.canvas=W;var V=W.ownerDocument.createElement("div");V.style.width=W.clientWidth+"px";V.style.height=W.clientHeight+"px";V.style.overflow="hidden";V.style.position="absolute";W.appendChild(V);this.element_=V;this.arcScaleX_=1;this.arcScaleY_=1}var H=J.prototype;H.clearRect=function(){this.element_.innerHTML="";this.currentPath_=[]};H.beginPath=function(){this.currentPath_=[]};H.moveTo=function(W,V){this.currentPath_.push({type:"moveTo",x:W,y:V});this.currentX_=W;this.currentY_=V};H.lineTo=function(W,V){this.currentPath_.push({type:"lineTo",x:W,y:V});this.currentX_=W;this.currentY_=V};H.bezierCurveTo=function(X,V,a,Z,Y,W){this.currentPath_.push({type:"bezierCurveTo",cp1x:X,cp1y:V,cp2x:a,cp2y:Z,x:Y,y:W});this.currentX_=Y;this.currentY_=W};H.quadraticCurveTo=function(c,b,a,Z){var W=this.currentX_+2/3*(c-this.currentX_);var V=this.currentY_+2/3*(b-this.currentY_);var Y=W+(a-this.currentX_)/3;var X=V+(Z-this.currentY_)/3;this.bezierCurveTo(W,V,Y,X,a,Z)};H.arc=function(b,Z,a,Y,W,X){a*=A;var f=X?"at":"wa";var c=b+(U(Y)*a)-I;var e=Z+(L(Y)*a)-I;var V=b+(U(W)*a)-I;var d=Z+(L(W)*a)-I;if(c==V&&!X){c+=0.125}this.currentPath_.push({type:f,x:b,y:Z,radius:a,xStart:c,yStart:e,xEnd:V,yEnd:d})};H.rect=function(X,W,V,Y){this.moveTo(X,W);this.lineTo(X+V,W);this.lineTo(X+V,W+Y);this.lineTo(X,W+Y);this.closePath()};H.strokeRect=function(X,W,V,Y){this.beginPath();this.moveTo(X,W);this.lineTo(X+V,W);this.lineTo(X+V,W+Y);this.lineTo(X,W+Y);this.closePath();this.stroke()};H.fillRect=function(X,W,V,Y){this.beginPath();this.moveTo(X,W);this.lineTo(X+V,W);this.lineTo(X+V,W+Y);this.lineTo(X,W+Y);this.closePath();this.fill()};H.createLinearGradient=function(W,Y,V,X){var Z=new S("gradient");return Z};H.createRadialGradient=function(Y,a,X,W,Z,V){var b=new S("gradientradial");b.radius1_=X;b.radius2_=V;b.focus_.x=Y;b.focus_.y=a;return b};H.drawImage=function(p,Y){var f,c,j,x,n,k,r,z;var g=p.runtimeStyle.width;var o=p.runtimeStyle.height;p.runtimeStyle.width="auto";p.runtimeStyle.height="auto";var e=p.width;var u=p.height;p.runtimeStyle.width=g;p.runtimeStyle.height=o;if(arguments.length==3){f=arguments[1];c=arguments[2];n=k=0;r=j=e;z=x=u}else{if(arguments.length==5){f=arguments[1];c=arguments[2];j=arguments[3];x=arguments[4];n=k=0;r=e;z=u}else{if(arguments.length==9){n=arguments[1];k=arguments[2];r=arguments[3];z=arguments[4];f=arguments[5];c=arguments[6];j=arguments[7];x=arguments[8]}else{throw"Invalid number of arguments"}}}var y=this.getCoords_(f,c);var Z=r/2;var X=z/2;var v=[];var V=10;var b=10;v.push(" <g_vml_:group",' coordsize="',A*V,",",A*b,'"',' coordorigin="0,0"',' style="width:',V,";height:",b,";position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var a=[];a.push("M11='",this.m_[0][0],"',","M12='",this.m_[1][0],"',","M21='",this.m_[0][1],"',","M22='",this.m_[1][1],"',","Dx='",O(y.x/A),"',","Dy='",O(y.y/A),"'");var t=y;var s=this.getCoords_(f+j,c);var q=this.getCoords_(f,c+x);var m=this.getCoords_(f+j,c+x);t.x=Math.max(t.x,s.x,q.x,m.x);t.y=Math.max(t.y,s.y,q.y,m.y);v.push("padding:0 ",O(t.x/A),"px ",O(t.y/A),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",a.join(""),", sizingmethod='clip');")}else{v.push("top:",O(y.y/A),"px;left:",O(y.x/A),"px;")}v.push(' ">','<g_vml_:image src="',p.src,'"',' style="width:',A*j,";"," height:",A*x,';"',' cropleft="',n/e,'"',' croptop="',k/u,'"',' cropright="',(e-n-r)/e,'"',' cropbottom="',(u-k-z)/u,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",v.join(""))};H.stroke=function(z){var e=[];var d=false;var Ac=C(z?this.fillStyle:this.strokeStyle);var v=Ac[0];var Y=Ac[1]*this.globalAlpha;var X=10;var j=10;e.push("<g_vml_:shape",' fillcolor="',v,'"',' filled="',Boolean(z),'"',' style="position:absolute;width:',X,";height:",j,';"',' coordorigin="0 0" coordsize="',A*X," ",A*j,'"',' stroked="',!z,'"',' strokeweight="',this.lineWidth,'"',' strokecolor="',v,'"',' path="');var h=false;var u={x:null,y:null};var w={x:null,y:null};for(var x=0;x<this.currentPath_.length;x++){var q=this.currentPath_[x];if(q.type=="moveTo"){e.push(" m ");var Ab=this.getCoords_(q.x,q.y);e.push(O(Ab.x),",",O(Ab.y))}else{if(q.type=="lineTo"){e.push(" l ");var Ab=this.getCoords_(q.x,q.y);e.push(O(Ab.x),",",O(Ab.y))}else{if(q.type=="close"){e.push(" x ")}else{if(q.type=="bezierCurveTo"){e.push(" c ");var Ab=this.getCoords_(q.x,q.y);var t=this.getCoords_(q.cp1x,q.cp1y);var r=this.getCoords_(q.cp2x,q.cp2y);e.push(O(t.x),",",O(t.y),",",O(r.x),",",O(r.y),",",O(Ab.x),",",O(Ab.y))}else{if(q.type=="at"||q.type=="wa"){e.push(" ",q.type," ");var Ab=this.getCoords_(q.x,q.y);var k=this.getCoords_(q.xStart,q.yStart);var b=this.getCoords_(q.xEnd,q.yEnd);e.push(O(Ab.x-this.arcScaleX_*q.radius),",",O(Ab.y-this.arcScaleY_*q.radius)," ",O(Ab.x+this.arcScaleX_*q.radius),",",O(Ab.y+this.arcScaleY_*q.radius)," ",O(k.x),",",O(k.y)," ",O(b.x),",",O(b.y))}}}}}if(Ab){if(u.x==null||Ab.x<u.x){u.x=Ab.x}if(w.x==null||Ab.x>w.x){w.x=Ab.x}if(u.y==null||Ab.y<u.y){u.y=Ab.y}if(w.y==null||Ab.y>w.y){w.y=Ab.y}}}e.push(' ">');if(typeof this.fillStyle=="object"){var o={x:"50%",y:"50%"};var s=(w.x-u.x);var m=(w.y-u.y);var Aa=(s>m)?s:m;o.x=O((this.fillStyle.focus_.x/s)*100+50)+"%";o.y=O((this.fillStyle.focus_.y/m)*100+50)+"%";var g=[];if(this.fillStyle.type_=="gradientradial"){var y=(this.fillStyle.radius1_/Aa*100);var n=(this.fillStyle.radius2_/Aa*100)-y}else{var y=0;var n=100}var V={offset:null,color:null};var Z={offset:null,color:null};this.fillStyle.colors_.sort(function(a,W){return a.offset-W.offset});for(var x=0;x<this.fillStyle.colors_.length;x++){var f=this.fillStyle.colors_[x];g.push((f.offset*n)+y,"% ",f.color,",");if(f.offset>V.offset||V.offset==null){V.offset=f.offset;V.color=f.color}if(f.offset<Z.offset||Z.offset==null){Z.offset=f.offset;Z.color=f.color}}g.pop();e.push("<g_vml_:fill",' color="',Z.color,'"',' color2="',V.color,'"',' type="',this.fillStyle.type_,'"',' focusposition="',o.x,", ",o.y,'"',' colors="',g.join(""),'"',' opacity="',Y,'" />')}else{if(z){e.push('<g_vml_:fill color="',v,'" opacity="',Y,'" />')}else{e.push("<g_vml_:stroke",' opacity="',Y,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',M(this.lineCap),'"',' weight="',this.lineWidth,'px"',' color="',v,'" />')}}e.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",e.join(""));this.currentPath_=[]};H.fill=function(){this.stroke(true)};H.closePath=function(){this.currentPath_.push({type:"close"})};H.getCoords_=function(W,V){return{x:A*(W*this.m_[0][0]+V*this.m_[1][0]+this.m_[2][0])-I,y:A*(W*this.m_[0][1]+V*this.m_[1][1]+this.m_[2][1])-I}};H.save=function(){var V={};P(this,V);this.aStack_.push(V);this.mStack_.push(this.m_);this.m_=E(K(),this.m_)};H.restore=function(){P(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};H.translate=function(X,W){var V=[[1,0,0],[0,1,0],[X,W,1]];this.m_=E(V,this.m_)};H.rotate=function(W){var Y=U(W);var X=L(W);var V=[[Y,X,0],[-X,Y,0],[0,0,1]];this.m_=E(V,this.m_)};H.scale=function(X,W){this.arcScaleX_*=X;this.arcScaleY_*=W;var V=[[X,0,0],[0,W,0],[0,0,1]];this.m_=E(V,this.m_)};H.clip=function(){};H.arcTo=function(){};H.createPattern=function(){return new F};function S(V){this.type_=V;this.radius1_=0;this.radius2_=0;this.colors_=[];this.focus_={x:0,y:0}}S.prototype.addColorStop=function(W,V){V=C(V);this.colors_.push({offset:1-W,color:V})};function F(){}G_vmlCanvasManager=G;CanvasRenderingContext2D=J;CanvasGradient=S;CanvasPattern=F})()}(function(L,J,F){function K(O){this.e=O;this.i=0;this.js=["with(XPath){return ","}"];this.expression(1,1)||this.error();return new Function("n","nsr",this.js.join(""))}K.ie=/MSIE/.test(navigator.userAgent);K.prototype={match:function(R,P){var O,Q;if(!(O=R.exec(this.e.substr(this.i)))||(typeof P=="number"&&!(Q=O[P]))||(typeof P=="object"&&!(Q=P[O[1]]))){return false}this.m=O;this.i+=O[0].length;return Q||O},error:function(P){P=(P||"Syntax error")+" at index "+this.i+": "+this.e.substr(this.i);var Q;try{Q=new H(51,P)}catch(O){Q=new Error(P)}throw Q},step:function(O,S,R,T){var Q=3;if(this.match(/^(\/\/?|\.\.?|@)\s*/,1)){switch(this.m[1]){case"/":if(R){this.error()}if(!T){return this.step(O,S,1)}this.js.splice(O,0,' axis(axes["',"document-root",'"],');Q+=this.nodeTypes.node.call(this,O+Q);R=1;break;case"//":if(R){this.error()}this.js.splice(O,0,' axis(axes["',"descendant-or-self",'"],');Q+=this.nodeTypes.node.call(this,O+Q);R=1;break;case".":if(!R&&!T){this.error()}this.js.splice(O,0,' axis(axes["',"self",'"],');Q+=this.nodeTypes.node.call(this,O+Q);R=0;break;case"..":if(!R&&!T){this.error()}this.js.splice(O,0,' axis(axes["',"parent",'"],');Q+=this.nodeTypes.node.call(this,O+Q);R=0;break;case"@":if(!R&&!T){this.error()}this.js.splice(O,0,' axis(axes["',"attribute",'"],');Q+=this.nodeTest(O+Q,"node")||this.error("Missing nodeTest after @");R=0}}else{if(!R&&!T){return R?this.error():0}else{if(this.match(/^([a-z]+(?:-[a-z]+)*)\s*::\s*/,K.axes)){this.js.splice(O,0,' axis(axes["',this.m[1],'"],');Q+=this.nodeTest(O+Q,(this.m[1]=="attribute")?"node":"element")||this.error("Missing nodeTest after ::");R=0}else{if(Q=this.nodeTest(O,"element")){this.js.splice(O,0,' axis(axes["',"child",'"],');Q+=3;R=0}else{return 0}}}}for(var P;P=this.predicate(O+Q);Q+=P){}if(T){this.js.splice(S+Q++,0,T)}Q+=this.step(O,S+Q,R);this.js.splice(S+Q++,0,")");return Q},expression:function(O,Q,R){var S,P=this.operand(O);while(S=this.match(/^(or|and|!?=|[<>]=?|[|*+-]|div|mod)\s*/,this.operators)){if(R&&R[0]>=S[0]){this.i-=this.m[0].length;break}this.js.splice(O,0,S[1]);P++;this.js.splice(O+P++,0,S[2]);P+=this.expression(O+P,Q,S)||this.error("Missing operand");this.js.splice(O+P++,0,S[3])}return P},operand:function(O){if(this.match(/^(-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)|"[^"]*"|'[^']*')\s*/,1)){this.js.splice(O,0,this.m[1]);return 1}var R;if(R=this.match(/^([a-z]+(?:-[a-z]+)*)\s*\(\s*/,this.functions)){var Q=1,P;this.js.splice(O,0,R[1]);do{if(P){this.js.splice(O+Q++,0,",")}Q+=(P=this.expression(O+Q,O+Q))}while(P&&this.match(/^,\s*/));this.match(/^\)\s*/)||this.error("Missing (");if(R[0]){if(P){this.js.splice(O+Q++,0,",")}this.js.splice(O+Q++,0,R[0])}if(R[2]){this.js.splice(O+Q++,0,R[2])}else{if(P>1){this.error("Function has arguments")}}Q+=this.step(O,O+Q);return Q}if(this.match(/^\(\s*/)){var Q=1;this.js.splice(O,0,"(");Q+=this.expression(O+Q,O+Q);this.match(/^\)\s*/)||this.error("Missing )");this.js.splice(O+Q++,")");return Q}return this.step(O,O,0,"[n]")},operators:{"|":[1,"union(",",",")"],or:[1,"bool(",")||bool(",")"],and:[2,"bool(",")&&bool(",")"],"=":[3,"compare(eq,",",",")"],"!=":[3,"compare(ne,",",",")"],"<":[4,"compare(lt,",",",")"],">":[4,"compare(gt,",",",")"],"<=":[4,"compare(le,",",",")"],">=":[4,"compare(ge,",",",")"],"+":[5,"number(",")+number(",")"],"-":[5,"number(",")-number(",")"],"*":[6,"number(",")*number(",")"],div:[6,"number(",")/number(",")"],mod:[6,"number(",")%number(",")"]},functions:{last:[0,"nl.length"],position:[0,"(i+1)"],count:["nl","(",".length||0)"],id:["n","id(",")"],"local-name":["nl","localName(",")"],"namespace-uri":["nl","namespaceURI(",")"],name:["nl","qName(",")"],string:["n","string(",")"],concat:[0,"concat(",")"],"starts-with":[0,"startsWith(",")"],contains:[0,"contains(",")"],"substring-before":[0,"substringBefore(",")"],"substring-after":[0,"substringAfter(",")"],substring:[0,"substring(",")"],"string-length":["n","string(",").length"],"normalize-space":["n","normalizeSpace(",")"],translate:[0,"translate(",")"],"boolean":[0,"bool(",")"],not:[0,"!bool(",")"],"true":[0,"true "],"false":[0,"false "],number:["n","number(",")"],floor:[0,"Math.floor(number(","))"],ceiling:[0,"Math.ceil(number(","))"],round:[0,"Math.round(number(","))"],sum:[0,"sum(",")"]},predicate:function(O){var P=0;if(this.match(/^\[\s*/)){if(P=this.expression(O,O)){this.js.splice(O,0,"function(n,i,nl){with(XPath){var r=");P++;this.js.splice(O+P++,0,';return typeof r=="number"?Math.round(r)==i+1:bool(r)}},')}this.match(/^\]\s*/)||this.error("Missing ]")}return P},nodeTest:function(O,P){var Q;if(Q=this.match(/^([a-z]+(?:-[a-z]+)*)\(([^)]*)\)\s*/,this.nodeTypes)){return Q.call(this,O,this.m[2])}if(this.match(/^\*\s*/)){return this.nodeTypes[P].call(this,O)}return this.nodeName(O)},nodeType:function(O,P){this.js.splice(O,0,"function(n){return n.nodeType==",P,"},");return 3},nodeTypes:{node:function(O){this.js.splice(O,0,"null,");return 1},element:function(O){return this.nodeType(O,1)},attribute:function(O){return this.nodeType(O,2)},text:function(O){return this.nodeType(O,3)},"processing-instruction":function(O,P){if(!P){return this.nodeType(O,7)}this.js.splice(O,0,"function(n){return n.nodeType==7&&n.target==",P,"},");return 3},comment:function(O){return this.nodeType(O,8)}},nodeName:function(O){if(!this.match(/^([a-zA-Z_]+(?:-?[a-zA-Z0-9]+)*)(?::([a-zA-Z_]+(?:-?[a-zA-Z0-9]+)*))?\s*/,1)){return 0}if(this.m[2]){this.js.splice(O,0,'function(n){if(!nsr)throw new XPathException(14);return "',this.m[2],'"==',K.ie?"n.baseName":"n.localName",'&&nsr.lookupNamespaceURI("',this.m[1],'")==n.namespaceURI},');return 7}else{this.js.splice(O,0,"function(n){return/^",this.m[1],"$/i.test(n.nodeName)},");return 3}}};K.order=function(P,Q){var O=P.compareDocumentPosition?P.compareDocumentPosition(Q):K.compareDocumentPosition.call(P,Q);if(O&32){P=Array.prototype.indexOf.call(P.attributes,P);Q=Array.prototype.indexOf.call(Q.attributes,Q);return(P<Q)?-1:(P>Q)?1:0}if(!O){if(P==Q){return 0}if((P=P.ownerElement)&&(Q=Q.ownerElement)){return K.order(P,Q)}return K.ie?1:0}return 3-((O&6)||3)};K.compare=function(S,P,T){if(P instanceof Array&&T instanceof Array){var O=P.map(this.string),Q=T.map(this.string);for(P=O.length;--P>=0;){for(T=Q.length;--T>=0;){if(!S(O[P],Q[T])){return false}}}return true}if(P instanceof Array){for(var R=P.length;--R>=0;){if(!S(this[typeof T](P[R]),T)){return false}}return P.length>0}if(T instanceof Array){for(var R=T.length;--R>=0;){if(!S(P,this[typeof P](T[R]))){return false}}return T.length>0}if(typeof P=="boolean"||typeof T=="boolean"){return S(this.bool(P),this.bool(T))}if(typeof P=="number"||typeof T=="number"){return S(this.number(P),this.number(T))}return S(this.string(P),this.string(T))};K.eq=function(O,P){return O==P};K.ne=function(O,P){return O!=P};K.lt=function(O,P){return O<P};K.gt=function(O,P){return O>P};K.le=function(O,P){return O<=P};K.ge=function(O,P){return O>=P};K.id=function(Q,S){if(arguments.length==1){S=Q}var O=[];for(var R=this.string(Q).split(/\s+/),P=R.length;--P>=0;){if(Q=(S.ownerDocument||S).getElementById(R[P])){O.push(Q)}}return O.sort(this.order)};K.localName=new Function("nl","return (nl.length&&nl[0]."+(K.ie?"baseName":"localName")+')||""');K.namespaceURI=function(O){return(O.length&&O[0].namespaceURI)||""};K.qName=function(O){return(O.length&&O[0].nodeName)||""};K.union=function(Q,O){if(!Q.length){return O}if(!O.length){return Q}var P=[],S=Q.length-1,R=O.length-1;for(;;){switch(this.order(Q[S],O[R])){case -1:P.unshift(O[R--]);break;case 0:R--;case 1:P.unshift(Q[S--]);break;default:throw new Error("Invalid order")}if(S<0){if(++R>0){P.unshift.apply(P,P.slice.call(O,0,R))}break}if(R<0){if(++S>0){P.unshift.apply(P,P.slice.call(Q,0,S))}break}}return P};K.string=K.object=function(O){if(O instanceof Array&&typeof(O=O[0])=="undefined"){return""}if(typeof O=="string"){return O}switch(O.nodeType){case 1:case 9:case 11:return Array.prototype.map.call(O.childNodes,this.string,this).join("");default:return O.nodeValue||""}return String(O)};K.concat=function(){return Array.prototype.map.call(arguments,this.string,this).join("")};K.startsWith=function(P,O){return this.string(P).substr(0,(O=this.string(O)).length)==O};K.contains=function(P,O){return this.string(P).indexOf(this.string(O))!=-1};K.substringBefore=function(P,O){P=this.string(P);O=P.indexOf(this.string(O));return O!=-1?P.substr(0,O):""};K.substringAfter=function(P,O){P=this.string(P);O=this.string(O);var Q=P.indexOf(O);return Q!=-1?P.substr(Q+O.length):""};K.substring=function(Q,P,O){Q=this.string(Q);P=Math.round(this.number(P))-1;return(arguments.length==2)?Q.substr(P<0?0:P):Q.substr(P<0?0:P,Math.round(this.number(O))-Math.max(0,-P))};K.normalizeSpace=function(O){return this.string(O).replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ")};K.translate=function(R,P,V){R=this.string(R);P=this.string(P);V=this.string(V);var U=[],Q=R.length,T=0,S,O;while(--Q>=0){if((S=P.indexOf(O=R.charAt(T++)))==-1||(O=V.charAt(S))){U.push(O)}}return U.join("")};K.bool=K["boolean"]=function(O){if(typeof O=="boolean"){return O}if(O instanceof Array||typeof O=="string"){return O.length>0}return Boolean(O)};K.number=function(O){if(O instanceof Array&&typeof(O=O[0])=="undefined"){return 0}if(typeof O=="number"){return O}if(typeof O=="boolean"){return O?1:0}return Number(this.string(O))};K.sum=function(O){var Q=0,P=O.length;while(--P>=0){Q+=this.number(O[P])}return Q};K.walk=function(R,P){var O,Q=R.firstChild;while(Q){P.push(Q);if(O=Q.firstChild){Q=O}else{for(O=Q;!(Q=O.nextSibling)&&(O=O.parentNode)&&(O!=R);){}}}return P};K.axes={ancestor:function(P){var O=[];while(P=P.parentNode){O.unshift(P)}return O},"ancestor-or-self":function(P){var O=[];do{O.unshift(P)}while(P=P.parentNode);return O},attribute:new Function("n","var nl = [], a = n.attributes;if(a){attr:for(var x,i=a.length;--i>=0;){if(!(x=a[i]).specified){"+(K.ie?'switch(x.nodeName){case"selected":case"value":if(x.nodeValue)break;default:continue attr;}':"continue;")+"}nl.unshift(x);}}return nl;"),child:function(O){return O.childNodes||[]},descendant:function(O){return this.walk(O,[])},"descendant-or-self":function(O){return this.walk(O,[O])},following:function(Q){var P=[],O;while(Q){if(O=Q.nextSibling){P.push(Q=O);if(O=Q.firstChild){P.push(Q=O)}}else{Q=Q.parentNode}}return P},"following-sibling":function(P){var O=[];while(P=P.nextSibling){O.push(P)}return O},parent:function(O){return O.parentNode?[O.parentNode]:[]},preceding:function(R){var P=[],O,Q=R.parentNode;while(R){if(O=R.previousSibling){for(R=O;O=R.lastChild;R=O){}P.unshift(R)}else{if(R=R.parentNode){if(R==Q){Q=Q.parentNode}else{P.unshift(R)}}}}return P},"preceding-sibling":function(P){var O=[];while(P=P.previousSibling){O.unshift(P)}return O},self:function(O){return[O]},"document-root":function(O){return[O.ownerDocument||O]}};K.axis=function(W,V){var O,X,U=arguments.length-1,P=arguments[U],S=Array.prototype;for(var T=0,R,Q=P.length;--Q>=0;){X=W.call(this,P[T++]);if(V&&X.length){X=S.filter.call(X,V,this)}for(R=2;R<U&&X.length;X=S.filter.call(X,arguments[R++],this)){}O=O?this.union(O,X):X}return O||[]};K.cache={};function B(U){if(this==U){return 0}if(this.nodeType==2&&U.nodeType==2){return(this.ownerElement&&this.ownerElement==U.ownerElement)?32:0}var O=this.ownerElement||this,R=U.ownerElement||U;if(O.sourceIndex>=0&&R.sourceIndex>=0&&O.contains&&R.contains){return(((O.contains(R)&&16)||(R.contains(O)&&8))|((O.sourceIndex<R.sourceIndex&&4)||(R.sourceIndex<O.sourceIndex&&2)))||1}var S=O,T=R,P=0,Q=0;while(S=S.parentNode){P++}while(T=T.parentNode){Q++}if(P>Q){while(P--!=Q){O=O.parentNode}if(O==R){return 2|8}}else{if(Q>P){while(Q--!=P){R=R.parentNode}if(R==O){return 4|16}}}while((S=O.parentNode)!=(T=R.parentNode)){if(!(O=S)||!(R=T)){return 1}}while(O=O.nextSibling){if(O==R){return 4}}return 2}if(L.Node){var N=L.Node.prototype;if(F||!N.compareDocumentPosition){N.compareDocumentPosition=B}if(F||!N.contains){N.contains=function(O){return Boolean(this.compareDocumentPosition(O)&16)}}}else{K.compareDocumentPosition=B}if(F||!L.XPathException){function H(P,O){this.name="XPathException";this.code=P;this.message=O}var I=H,C=new Error;C.toString=function(){return this.name+":"+this.message};I.prototype=C;I.NAMESPACE_ERR=14;I.INVALID_EXPRESSION_ERR=51;I.TYPE_ERR=52;L.XPathException=I}if(F||!L.XPathNSResolver){function E(R){this.ns={};for(var O,P,Q=R.attributes.length;--Q>=0;){if(O=/xmlns:(.+)/.exec((P=R.attributes[Q]).nodeName)){this.ns[O[1]]=P.nodeValue}}this.ns[""]=R.getAttribute("targetNamespace")}E.prototype={lookupNamespaceURI:function(O){return this.ns[O||""]}};L.XPathNSResolver=E}if(F||!L.XPathExpression){function M(P,O){this.fn=K.cache[P]||(K.cache[P]=new K(P));this.nsr=O}M.prototype={evaluate:function(P,O){return new D(this.fn(P,this.nsr),O)}};L.XPathExpression=M}if(F||!L.XPathResult){function D(P,O){if(O==0){switch(typeof P){default:O++;case"boolean":O++;case"string":O++;case"number":O++}}this.resultType=O;switch(O){case 1:this.numberValue=K.number(P);return;case 2:this.stringValue=K.string(P);return;case 3:this.booleanValue=K.bool(P);return;case 4:case 5:if(P instanceof Array){this.value=P;this.index=0;this.invalidIteratorState=false;return}break;case 6:case 7:if(P instanceof Array){this.value=P;this.snapshotLength=P.length;return}break;case 8:case 9:if(P instanceof Array){this.singleNodeValue=P[0];return}}throw new H(52)}var A=D;A.ANY_TYPE=0;A.NUMBER_TYPE=1;A.STRING_TYPE=2;A.BOOLEAN_TYPE=3;A.UNORDERED_NODE_ITERATOR_TYPE=4;A.ORDERED_NODE_ITERATOR_TYPE=5;A.UNORDERED_NODE_SNAPSHOT_TYPE=6;A.ORDERED_NODE_SNAPSHOT_TYPE=7;A.ANY_UNORDERED_NODE_TYPE=8;A.FIRST_ORDERED_NODE_TYPE=9;A.prototype={iterateNext:function(){switch(this.resultType){case 4:case 5:return this.value[this.index++]}throw new H(52)},snapshotItem:function(O){switch(this.resultType){case 6:case 7:return this.value[O]}throw new H(52)}};L.XPathResult=A}if(F||!L.XPathEvaluator){function G(){}var I=G;I.prototype={createExpression:function(P,O){return new M(P,O)},createNSResolver:function(O){return new E(O)},evaluate:function(Q,R,P,O){return new M(Q,P).evaluate(R,O)}};I.install=function(Q,P){for(var O in G.prototype){if(P||!Q[O]){Q[O]=G.prototype[O]}}};L.XPathEvaluator=I;if(L.Document){I.install(L.Document.prototype,F)}else{I.install(document,F)}L.XPath=K}})(window,document,/WebKit/.test(navigator.userAgent));arrDiff=function(J,I,B){if(!J.length){J.push("");I.push("");var A=1}var H=[],G=-1,F,E,D,C;for(E=I.length,C=J.length;E--;){for(D=C;D&&(F=I[E]!==J[--D]);){}F&&(H[++G]=B?E:I[E])}if(A){J.pop();I.pop()}return H};Date.prototype.format=function(B,D){var F=this,C,A=function(H,G){return(H=H+"").length<G?new Array(++G-H.length).join("0")+H:H};var D=D||{},E={j:function(){return F.getDate()},w:function(){return F.getDay()},y:function(){return(F.getFullYear()+"").slice(2)},Y:function(){return F.getFullYear()},n:function(){return F.getMonth()+1},m:function(){return A(E.n(),2)},g:function(){return F.getHours()%12||12},G:function(){return F.getHours()},H:function(){return A(F.getHours(),2)},h:function(){return A(E.g(),2)},d:function(){return A(E.j(),2)},N:function(){return E.w()+1},i:function(){return A(F.getMinutes(),2)},s:function(){return A(F.getSeconds(),2)},ms:function(){return A(F.getMilliseconds(),3)},a:function(){return F.getHours()>11?"pm":"am"},A:function(){return E.a().toUpperCase()},O:function(){return F.getTimezoneOffset()/60},z:function(){return(F-new Date(F.getFullYear()+"/1/1"))/86400000>>0},L:function(){var G=E.Y();return(!(G&3)&&(G%100||!(G%400)))?1:0},t:function(){var G;return(G=F.getMonth()+1)==2?28+E.L():G&1&&G<8||!(G&1)&&G>7?31:30},W:function(){var H=E.z(),G=364+E.L()-H,I=(new Date(F.getFullYear()+"/1/1").getDay()||7)-1;return(G<=2&&((F.getDay()||7)-1)<=2-G)?1:(H<=2&&I>=4&&H>=(6-I))?new Date(F.getFullYear()-1+"/12/31").format("%W%"):(1+(I<=3?((H+I)/7):(H-(7-I))/7)>>0)}};return String(B).replace(/%(.*?)%/g,function(G,H){return D[H]?D[H](F,function(I){return E[I]&&E[I]()}):E[H]?E[H]():"%"+(H&&H+"%")})};Date.ISO8601="%Y%-%m%-%d%T%H%:%i%:%s%%O%";Date.ISO8601c="%Y%%m%%d%T%H%:%i%:%s%%O%";Date.prototype.setISO8601=function(B){var C="(^[0-9]{4})(-?([0-9]{2})(-?([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";var E=B.match(new RegExp(C));var D=0;var A=new Date(E[1],0,1);if(E[3]){A.setMonth(E[3]-1)}if(E[5]){A.setDate(E[5])}if(E[7]){A.setHours(E[7])}if(E[8]){A.setMinutes(E[8])}if(E[10]){A.setSeconds(E[10])}if(E[12]){A.setMilliseconds(Number("0."+E[12])*1000)}if(E[14]){D=(Number(E[16])*60)+Number(E[17]);D*=((E[15]=="-")?1:-1)}D-=A.getTimezoneOffset();time=(Number(A)+(D*60*1000));this.setTime(Number(time))};if(jQuery&&jQuery.browser.opera&&jQuery.browser.version>=9.5){var height_=jQuery.fn.height;jQuery.fn.height=function(){if(this[0]==window){return window.innerHeight}else{return height_.apply(this,arguments)}};var width_=jQuery.fn.width;jQuery.fn.width=function(){if(this[0]==window){return window.innerWidth}else{return width_.apply(this,arguments)}}}jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(B,C,A,E,D){return jQuery.easing[jQuery.easing.def](B,C,A,E,D)},easeInQuad:function(B,C,A,E,D){return E*(C/=D)*C+A},easeOutQuad:function(B,C,A,E,D){return -E*(C/=D)*(C-2)+A},easeInOutQuad:function(B,C,A,E,D){if((C/=D/2)<1){return E/2*C*C+A}return -E/2*((--C)*(C-2)-1)+A},easeInCubic:function(B,C,A,E,D){return E*(C/=D)*C*C+A},easeOutCubic:function(B,C,A,E,D){return E*((C=C/D-1)*C*C+1)+A},easeInOutCubic:function(B,C,A,E,D){if((C/=D/2)<1){return E/2*C*C*C+A}return E/2*((C-=2)*C*C+2)+A},easeInQuart:function(B,C,A,E,D){return E*(C/=D)*C*C*C+A},easeOutQuart:function(B,C,A,E,D){return -E*((C=C/D-1)*C*C*C-1)+A},easeInOutQuart:function(B,C,A,E,D){if((C/=D/2)<1){return E/2*C*C*C*C+A}return -E/2*((C-=2)*C*C*C-2)+A},easeInQuint:function(B,C,A,E,D){return E*(C/=D)*C*C*C*C+A},easeOutQuint:function(B,C,A,E,D){return E*((C=C/D-1)*C*C*C*C+1)+A},easeInOutQuint:function(B,C,A,E,D){if((C/=D/2)<1){return E/2*C*C*C*C*C+A}return E/2*((C-=2)*C*C*C*C+2)+A},easeInSine:function(B,C,A,E,D){return -E*Math.cos(C/D*(Math.PI/2))+E+A},easeOutSine:function(B,C,A,E,D){return E*Math.sin(C/D*(Math.PI/2))+A},easeInOutSine:function(B,C,A,E,D){return -E/2*(Math.cos(Math.PI*C/D)-1)+A},easeInExpo:function(B,C,A,E,D){return(C==0)?A:E*Math.pow(2,10*(C/D-1))+A},easeOutExpo:function(B,C,A,E,D){return(C==D)?A+E:E*(-Math.pow(2,-10*C/D)+1)+A},easeInOutExpo:function(B,C,A,E,D){if(C==0){return A}if(C==D){return A+E}if((C/=D/2)<1){return E/2*Math.pow(2,10*(C-1))+A}return E/2*(-Math.pow(2,-10*--C)+2)+A},easeInCirc:function(B,C,A,E,D){return -E*(Math.sqrt(1-(C/=D)*C)-1)+A},easeOutCirc:function(B,C,A,E,D){return E*Math.sqrt(1-(C=C/D-1)*C)+A},easeInOutCirc:function(B,C,A,E,D){if((C/=D/2)<1){return -E/2*(Math.sqrt(1-C*C)-1)+A}return E/2*(Math.sqrt(1-(C-=2)*C)+1)+A},easeInElastic:function(B,D,A,H,G){var E=1.70158;var F=0;var C=H;if(D==0){return A}if((D/=G)==1){return A+H}if(!F){F=G*0.3}if(C<Math.abs(H)){C=H;var E=F/4}else{var E=F/(2*Math.PI)*Math.asin(H/C)}return -(C*Math.pow(2,10*(D-=1))*Math.sin((D*G-E)*(2*Math.PI)/F))+A},easeOutElastic:function(B,D,A,H,G){var E=1.70158;var F=0;var C=H;if(D==0){return A}if((D/=G)==1){return A+H}if(!F){F=G*0.3}if(C<Math.abs(H)){C=H;var E=F/4}else{var E=F/(2*Math.PI)*Math.asin(H/C)}return C*Math.pow(2,-10*D)*Math.sin((D*G-E)*(2*Math.PI)/F)+H+A},easeInOutElastic:function(B,D,A,H,G){var E=1.70158;var F=0;var C=H;if(D==0){return A}if((D/=G/2)==2){return A+H}if(!F){F=G*(0.3*1.5)}if(C<Math.abs(H)){C=H;var E=F/4}else{var E=F/(2*Math.PI)*Math.asin(H/C)}if(D<1){return -0.5*(C*Math.pow(2,10*(D-=1))*Math.sin((D*G-E)*(2*Math.PI)/F))+A}return C*Math.pow(2,-10*(D-=1))*Math.sin((D*G-E)*(2*Math.PI)/F)*0.5+H+A},easeInBack:function(B,C,A,F,E,D){if(D==undefined){D=1.70158}return F*(C/=E)*C*((D+1)*C-D)+A},easeOutBack:function(B,C,A,F,E,D){if(D==undefined){D=1.70158}return F*((C=C/E-1)*C*((D+1)*C+D)+1)+A},easeInOutBack:function(B,C,A,F,E,D){if(D==undefined){D=1.70158}if((C/=E/2)<1){return F/2*(C*C*(((D*=(1.525))+1)*C-D))+A}return F/2*((C-=2)*C*(((D*=(1.525))+1)*C+D)+2)+A},easeInBounce:function(B,C,A,E,D){return E-jQuery.easing.easeOutBounce(B,D-C,0,E,D)+A},easeOutBounce:function(B,C,A,E,D){if((C/=D)<(1/2.75)){return E*(7.5625*C*C)+A}else{if(C<(2/2.75)){return E*(7.5625*(C-=(1.5/2.75))*C+0.75)+A}else{if(C<(2.5/2.75)){return E*(7.5625*(C-=(2.25/2.75))*C+0.9375)+A}else{return E*(7.5625*(C-=(2.625/2.75))*C+0.984375)+A}}}},easeInOutBounce:function(B,C,A,E,D){if(C<D/2){return jQuery.easing.easeInBounce(B,C*2,0,E,D)*0.5+A}return jQuery.easing.easeOutBounce(B,C*2-D,0,E,D)*0.5+E*0.5+A}});jQuery.extend(jQuery.easing,{easeIn:function(B,C,A,E,D){return jQuery.easing.easeInQuad(B,C,A,E,D)},easeOut:function(B,C,A,E,D){return jQuery.easing.easeOutQuad(B,C,A,E,D)},easeInOut:function(B,C,A,E,D){return jQuery.easing.easeInOutQuad(B,C,A,E,D)},expoin:function(B,C,A,E,D){return jQuery.easing.easeInExpo(B,C,A,E,D)},expoout:function(B,C,A,E,D){return jQuery.easing.easeOutExpo(B,C,A,E,D)},expoinout:function(B,C,A,E,D){return jQuery.easing.easeInOutExpo(B,C,A,E,D)},bouncein:function(B,C,A,E,D){return jQuery.easing.easeInBounce(B,C,A,E,D)},bounceout:function(B,C,A,E,D){return jQuery.easing.easeOutBounce(B,C,A,E,D)},bounceinout:function(B,C,A,E,D){return jQuery.easing.easeInOutBounce(B,C,A,E,D)},elasin:function(B,C,A,E,D){return jQuery.easing.easeInElastic(B,C,A,E,D)},elasout:function(B,C,A,E,D){return jQuery.easing.easeOutElastic(B,C,A,E,D)},elasinout:function(B,C,A,E,D){return jQuery.easing.easeInOutElastic(B,C,A,E,D)},backin:function(B,C,A,E,D){return jQuery.easing.easeInBack(B,C,A,E,D)},backout:function(B,C,A,E,D){return jQuery.easing.easeOutBack(B,C,A,E,D)},backinout:function(B,C,A,E,D){return jQuery.easing.easeInOutBack(B,C,A,E,D)}});(function(A){A.fn.cleanWhitespace=function(C){var D=this[0];if(A(D).hasClass("keep-whitespace")){return D}var E=D.firstChild;while(E){var B=E.nextSibling;if(E.nodeType==3){if(!/\S/.test(E.nodeValue)){D.removeChild(E)}else{var F=E.nodeValue;F=F.replace(/[\t\n\r\f]/g,"");F=F.replace(/\ {2,}/g," ");E.nodeValue=F}}else{if(C&&E.nodeType==1){A(E).cleanWhitespace(C)}}E=B}return D}})(jQuery);(function(A){A.fn.textNodes=function(B){var C=[];this.each(function(){var E=this.childNodes;for(var D=0;D<E.length;D++){var F=E[D];if(F.nodeType==3){C.push(F)}else{if(B&&F.nodeType==1){Array.prototype.push.apply(C,jQuery(F).textNodes(B,true))}}}});return arguments[1]?C:this.pushStack(C)}})(jQuery);(function(A){A.getSelectedText=function(){if(window.getSelection){var B=window.getSelection();return B.toString()}else{if(document.selection){var B=document.selection,C=B.createRange();return C.text}}};A.getSelection=function(P){if(window.getSelection){var H=window.getSelection();if(H.getRangeAt){var F=H.getRangeAt(0)}else{var F=document.createRange();F.setStart(H.anchorNode,H.anchorOffset);F.setEnd(H.focusNode,H.focusOffset)}L=F.cloneRange(),J=F.cloneRange();L.collapse(true);J.collapse(false);var Q=L.startContainer,U=J.endContainer,K=L.startOffset,C=J.endOffset,I=H.toString();if(P){H.removeAllRanges()}}else{if(document.selection){var H=document.selection,F=H.createRange();var I=F.text;if(I.length==0){return null}var L=F.duplicate(),J=F.duplicate();L.collapse(true);J.collapse(false);var R=L.parentElement();var D=J.parentElement();var E=document.body.createTextRange(),M=E.text.length;E.moveToElementText(R);E.collapse(true);var K=0;while(F.compareEndPoints("StartToStart",E)!=0&&K<M){K++;E.move("character")}E.moveToElementText(D);M=E.text.length;E.collapse(true);var C=0;while(F.compareEndPoints("EndToEnd",E)!=0&&C<M){C++;E.move("character")}var N=A(R).textNodes(true),Q;if(N.length==1){Q=N[0]}else{var T=0,G=0,B=0;while(G<=K){B=G;G+=N[T].length;T++}K-=B;Q=N[--T]}var S=A(D).textNodes(true),U;if(S.length==1){U=S[0]}else{var O=0,G=0,B=0;while(G<=C){B=G;G+=S[O].length;O++}C-=B;U=S[--O]}C=Math.min(C,U.length);if(P){H.empty()}}}if(Q!=U||K!=C){return{startContainer:Q,endContainer:U,startOffset:K,endOffset:C,text:I}}else{return null}}})(jQuery);(function(A){A.create=function(){var C=[],B=arguments,D,E;B=B[0].constructor==Array?B[0]:B;for(D=0;D<B.length;D++){if(B[D+1]&&B[D+1].constructor==Object){E=document.createElement(B[D]);A(E).attr(B[++D]);if(B[D+1]&&B[D+1].constructor==Array){A(E).append(A.create(B[++D]))}C.push(E)}else{C.push(document.createTextNode(B[D]))}}return C};A.tpl=function(D,C){var B=[];jQuery.each(D.constructor==Array?D:[D],function(){var F=A.create(C.apply(this));for(var E=0;E<F.length;E++){B.push(F[E])}});return B}})(jQuery);(function($){$.template=function(html,options){return new $.template.instance(html,options)};$.template.instance=function(html,options){if(options&&options.regx){options.regx=this.regx[options.regx]}this.options=$.extend({compile:false,regx:this.regx.standard},options||{});this.html=html;if(this.options.compile){this.compile()}this.isTemplate=true};$.template.regx=$.template.instance.prototype.regx={jsp:/\$\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,ext:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,jtemplates:/\{\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}\}/g};$.extend($.template.regx,{gettext:/\_\(([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\)/g});$.template.regx.standard=$.template.regx.jsp;$.template.helpers=$.template.instance.prototype.helpers={substr:function(value,start,length){return String(value).substr(start,length)}};$.extend($.template.instance.prototype,{apply:function(values){if(this.options.compile){return this.compiled(values)}else{var tpl=this;var fm=this.helpers;var fn=function(m,name,format,args){if(format){if(format.substr(0,5)=="this."){return tpl.call(format.substr(5),values[name],values)}else{if(args){var re=/^\s*['"](.*)["']\s*$/;args=args.split(",");for(var i=0,len=args.length;i<len;i++){args[i]=args[i].replace(re,"$1")}args=[values[name]].concat(args)}else{args=[values[name]]}return fm[format].apply(fm,args)}}else{return values[name]!==undefined?values[name]:""}};return this.html.replace(this.options.regx,fn)}},compile:function(){var sep=$.browser.mozilla?"+":",";var fm=this.helpers;var fn=function(m,name,format,args){if(format){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="(values['"+name+"'] == undefined ? '' : "}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"};var body;if($.browser.mozilla){body="this.compiled = function(values){ return '"+this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn)+"';};"}else{body=["this.compiled = function(values){ return ['"];body.push(this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn));body.push("'].join('');};");body=body.join("")}eval(body);return this}});var $_old={domManip:$.fn.domManip,text:$.fn.text,html:$.fn.html};$.fn.domManip=function(args,table,reverse,callback){if(args[0].isTemplate){args[0]=args[0].apply(args[1]);delete args[1]}var r=$_old.domManip.apply(this,arguments);return r};$.fn.html=function(value,o){if(value&&value.isTemplate){var value=value.apply(o)}var r=$_old.html.apply(this,[value]);return r};$.fn.text=function(value,o){if(value&&value.isTemplate){var value=value.apply(o)}var r=$_old.text.apply(this,[value]);return r}})(jQuery);(function(A){A.fn.generateXPath=function(C){A.fn.generateXPath.defaults={depth:0,maxDepth:99,context:document.body,namespace:null,kwds:{showId:1}};var E=A.extend({},A.fn.generateXPath.defaults,C);return B(this[0],E.depth,E.maxDepth,E.context,E.namespace,E.kwds);function B(I,L,G,F,J,H){var O="";if(!I){return""}if(I==F){return"."}if((I.parentNode)&&(L<G)){O+=B(I.parentNode,L+1,G,F,J,H)}switch(I.nodeType){case 1:var M=I.nodeName;var Q=[];var P=false;if(H.showClass&&A(I).attr("class")){Q.push("@class='"+I.getAttribute("class")+"'")}if(H.showId&&A(I).attr("id")){Q.push("@id='"+I.getAttribute("id")+"'");P=true}if(!P){var N=D(I);if(N){if(Q.length>0){Q.push("position()="+N)}else{Q.push(N)}}}if(H.showNS){if(I.prefix){M=I.prefix+":"+M}else{if(J){M="default:"+M}}}if(H.toLowercase){M=M.toLowerCase()}O+="/"+M;if(Q.length>0){O+="[";for(var K=0;K<Q.length;K++){if(K>0){O+=" and "}O+=Q[K]}O+="]"}break;case 9:break;case 3:O+="/text()";var N=D(I);if(N){O+="["+N+"]"}break}return O}function D(G){var L=G.parentNode.childNodes;var K=0;var F;if(G.nodeType==1){var H=G.nodeName;for(var I=0;I<L.length;I++){var J=L.item(I);if(J.nodeType==1){if(J.nodeName==H){K++}if(J==G){F=K}}}}else{if(G.nodeType==3){for(var I=0;I<L.length;I++){var J=L.item(I);if(J.nodeType==3){K++;if(J==G){F=K}}}}}if(K>1){return F}}}})(jQuery);(function(A){A.fn.wresize=function(C){version="1.1";wresize={fired:false,width:0};function B(){if(A.browser.msie){if(!wresize.fired){wresize.fired=true}else{var E=parseInt(A.browser.version,10);wresize.fired=false;if(E<7){return false}else{if(E==7){var F=A(window).width();if(F!=wresize.width){wresize.width=F;return false}}}}}return true}function D(E){if(B()){return C.apply(this,[E])}}this.each(function(){if(this==window){A(this).resize(D)}else{A(this).resize(C)}});return this}})(jQuery);(function(A){A.textResizeDetector=function(B){this.opts=A.extend({},A.textResizeDetector.defaults,B);this.initialize()};A.textResizeDetector.defaults={};A.textResizeDetector.prototype={id:"ResizeDetector",delay:800,create:function(){A("#"+this.id+"_text").remove();var C="position: absolute; padding: 0; left: -9999px; font-size:"+30+"px; line-height:"+30+"px;";var E="position: absolute; left: -9999px; width:10%; height:10%;";var B=A.create("span",{id:this.id+"_text",style:C,className:"write-protect"})[0];B.innerHTML="&nbsp;";var D=this.opts.target;D.appendChild(B);this.sizeT=30;return B},initialize:function(){this.create();this.check=window.setInterval(this.detect,this.delay)},detect:function(){var C=A("#ResizeDetector_text");if(!C.length){C=this.create()}var B=C.height();if(B!=this.sizeT){var D=30/B;A(document).trigger("textResize",D);this.sizeT=B;A(".fixedFontSize9").each(function(E){var F=Math.max(9*D,1);A(this).css({fontSize:F+"px",lineHeight:F+"px"})});A(".fixedFontSize11").each(function(E){var F=Math.max(11*D,1);A(this).css({fontSize:F+"px",lineHeight:F+"px"})});A(".fixedFontSize12").each(function(E){var F=Math.max(12*D,1);A(this).css({fontSize:F+"px",lineHeight:F+"px"})})}}}})(jQuery);(function(C){var A=C.scrollTo=function(F,E,D){C(window).scrollTo(F,E,D)};A.defaults={axis:"y",duration:1};A.window=function(D){return C(window).scrollable()};C.fn.scrollable=function(){return this.map(function(){var G=this.parentWindow||this.defaultView,E=this.nodeName=="#document"?G.frameElement||G:this,F=E.contentDocument||(E.contentWindow||E).document,D=E.setInterval;return E.nodeName=="IFRAME"||D&&C.browser.safari?F.body:D?F.documentElement:this})};C.fn.scrollTo=function(F,E,D){if(typeof E=="object"){D=E;E=0}if(typeof D=="function"){D={onAfter:D}}D=C.extend({},A.defaults,D);E=E||D.speed||D.duration;D.queue=D.queue&&D.axis.length>1;if(D.queue){E/=2}D.offset=B(D.offset);D.over=B(D.over);return this.scrollable().each(function(){var M=this,K=C(M),L=F,J,H={},N=K.is("html,body");switch(typeof L){case"number":case"string":if(/^([+-]=)?\d+(px)?$/.test(L)){L=B(L);break}L=C(L,this);case"object":if(L.is||L.style){J=(L=C(L)).offset()}}C.each(D.axis.split(""),function(R,S){var T=S=="x"?"Left":"Top",V=T.toLowerCase(),Q="scroll"+T,O=M[Q],P=S=="x"?"Width":"Height",U=P.toLowerCase();if(J){H[Q]=J[V]+(N?0:O-K.offset()[V]);if(D.margin){H[Q]-=parseInt(L.css("margin"+T))||0;H[Q]-=parseInt(L.css("border"+T+"Width"))||0}H[Q]+=D.offset[V]||0;if(D.over[V]){H[Q]+=L[U]()*D.over[V]}}else{H[Q]=L[V]}if(/^\d+$/.test(H[Q])){H[Q]=H[Q]<=0?0:Math.min(H[Q],G(P))}if(!R&&D.queue){if(O!=H[Q]){I(D.onAfterFirst)}delete H[Q]}});I(D.onAfter);function I(O){K.animate(H,E,D.easing,O&&function(){O.call(this,F,D)})}function G(P){var O="scroll"+P,Q=M.ownerDocument;return N?Math.max(Q.documentElement[O],Q.body[O]):M[O]}}).end()};function B(D){return typeof D=="object"?D:{top:D,left:D}}})(jQuery);(function(E){E.fn.jqm=function(F){var A={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:O,ajaxText:"",target:O,modal:O,toTop:O,onShow:O,onHide:O,onLoad:O};return this.each(function(){if(this._jqm){return N[this._jqm].c=E.extend({},N[this._jqm].c,F)}P++;this._jqm=P;N[P]={c:E.extend(A,E.jqm.params,F),a:O,w:E(this).addClass("jqmID"+P),s:P};if(A.trigger){E(this).jqmAddTrigger(A.trigger)}})};E.fn.jqmAddClose=function(A){return M(this,A,"jqmHide")};E.fn.jqmAddTrigger=function(A){return M(this,A,"jqmShow")};E.fn.jqmShow=function(A){return this.each(function(){E.jqm.open(this._jqm,A)})};E.fn.jqmHide=function(A){return this.each(function(){E.jqm.close(this._jqm,A)})};E.jqm={hash:{},open:function(V,U){var L=N[V],Q=L.c,H="."+Q.closeClass,R=(parseInt(L.w.css("z-index"))),R=(R>0)?R:3000,F=E("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":R-1,opacity:Q.overlay/100});if(L.a){return O}L.t=U;L.a=true;L.w.css("z-index",R);if(Q.modal){if(!B[0]){K("bind")}B.push(V)}else{if(Q.overlay>0){L.w.jqmAddClose(F)}else{F=O}}L.o=(F)?F.addClass(Q.overlayClass).prependTo("body"):O;if(D){E("html,body").css({height:"100%",width:"100%"});if(F){F=F.css({position:"absolute"})[0];for(var S in {Top:1,Left:1}){F.style.setExpression(S.toLowerCase(),"(_=(document.documentElement.scroll"+S+" || document.body.scroll"+S+"))+'px'")}}}if(Q.ajax){var A=Q.target||L.w,T=Q.ajax,A=(typeof A=="string")?E(A,L.w):E(A),T=(T.substr(0,1)=="@")?E(U).attr(T.substring(1)):T;A.html(Q.ajaxText).load(T,function(){if(Q.onLoad){Q.onLoad.call(this,L)}if(H){L.w.jqmAddClose(E(H,L.w))}J(L)})}else{if(H){L.w.jqmAddClose(E(H,L.w))}}if(Q.toTop&&L.o){L.w.before('<span id="jqmP'+L.w[0]._jqm+'"></span>').insertAfter(L.o)}(Q.onShow)?Q.onShow(L):L.w.show();J(L);return O},close:function(F){var A=N[F];if(!A.a){return O}A.a=O;if(B[0]){B.pop();if(!B[0]){K("unbind")}}if(A.c.toTop&&A.o){E("#jqmP"+A.w[0]._jqm).after(A.w).remove()}if(A.c.onHide){A.c.onHide(A)}else{A.w.hide();if(A.o){A.o.remove()}}return O},params:{}};var P=0,N=E.jqm.hash,B=[],D=E.browser.msie&&(E.browser.version=="6.0"),O=false,G=E('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),J=function(A){if(D){if(A.o){A.o.html('<p style="width:100%;height:100%"/>').prepend(G)}else{if(!E("iframe.jqm",A.w)[0]){A.w.prepend(G)}}}I(A)},I=function(F){try{E(":input:visible",F.w)[0].focus()}catch(A){}},K=function(A){E()[A]("keypress",C)[A]("keydown",C)[A]("mousedown",C)},C=function(H){var A=N[B[B.length-1]],F=(!E(H.target).parents(".jqmID"+A.s)[0]);if(F){I(A)}return !F},M=function(A,F,H){return A.each(function(){var L=this._jqm;E(F).each(function(){if(!this[H]){this[H]=[];E(this).click(function(){for(var Q in {jqmShow:1,jqmHide:1}){for(var R in this[Q]){if(N[this[Q][R]]){N[this[Q][R]].w[Q](this)}}}return O})}this[H].push(L)})})}})(jQuery);(function(A){A.jGrowl=function(B,C){if(A("#jGrowl").size()==0){A('<div id="jGrowl"></div>').addClass(A.jGrowl.defaults.position).appendTo(A.jGrowl.defaults.appendTo)}A("#jGrowl").jGrowl(B,C)};A.fn.jGrowl=function(B,D){if(A.isFunction(this.each)){var C=arguments;return this.each(function(){var E=this;if(A(this).data("jGrowl.instance")==undefined){A(this).data("jGrowl.instance",new A.fn.jGrowl());A(this).data("jGrowl.instance").startup(this)}if(A.isFunction(A(this).data("jGrowl.instance")[B])){A(this).data("jGrowl.instance")[B].apply(A(this).data("jGrowl.instance"),A.makeArray(C).slice(1))}else{A(this).data("jGrowl.instance").notification(B,D)}})}};A.extend(A.fn.jGrowl.prototype,{defaults:{header:"",sticky:false,position:"top-right",glue:"after",theme:"default",corners:"10px",check:500,life:3000,speed:"normal",easing:"swing",closer:true,closerTemplate:"<div>[ close all ]</div>",log:function(C,B,D){},beforeOpen:function(C,B,D){},open:function(C,B,D){},beforeClose:function(C,B,D){},close:function(C,B,D){},appendTo:"body",animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},element:null,interval:null,notification:function(C,E){var B=this;var E=A.extend({},this.defaults,E);E.log.apply(this.element,[this.element,C,E]);var D=A('<div class="jGrowl-notification"><div class="close">&times;</div><div class="header">'+E.header+'</div><div class="message">'+C+"</div></div>").data("jGrowl",E).addClass(E.theme).children("div.close").bind("click.jGrowl",function(){A(this).unbind("click.jGrowl").parent().trigger("jGrowl.beforeClose").animate(E.animateClose,E.speed,E.easing,function(){A(this).trigger("jGrowl.close").remove()})}).parent();(E.glue=="after")?A("div.jGrowl-notification:last",this.element).after(D):A("div.jGrowl-notification:first",this.element).before(D);A(D).bind("mouseover.jGrowl",function(){A(this).data("jGrowl").pause=true}).bind("mouseout.jGrowl",function(){A(this).data("jGrowl").pause=false}).bind("jGrowl.beforeOpen",function(){E.beforeOpen.apply(B.element,[B.element,C,E])}).bind("jGrowl.open",function(){E.open.apply(B.element,[B.element,C,E])}).bind("jGrowl.beforeClose",function(){E.beforeClose.apply(B.element,[B.element,C,E])}).bind("jGrowl.close",function(){E.close.apply(B.element,[B.element,C,E])}).trigger("jGrowl.beforeOpen").animate(E.animateOpen,E.speed,E.easing,function(){A(this).data("jGrowl").created=new Date()}).trigger("jGrowl.open");if(A.fn.corner!=undefined){A(D).corner(E.corners)}if(A("div.jGrowl-notification:parent",this.element).size()>1&&A("div.jGrowl-closer",this.element).size()==0&&this.defaults.closer!=false){A(this.defaults.closerTemplate).addClass("jGrowl-closer").addClass(this.defaults.theme).appendTo(this.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){A(this).siblings().children("div.close").trigger("click.jGrowl");if(A.isFunction(B.defaults.closer)){B.defaults.closer.apply(A(this).parent()[0],[A(this).parent()[0]])}})}},update:function(){A(this.element).find("div.jGrowl-notification:parent").each(function(){if(A(this).data("jGrowl")!=undefined&&A(this).data("jGrowl").created!=undefined&&(A(this).data("jGrowl").created.getTime()+A(this).data("jGrowl").life)<(new Date()).getTime()&&A(this).data("jGrowl").sticky!=true&&(A(this).data("jGrowl").pause==undefined||A(this).data("jGrowl").pause!=true)){A(this).children("div.close").trigger("click.jGrowl")}});if(A(this.element).find("div.jGrowl-notification:parent").size()<2){A(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){A(this).remove()})}},startup:function(B){this.element=A(B).addClass("jGrowl").append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){jQuery(B).data("jGrowl.instance").update()},this.defaults.check);if(A.browser.msie&&parseInt(A.browser.version)<7){A(this.element).addClass("ie6")}},shutdown:function(){A(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval)}});A.jGrowl.defaults=A.fn.jGrowl.prototype.defaults})(jQuery);(function(A){A.aqCookie={domain:"",secToExpire:3153600000,get:function(B){if(typeof B=="string"){B=[B]}var F=[];var C=document.cookie.split(";");for(var E=0;E<C.length;E++){var H=C[E];while(H.charAt(0)==" "){H=H.substring(1,H.length)}for(var D=0;D<B.length;D++){var G=B[D]+"=";if(H.indexOf(G)==0){F[B[D]]=H.substring(G.length,H.length)}}}return F},set:function(C,B){if(B){var D=new Date();D.setTime(D.getTime()+A.aqCookie.secToExpire);document.cookie=C+"="+B+"; path=/; domain="+A.aqCookie.domain+"; expires="+D.toGMTString()+'";'}else{document.cookie=C+"=; path=/; domain="+A.aqCookie.domain+"; expires=Thu, 01-Jan-1970 00:00:01 GMT;"}},all:function(E){var F=[];var B=document.cookie.split(";");var D=new RegExp(E);for(var C=0;C<B.length;C++){var G=B[C];while(G.charAt(0)==" "){G=G.substring(1,G.length)}if(!G.match(D)){continue}F.push(G.substring(0,G.indexOf("=")))}return F},del:function(B){A.aqCookie.set(B)}}})(jQuery);(function(A){A.simpleXpath=function(B,E){var G=B.split("/text()");B=G[0];var H=G[1].replace(/[\[\]]/g,"");B=B.replace(/\.\//g,">");B=B.replace(/\//g,">");var F=B.split(/[\[\]]/);for(var D=0,C=F.length;D<C;D++){if(Number(F[D])>0){F[D]=":eq("+(F[D]-1)+")"}}B=F.join("");return A(E+B).textNodes(true)[H]}})(jQuery);eMend.dictionary={comment:{delete_note_H:"Elimina questo commento",edit_note_H:"Modifica questo commento",author:"autore",baseURI:"images"},comment_more:{read_more:"Espandi il testo",read_less:"Riduci il testo",baseURI:"images"},commentForm:{comment:"commento",note:"nota",subject:"oggetto",cancel:"annulla",confirm:"conferma",tags:"tags"},commentGroup:{read_more:"Espandi il gruppo",read_less:"Riduci il gruppo",comment:"commento",comments:"commenti",baseURI:"images"},commentTrigger:{select_text:"seleziona il testo che vuoi commentare",activate_comment:"premi 'C' per commentare il testo selezionato",write_comment:"scrivi nel commento ci&ograve; che pensi",disable_HOL:"non mostrare pi&ugrave; i messaggi di aiuto",outside_boudaries:"la selezione &egrave; fuori dall'area commentabile"},sidebar:{hidelink:"Nascondi collegamento visuale",showlink:"Mostra collegamento visuale",baseURI:""}};(function(A){eMend.templates={comment:'<div class="actions"><a href="#" title="_(delete_note_H)" class="deletenote" onclick="return false;">&nbsp;</a><a href="#" title="_(edit_note_H)" class="editnote" onclick="return false;">&nbsp;</a></div><h6><img src="_(baseURI)/user${userIdx}.png" /><strong>${author}</strong> [${date}]:</h6><h5>${title}</h5><p><span class="commentbody">${body}</span></p>',comment_more:'...<img src="_(baseURI)/more.png" alt="_(readmore)" class="readmore" /><img src="_(baseURI)/less.png" alt="_(readless)" class="readless" style="display:none;" />',commentForm:'<form id="noteForm" class="Emend" onsubmit="return false; void(0);" style="background-image: url(_(baseURI)/bg-fff-diag.gif);"><fieldset><legend>_(comment)</legend><p><label for="noteSubject">_(subject):</label><span><input type="text" id="noteSubject" name="noteSubject" size="29" /></span><br/></p><p><label for="noteText">_(note):</label><span><textarea id="noteText" name="noteText" cols="28" rows="10" ></textarea></span><br class="clear"/></p><!--<p><label for="noteTags">_(tags):</label><span><input type="text" id="noteTags" name="noteTags" size="29" /></span><br/></p>--><p class="Emend-right"><button type="button" class="submit" id="submitNote" onclick="return false; void(0);" style="background: #FFFFFF url(_(baseURI)/bg_form_element.png) repeat-x;"><span class="ico confirm">_(confirm)<img src="_(baseURI)/ico-confirm.png" /></span></button></p><p class="Emend-left"><button type="button" class="submit" id="cancelNote" onclick="return false; void(0);" style="background: #FFFFFF url(_(baseURI)/bg_form_element.png) repeat-x;"><span class="ico cancel"><img src="_(baseURI)/ico-cancel.png" />_(cancel)</span></button></p></fieldset></form>',commentGroup:'<span><div class="nodetoggle"><img src="_(baseURI)/less_big.png" alt="_(readless)" class="closegroup"><img src="_(baseURI)/more_big.png" title="_(readmore)" class="opengroup" /></div></span>',commentTrigger:'<ul class="lavalamp"><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><h2 class="helpOnLine"><img src="_(baseURI)/selectText.png"/><span class="pulse" unselectable="on">_(select_text)</span></h2></div><label><input type="checkbox" class="emendHideHOL"/>_(disable_HOL)</label></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><h2 class="helpOnLine"><img src="_(baseURI)/pressC.png"/><span class="pulse" unselectable="on">_(activate_comment)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><h2 class="helpOnLine"><img src="_(baseURI)/chat.png"/><span class="pulse" unselectable="on">_(write_comment)</span></h2></div></li><li><div class="HOLbg" style="background-image: url(_(baseURI)/orange-gradient.png);"><h2 class="helpOnLine"><img src="_(baseURI)/selectText.png"/><span class="pulse" unselectable="on">_(outside_boudaries)</span></h2></div></li></ul>',sidebar:'<div class="sidebar-Y-header"><img src="_(baseURI)/ico-arrow-left.png" class="opensidebar" /><p class="version">0.3<br/>&beta;3</p><img src="_(baseURI)/emend-vertical.png" alt="e-mend"/></div><div class="sidebar-wrapper"><div class="sidebar-X-header"><!--<div class="extendsidebar"></div>--><img src="_(baseURI)/ico-arrow-right.png" class="closesidebar" /><img src="_(baseURI)/emend-horizontal.png" class="logo" alt="e-mend"/><sup class="version">0.3&beta;3</sup></div><div id="sidebar-body"></div></div>'}})(jQuery);(function(A){eMend.dataset=function(B){if(!(this instanceof arguments.callee)){return new eMend.dataset(B)}this.opts=A.extend({},eMend.dataset.defaults,B);this._selections=[];this._comments=[];this._users=[];this._usersByName={};this._currentUser=-1;this._notesByDate={};this._notesFirstDate=null;this._notesLastDate=null;this._timeRange=[];this._filteredNodes={};this._nodeCommentsCount={};this._contentBkp=[];this.bkpContent(this.opts.target);this._contentEl=this.opts.target;this.initNodeFilters(this.opts.target,false);this.loginAsGuest()};eMend.dataset.defaults={};eMend.dataset.prototype={getContentEl:function(){return this._contentEl},getTimeRange:function(){if(!this._timeRange.length){this.initTimeRangeFilters()}return this._timeRange},getNotesFirstDate:function(){if(!this._notesFirstDate){this.updateNotesByDate()}return this._notesFirstDate},getNotesLastDate:function(){if(!this._notesLastDate){this.updateNotesByDate()}return this._notesLastDate},getSelections:function(){return this._selections},getComments:function(){return this._comments},getComment:function(B,C){return this._comments[B][C]},getCommentData:function(B,C){var D=this._comments[B][C];return{title:D[0],body:D[1],date:D[2],userIdx:B}},getCommentElement:function(B,C){var D=this._comments[B][C];return D.getElement()},getCurrentUser:function(){return this._currentUser},setCurrentUser:function(B){if(typeof B=="number"){this._currentUser=B}},getFilteredNodes:function(){return this._filteredNodes},getRawNodeMap:function(){return this.mapNodes(this._contentEl)},getMarkedNodeMap:function(){return this.markNodeMap()},bkpContent:function(B){this._contentBkp=[];if(this.opts.datastore){if(A("#eMend-content-backup").length==0){this.bkpContentOnDOM(B)}else{this.restoreContentFromDOM(B)}}var D=B.childNodes,E,F;for(var C in D){E=D[C];if(!E.nodeType||A(E).hasClass("write-protect")){continue}switch(E.nodeType){case 1:case 3:F=E.cloneNode(true);this._contentBkp.push(F);break}}},restoreContent:function(){var D=this._contentEl;var E=D.childNodes,F,B=this._contentBkp,G=0;while(E.length-G){if(A(D.firstChild).hasClass("write-protect")){G++;continue}D.removeChild(D.firstChild)}for(var C=B.length-1;C>-1;C--){D.insertBefore(B[C].cloneNode(true),D.firstChild)}document.body.normalize()},bkpContentOnDOM:function(C){var B=A.create("div",{id:"eMend-content-backup"});A(this.opts.datastore).append(B);var D=C.cloneNode(true);A(D).find("*[id]").each(function(){A(this)[0].id+="__bkp__"});B[0].innerHTML=D.innerHTML},restoreContentFromDOM:function(C){var B=A("#eMend-content-backup")[0];var D=B.cloneNode(true);A(D).find("*[id]").each(function(){var E=A(this)[0].id;A(this)[0].id=E.substr(0,E.indexOf("__bkp__"))});C.innerHTML=D.innerHTML;document.body.normalize()},addComment:function(I,J,K){if(typeof K=="undefined"){K=this._currentUser}var H=new Date();var E=H.format(Date.ISO8601c);var C=this._comments[K].length;var D=this._users[K];var G=0;var B={author:D,title:I,body:J,date:E,userIdx:K,noteIdx:C};var F=this._comments[K].push(new eMend.comment(B,{animate:false}));this.insertNoteByDate(E,K,F-1);this.lastComment={user:K,idx:F-1};A(document).trigger("emend.addComment");return(F-1)},modifyComment:function(E,I,D,F){var H=this._comments[D][F];var G=new Date();var C=G.format(Date.ISO8601c);var B=H[4];this._comments[D][F]=[E,I,C,I.length,B]},getLastComment:function(){return this._comments[this.lastComment.user][this.lastComment.idx]},remapSelectionToContent:function(K){var B=K.startContainer.parentNode,H=K.endContainer.parentNode,D=A(B).attr("node"),E=A(B).attr("fragment")||0,I=A(H).attr("node"),F=A(H).attr("fragment")||0;var J=E==0?K.startOffset:this._markedNodeMap.fM[D][E-1][1]+K.startOffset;var G=F==0?K.endOffset:this._markedNodeMap.fM[I][F-1][1]+K.endOffset;this.restoreContent();var C=A(this._contentEl).textNodes(true);return{startContainer:C[D],endContainer:C[I],startOffset:J,endOffset:G}},addSelection:function(K){if(typeof K=="undefined"){K=this._currentUser}var J=A.getSelection(true);switch(J.startContainer.parentNode.tagName){case"NODEBLOCK":case"NODEINNER":J=this.remapSelectionToContent(J);break}var G=A(J.startContainer).parents("*[id]");G=G[0]?G[0]:document.body;var H=G.id?G.id:"__noId__";var I=A(J.startContainer).generateXPath({context:G});var B=[J.startOffset,J.endOffset,{xpath:I,base:H}];if(J.startContainer!=J.endContainer){var F=A(J.endContainer).parents("*[id]");F=F[0]?F[0]:document.body;var D=F.id?F.id:"__noId__";var E=A(J.endContainer).generateXPath({context:F});B.push({xpath:E,base:D})}var C=this._selections[K].push(B);this.lastSelection={user:K,idx:C-1}},getLastSelection:function(){return this._selections[this.lastSelection.user][this.lastSelection.idx]},removeLastSelection:function(){this._selections[this.lastSelection.user].splice(this.lastSelection.idx,1)},addUser:function(C){this._selections.push([]);this._comments.push([]);var B=this._users.push(C);this._usersByName[C]=B-1;return(B-1)},removeUser:function(B){if(B>0){this._selections.splice(B,1);this._comments.splice(B,1);this._users.splice(B,1)}},getUser:function(B){return this._users[B]},getOrCreateUser:function(B){var C=this._usersByName[B];if(C>=0){return C}return this.addUser(B)},loginAsGuest:function(){this.removeUser(this._currentUser);this._author="guest";this._authorHash="Sandbox";this._password="guest";this.addUser("guest");this._currentUser=0},loginAs:function(B,C){this._author=B;this._password=C;this._currentUser=this.addUser(B);this._authorHash=emendCRYPTOutils.md5(B+C)},importEmendment:function(D,E){E.selection=D;var B=this.getOrCreateUser(E.author);E.userIdx=B;var C=this._selections[B].push(D);E.noteIdx=C-1;this.lastSelection={user:B,idx:C-1};var F=this._comments[B].push(new eMend.comment(E));this.lastComment={user:B,idx:F-1};this.insertNoteByDate(E.date,B,F-1)},initTimeRangeFilters:function(){if(!this.notesFirstDate){var C=new Date();var B=C.format(C,"%Y%%m%%d%");this._notesFirstDate=B;this._notesLastDate=B}this._timeRange[0]=this._notesFirstDate;this._timeRange[1]=this._notesLastDate},setTimeRangeFilter:function(C,B){this._timeRange[0]=Number(C);this._timeRange[1]=Number(B)},updateNotesByDate:function(){var I,D,G,C,E,B,H,F;I=new Date();D=I.format("%Y%%m%%d%");this._notesFirstDate=D;this._notesLastDate=D;G=this._notesByDate={};for(C=0,H=this._comments.length;C<H;C++){F=this._comments[C];for(E=0,B=F.length;E<B;E++){D=Number(F[E][2].substr(0,8));if(!G[D]){G[D]=[]}G[D].push(C+"_"+E);this._notesFirstDate=Math.min(D,this._notesFirstDate);this._notesLastDate=Math.max(D,this._notesLastDate)}}},insertNoteByDate:function(B,C,D){B=Number(B.substr(0,8));if(!this._notesByDate[B]){this._notesByDate[B]=[]}this._notesByDate[B].push(C+"_"+D);this._notesFirstDate=Math.min(B,this._notesFirstDate);this._notesLastDate=Math.max(B,this._notesLastDate)},mapNodes:function(C){var B=[];var H=[];var I=[];function G(K){switch(K.parentNode.tagName){case"SCRIPT":case"NOSCRIPT":return NodeFilter.FILTER_REJECT;break}return NodeFilter.FILTER_ACCEPT}function F(K){B.push(K);H.push([K.nodeValue]);I.push([[0,K.nodeValue.length,[]]])}function D(K){switch(K.parentNode.tagName){case"SCRIPT":case"NOSCRIPT":return;break}B.push(K);H.push([K.nodeValue]);I.push([[0,K.nodeValue.length,[]]])}if(document.createTreeWalker&&jQuery.browser.mozilla){function E(K){var M=K.currentNode;for(var L=K.firstChild();L!=null;L=K.nextSibling()){F(L);E(K)}K.currentNode=M}var J=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,G,false);E(J);J=null}else{A(document.body).textNodes(true).each(function(){D(this)})}this._rawNodeMap={n:B,f:H,fM:I};return this._rawNodeMap},markNodeMap:function(){var s=this._selections,T=this._comments,X=this.getRawNodeMap();var c=X.n,a=X.f,B=X.fM;var P=this.getTimeRange();var G,F,f,t,v,D,b,e,g,y,w,Y,p,I,m,Z;var C,x,W,h;var O=document.evaluate?0:1;for(var d=0,N=s.length;d<N;d++){G=s[d];F=T[d];for(var q=0,M=G.length;q<M;q++){t=Number(F[q].getISO8601c());if(t<P[0]||t>P[1]){continue}f=G[q];v=f[0];D=f[1];b=f[2];e=f[3]?f[3]:f[2];switch(O){case 0:w=b.base=="__noId__"?document.body:document.getElementById(b.base);Y=e.base=="__noId__"?document.body:document.getElementById(e.base);g=document.evaluate(b.xpath,w,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;y=document.evaluate(e.xpath,Y,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;break;case 1:w=b.base=="__noId__"?"body":"#"+b.base;Y=e.base=="__noId__"?"body":"#"+e.base;g=A.simpleXpath(b.xpath,w);y=A.simpleXpath(e.xpath,Y);break}p=I=-1;for(var o=0,L=c.length;o<=L;o++){if(g==c[o]){p=o}if(y==c[o]){I=o}if(p!=-1&&I!=-1){break}}if(p==-1||I==-1){continue}var J=a[p];var H=a[I];var R=B[p];var S=B[I];m=Z=-1;for(var o=0,L=R.length;o<L;o++){if(m==-1&&v>=R[o][0]&&v<=R[o][1]){m=o;break}}for(var o=0,L=S.length;o<L;o++){if(Z==-1&&D>=S[o][0]&&D<=S[o][1]){Z=o;break}}var K=J[m];var U=B[p][m];C=K.slice(0,v-U[0]);if(C.length){J[m]=K.slice(v-U[0]);J.splice(m,0,C);W=U[0];U[0]=v;B[p].splice(m,0,[W,v-1,U[2].slice(0)]);m++;if(p==I){Z++}}var E=H[Z];var V=B[I][Z];x=E.slice(D-V[0]);if(x.length){H[Z]=E.slice(0,D-V[0]);H.splice(Z+1,0,x);h=V[1];V[1]=D;B[I].splice(Z+1,0,[D,h,V[2].slice(0)])}for(var o=p;o<=I;o++){var Q=o==p?m:0;var z=o==I?Z+1:B[o].length;for(var n=Q;n<z;n++){B[o][n][2].push(d+"_"+q)}}}}this._markedNodeMap={n:c,f:a,fM:B};return this._markedNodeMap},initNodeFilters:function(D,C){var E=this.mapNodes(D);for(var B=0;B<E.n.length;B++){C?this.addNodeFilter(B):this.removeNodeFilter(B)}},filterAllNodes:function(){for(node in this._filteredNodes){this.addNodeFilter(node)}},unfilterAllNodes:function(){for(node in this._filteredNodes){this.removeNodeFilter(node)}},addNodeFilter:function(B){this._filteredNodes[B]=true},removeNodeFilter:function(B){this._filteredNodes[B]=false},toggleNodeFilter:function(I,F){var C=I.target;var D=emendARRAYutils.createFromWords(C.getAttribute("relNodes"));for(var G=0,H=D.length;G<H;G++){var J=D[G];var E=this._filteredNodes[J]=!this._filteredNodes[J];var B=document.getElementById("block"+J);B.setAttribute("hidenotes",E)}var E=this._filteredNodes[F];C.className="cMark_"+E+" fixedFontSize9";this.clearLinks();if(E){Emend.events.Notes.fadeNodeNotes.fire(C)}else{Emend.events.Notes.appearNodeNotes.fire(C)}}}})(jQuery);(function(A){eMend.highlight=function(K){var P=K.getMarkedNodeMap(),O=P.n,X=P.f,W=P.fM,M,L,E,N,V,R;var U=K.getFilteredNodes();for(var T=0,I=O.length;T<I;T++){var H=U[T];var Q=O[T];var C=X[T];var J=W[T];var B=Q.parentNode;var D=document.createElement("NODEBLOCK");D.id="block"+T;D.className="emend-block";D.setAttribute("hidenotes",H);D.setAttribute("node",T);var F=[];for(var S=0,G=C.length;S<G;S++){L=C[S];E=J[S];M=document.createElement("NODEINNER");M.setAttribute("node",T);M.setAttribute("fragment",S);if(E[2].length){F=F.concat(arrDiff(F,E[2]));R=Math.min(E[2].length,40);N=E[2].length+" comments";V="highlight n"+E[2].join(" n")+" a"+R;M.setAttribute("title",N);M.className=V}M.appendChild(document.createTextNode(L));D.appendChild(M)}B.replaceChild(D,Q)}A(document).trigger("emend.highlight")}})(jQuery);(function(A){eMend.comment=function(D,C){if(D){this.data=D;this.data.textlength=D.body.length;var B=eMend.comment.defaults.shortlength;if(this.data.textlength>B){this.data.shorttext=D.body.substr(0,B)+"..."}}this.opts=A.extend({},eMend.comment.defaults,C);this.template=A.template(eMend.templates.comment,{regx:"gettext"}).apply(eMend.dictionary.comment);this.templateMore=A.template(eMend.templates.comment_more,{regx:"gettext"}).apply(eMend.dictionary.comment_more)};eMend.comment.defaults={shortlength:100,animate:true};eMend.comment.prototype={getElement:function(D){if(!this.element){var E=this.data.userIdx+"_"+this.data.noteIdx;var B=A.template(this.template).apply(this.data);var C=A.create("div",{id:"note"+E,note:E,className:D})[0];C.innerHTML=B;this.element=C}A(this.element).mouseover(this.over).mouseout(this.out);this.morelesstext(A(this.element).find(".commentbody")[0]);return this.element},getISO8601c:function(){return this.data.date.substr(0,8)},hide:function(){return this.opts.animate?A(this.element).slideUp(200):A(this.element).hide()},show:function(){return this.opts.animate?A(this.element).slideDown(200):A(this.element).show()},over:function(){var B=".n"+this.id.substr(4);A(B).css({borderTop:"1px dashed red",borderBottom:"1px dashed red"})},out:function(){var B=".n"+this.id.substr(4);A(B).css({borderTop:"none",borderBottom:"none"})},morelesstext:function(C){var B=C.firstChild;if(B&&B.nodeType==3&&B.length>150){var D=A(C);D.attr("fulltext",B.data);D.html(B.data.substr(0,150)+this.templateMore);D.click(this.toggleText)}},toggleText:function(C){var D=A(this);var B=D.children(".readmore, .readless").toggle();if(D.attr("fulltext")){D.attr("shorttext",D[0].firstChild.data);D[0].firstChild.data=D.attr("fulltext");D.removeAttr("fulltext")}else{D.attr("fulltext",D[0].firstChild.data);D[0].firstChild.data=D.attr("shorttext");D.removeAttr("shorttext")}}}})(jQuery);(function(A){eMend.commentGroup=function(B){this.data=B;this.comments=[];this.template=A.template(eMend.templates.commentGroup,{regx:"gettext"}).apply(eMend.dictionary.commentGroup)};eMend.commentGroup.prototype={getElement:function(){if(!this.element){var D=this.data.nodeGroup;var C=this.data.nodeClass;this.element=A.create("div",{id:"noteGroup"+D,"class":C,node:D})[0];this.element.innerHTML=this.template;this.counter=A.create("h6",{unselectable:"on"})[0];this.element.appendChild(this.counter);var B=this;A(this.element).find(".closegroup, .opengroup").click(function(){B.toggleGroup(B.element)})}return this.element},updateCounter:function(B){var C=B>1?B+" "+eMend.dictionary.commentGroup.comments:B+" "+eMend.dictionary.commentGroup.comment;A(this.counter).text(C);B=Math.min(B,40);this.counter.className="a"+B},appendChild:function(B){this.comments.push(B);this.updateCounter(this.comments.length);this.element.appendChild(B)},prependChild:function(C){this.comments.unshift(C);var B=this.comments.length;this.updateCounter(B);if(B>1){this.element.insertBefore(C,this.comments[1])}else{this.element.appendChild(C)}},toggleGroup:function(B){A(B).children(".emend-note").toggle();A(B).toggleClass("readfull").toggleClass("readpart");A(document).trigger("emend.toggleGroup")},closeGroup:function(){A(this.element).addClass("readpart").removeClass("readfull")},openGroup:function(){A(this.element).addClass("readfull").removeClass("readpart")}}})(jQuery);(function(A){eMend.commentForm=function(B){if(!(this instanceof arguments.callee)){return new eMend.commentForm(B)}this.opts=A.extend({},eMend.commentForm.defaults,B);this.dataset=this.opts.dataset;this.active=false;this.template=A.template(eMend.templates.commentForm,{regx:"gettext"}).apply(eMend.dictionary.commentForm);this.create()};eMend.commentForm.defaults={};eMend.commentForm.prototype={create:function(){var D=A("#NoteFormContainer").remove()[0];if(!D){var C=A.template(this.template).apply(this.data);D=A.create("div",{id:"NoteFormContainer",className:"jqmWindow340 write-protect"})[0];D.innerHTML=C}A(this.opts.target).append(D);var B=this;A("#cancelNote").click(function(){B.cancel()});A("#submitNote").click(function(){B.submit()})},show:function(){this.active=true;this.dataset.addSelection();if(!A("#NoteFormContainer")[0]){this.create()}A("#noteSubject").attr("value","");A("#noteText").attr("value","");A("#NoteFormContainer").jqm({modal:true}).jqmShow();window.focus();A("#noteSubject")[0].focus()},submit:function(){var E=A("#noteSubject").attr("value");var D=A("#noteText").attr("value");var C=this.check(E,D);if(C){A("#NoteFormContainer").jqmHide();var B=this.dataset.addComment(E,D);this.active=false}},cancel:function(){this.dataset.removeLastSelection();A("#NoteFormContainer").jqmHide();this.active=false},check:function(C,E,B){var D=true;if(C==""){A("#noteSubject").addClass("warning");D=false}else{A("#noteSubject").removeClass("warning")}if(E==""){A("#noteText").addClass("warning");D=false}else{A("#noteText").removeClass("warning")}return D},isActive:function(){return this.active}}})(jQuery);(function(A){eMend.commentTrigger=function(C){if(!(this instanceof arguments.callee)){return new eMend.commentTrigger(C)}this.opts=C;if(!this.opts.hideHOL){var D=false;if(window.hideHOL){D=window.hideHOL}else{if(document.location.href.indexOf("emendDisableHOL")!=-1){D=true}else{if(document.location.href.indexOf("emendEnableHOL")!=-1){D=false;A.aqCookie.del("hideHOL")}else{D=A.aqCookie.get("hideHOL")==true?true:false}}}this.opts.hideHOL=D}this.notifications=[];this.status=null;var B=this;A(document).mouseup(function(E){window.setTimeout(function(){var F=A.getSelectedText();if(!B.opts.form.isActive()&&F&&F.length){if(eMend.config.comment_target){var I=A.getSelection();var H=A(I.startContainer).parents(eMend.config.comment_target);var G=A(I.endContainer).parents(eMend.config.comment_target);if(H.length&G.length){B.show(1,1000)}else{B.show(3,1000);A(document).unbind("keyup.commentTrigger");A(document).unbind("keydown.commentTrigger")}}else{B.show(1,1000)}}else{B.show(0,1000)}},10)});this.template=A.template(eMend.templates.commentTrigger,{regx:"gettext"}).apply(eMend.dictionary.commentTrigger);this.create();this.show(0)};eMend.commentTrigger.prototype={create:function(){var B=A("#HOLteaser").remove();if(!B.length){B=A.create("div",{id:"HOLteaser",style:"cursor: pointer;"});B[0].innerHTML=this.template}this.opts.target.appendChild(B[0]);A(B).find("li").hide();return B},show:function(F,D){if(this.status==F){return}var B=this;A(".eMend-jGrowl div.close").trigger("click.jGrowl");var C=A("#HOLteaser").find("li")[F];var E=this.opts.sidebar.isOpen()==false?"bottom-right":"bottom-left";A.jGrowl.defaults.closer=false;A.jGrowl.defaults.position=E;if(!this.opts.hideHOL){window.setTimeout(function(){A.jGrowl(C.innerHTML,{theme:"eMend-jGrowl",life:6000,position:E});A(".emendHideHOL").click(function(){B.opts.hideHOL=true;A.aqCookie.set("hideHOL","true")})},500)}this.status=F;B.isCtrl=false;A(document).bind("keyup.commentTrigger",function(G){if(G.which==17){B.isCtrl=false}if(G.which==67&&B.isCtrl==false){G.stopPropagation();B.activate()}}).bind("keydown.commentTrigger",function(G){if(G.which==17){B.isCtrl=true}})},hide:function(C,B){A(document).unbind("keyup.commentTrigger");A(document).unbind("keydown.commentTrigger")},activate:function(){if(this.status!=2){this.hide();this.show(2);this.opts.form.show()}}}})(jQuery);(function(A){eMend.linker=function(B){if(!(this instanceof arguments.callee)){return new eMend.linker(B)}this.opts=A.extend({},eMend.linker.defaults,B);this.noteReferences=[];this.hiddenNodeLinks={};this.lastScrollInfo={x:0,y:0};this.destroyCanvas()};eMend.linker.defaults={};eMend.linker.prototype={createCanvas:function(E){var B=this.containerWidth=A(window).width()-20,D=this.containerHeight=A(window).height(),F=A(window).scrollTop(),C=A("#EmendLinks");if(E&&C.length){C.attr("width",B);C.attr("height",D);C[0].style.top=F+"px"}else{C=A.create("canvas",{id:"EmendLinks","class":"EmendOverlay",height:D,width:B})[0];C.style.top=F+"px";A(this.opts.target).append(C);if(A.browser.msie){G_vmlCanvasManager.initElement(C);C=document.getElementById("EmendLinks")}this.canvas=C;this.ctx=C.getContext("2d");this.ctx.lineWidth=1;A(C).click(this.hideLinks)}this.ctx.strokeStyle="#09f"},destroyCanvas:function(){A("#EmendLinks").remove()},hideLinks:function(){A("#EmendLinks").hide();A(this).trigger("emend.hidelinks");this._linksVisible=false},showLinks:function(){A("#EmendLinks").show();this._linksVisible=true},refreshLinks:function(B){this.createCanvas(true);this.clearLinks();this.renderLinks();if(!B){this.canvas.style.display="block"}},clearLinks:function(){if(this.canvas){this.canvas.getContext("2d").clearRect(0,0,this.containerWidth,this.containerHeight)}this._linksVisible=false},renderLinks:function(){var P=this.ctx,K={},I=this.opts.positions.getReferences(),D={x:A(window).scrollLeft(),y:A(window).scrollTop()},C=A.browser.opera&&A.browser.version>=9.5?12:5,G,H,F,J,M,O,E,N,B,L;for(H in I){F=A("#note"+H);M=I[H];G=M.node;if(this.hiddenNodeLinks[G]){continue}if(!F.length||F[0]&&F[0].style.display=="none"){if(K[G]){continue}K[G]=true;F=A("#noteGroup"+G)}J=A(F).offset({lite:true});O=M.left-D.x;E=M.top-D.y;N=E+C;B=J.left-D.x;L=J.top-D.y+8;P.beginPath();P.moveTo(O,E);P.lineTo(O,N);P.lineTo(B-25,N);P.lineTo(B-4,L);P.lineTo(B,L);P.stroke()}}}})(jQuery);(function(A){eMend.sidebar=function(B){if(!(this instanceof arguments.callee)){return new eMend.sidebar(B)}this.opts=A.extend({},eMend.sidebar.defaults,B);this.status="closed";this.template=A.template(eMend.templates.sidebar,{regx:"gettext"}).apply(eMend.dictionary.sidebar);this.create()};eMend.sidebar.defaults={body_open:"280px",body_closed:"27px"};eMend.sidebar.prototype={create:function(){var D=A("#eMend-sidebar")[0],C=A(window).height();if(!D){D=A.create("div",{id:"eMend-sidebar",style:"right: 0px; top: 0; height: "+C+"px;",unselectable:"on",className:this.status})[0];D.innerHTML=this.template;A(this.opts.target).append(D)}else{D.style.height=C+"px";this.status=A(D).attr("className")}var B=this;A(window).wresize(function(){B.refreshHeight()});A(document.body).css({marginRight:eMend.sidebar.defaults["body_"+this.status]});A(D).find(".sidebar-Y-header").click(function(){B.open()});A(D).find(".closesidebar").click(function(){B.close()});this.container=D},getContainer:function(){return A(this.container).find("#sidebar-body")[0]},destroy:function(){var B=A("eMend-sidebar");if(B){B.remove();delete this.container}},open:function(){A(".sidebar-wrapper").animate({right:"0"},500,"swing",function(){A(document.body).css({marginRight:"280px"});A(".sidebar-Y-header").css({right:"-60px"});A(document).trigger("emend.opensidebar")});A("#eMend-sidebar").attr("className","open");this.status="open"},close:function(){A(document.body).css({marginRight:"27px"});A(document).trigger("emend.closesidebar");A(".sidebar-wrapper").animate({right:"-260px"},500,"swing",function(){A(".sidebar-Y-header").animate({right:"0"},500,"swing")});A("#eMend-sidebar").attr("className","closed");this.status="closed"},extend:function(){A("#eMend-sidebar").css({width:"520px"});A(".sidebar-wrapper").animate({width:"520px"},500,"swing",function(){A(document.body).css({marginRight:"540px"});A(document).trigger("emend.opensidebar")})},refreshHeight:function(){var B=A(window).height();A(this.container).height(B+"px")},isOpen:function(){return(this.status=="open")}}})(jQuery);(function(A){eMend.navbar=function(B){if(!(this instanceof arguments.callee)){return new eMend.navbar(B)}this.opts=A.extend({},eMend.navbar.defaults,B);this.htmlEl=A("html");this.create();this.clear()};eMend.navbar.defaults={align:"right",width:"6px",height:"100%"};eMend.navbar.prototype={create:function(){this.htmlEl.css({height:"100%"});this.bar=A("#emend-navbar").remove()[0]||A.create("div",{id:"emend-navbar",style:B}," ")[0];var C=this.opts;var B=C.align+":0; top:0; width:"+C.width+"; height:"+C.height+"; position: absolute;";A(this.bar).attr("style",B);A(this.opts.target).append(this.bar)},refresh:function(){this.clear();this.render()},render:function(){var C=this.opts,B=A(document.body).height(),K=A(this.bar).height(),F=this.opts.positions.getHighlightsCollection();var E,H,M,D,J,L,N,G;for(var I=0;I<F.length;I++){E=F[I];H=E.className.split(" ").pop();M=A(E).height();D=A(E).offset({lite:true}).top;J=Math.round(M/B*K);L=Math.round(D/B*K);N="height:"+J+"px; width:"+C.width+"; position: absolute; top:"+L+"px; z-index:"+H.substr(1)+";";G=A.create("div",{"class":H,style:N})[0];this.bar.appendChild(G)}},clear:function(){A(this.bar).empty()}}})(jQuery);(function(A){eMend.positions=function(B){if(!(this instanceof arguments.callee)){return new eMend.positions(B)}this.highlightEls=null;this.highlights=null;this.references=null;this.opts=A.extend({},eMend.positions.defaults,B)};eMend.positions.prototype={invalidate:function(){var D,C,B;for(C=0,B=arguments.length;C<B;C++){D=arguments[C];switch(D){case"highlights":this.highlightEls=null;this.highlights=null;break;case"references":this.references=null;break}}},updateAll:function(){this.updateHighlightCollection();this.updateHighlights();this.updateReferences()},updateHighlightCollection:function(){this.highlightEls=A("nodeinner").filter(".highlight")},updateHighlights:function(){this.highlights={};var B=this.highlightEls;var I,F,H,G;for(var E=B.length-1;E>=0;E--){I=B[E];F=I.className.split(" ");F.pop();F.shift();for(var D=0,C=F.length;D<C;D++){H=F[D].substring(1);if(!this.highlights[H]){G=A(I).offset({lite:true});this.highlights[H]=G;this.highlights[H].bottom=G.top+A(I).height()}}}},updateReferences:function(){this.references={};var C=this.getHighlightsCollection();var B,I,D,G,K,E;for(var J=C.length-1;J>=0;J--){B=C[J];I=B.className.split(" ");I.pop();I.shift();for(var H=0,F=I.length;H<F;H++){D=I[H].substring(1);if(!this.references[D]){G=document.createElement("span");G.style.fontSize="1px";G.innerHTML="|";B.appendChild(G);E=A(G).offset({lite:true});this.references[D]=E;this.references[D].node=G.parentNode.getAttribute("node");B.removeChild(G)}}}},getVisibleHighlights:function(){var G,F=A(window).scrollTop(),C=A(window).height(),D=[],E=[],B=this.getHighlights();for(ntID in B){G=B[ntID];if(G.bottom>=F&&G.top<=C+F){D.push(ntID)}else{E.push(ntID)}}return{visible:D,invisible:E}},getInvisibleHighlights:function(){var E,D=A(window).scrollTop(),C=A(window).height(),F=[],B=this.getHighlights();for(ntID in B){E=B[ntID];if(E.bottom<=D||E.top>=C+D){F.push(ntID)}}return F},getReferences:function(){if(this.references==null){this.updateReferences()}return this.references},getReference:function(B){if(this.references==null){this.updateReferences()}return this.references[B]},getHighlights:function(){if(this.highlights==null){this.updateHighlights()}return this.highlights},getHighlight:function(B){if(this.highlights==null){this.updateHighlights()}return this.highlights[B]},getHighlightsCollection:function(){if(!this.highlightEls){this.updateHighlightCollection()}return this.highlightEls}}})(jQuery);(function(A){eMend.renderNotes=function(C){if(!(this instanceof arguments.callee)){return new eMend.renderNotes(C)}this.opts=A.extend({},eMend.renderNotes.defaults,C);this.container=this.opts.target;this.dataset=this.opts.dataset;this.positions=this.opts.positions;this.nodeStatus={};this.nodeLinkHidden={};this.renderedNotes={};var B=this;A(this.container).hover(function(){A(B).trigger("emend.notesHover")},function(){A(B).trigger("emend.notesUnHover")});this.clearNotes()};eMend.renderNotes.defaults={};eMend.renderNotes.prototype={clearNotes:function(){A(this.container).find(".noteGroup").remove()},renderNotes:function(){var J=this.container;var T=false,H=false,I=null,J=this.container,L=this.dataset;if(!T){this.clearNotes()}var C=A(".highlight"),M={},K={},E={},R={},G,P,B,S,V;for(var O=C.length-1;O>=0;O--){hlEL=C[O];S=A(hlEL.parentNode).attr("node");ntIDs=A(hlEL).attr("className").split(" ");ntIDs.pop();ntIDs.shift();if(!M[S]){V="noteGroup";V+=this.nodeStatus[S]?" readpart":" readfull";V+=this.nodeLinkHidden[S]?" unlinked":" linked";B=new eMend.commentGroup({nodeGroup:S,nodeClass:V});P=B.getElement();if(T){J.replaceChild(P,A("noteGroup"+refreshNode))}else{if(I){J.insertBefore(P,I)}else{J.appendChild(P)}}I=P;G=null;M[S]=true;count=0}for(var N=0,Q=ntIDs.length;N<Q;N++){ntID=ntIDs[N].substring(1);if(!K[ntID]){if(!this.nodeStatus[S]){uc=ntID.split("_");var F=L.getComment(uc[0],uc[1]);var D=F.getElement("emend-note even_"+H);H=!H;B.prependChild(D);G=D;this.renderedNotes[ntID]={group:B,comment:F}}K[ntID]=true;count++}}switch(count){case 0:R[S]=true;break;case 1:delete R[S];break;default:delete R[S]}}for(S in R){A("#noteGroup"+S).remove()}var U=A.create("div",{className:"noteGroup"});A(U).css({height:"50px",visibility:"hidden"});J.appendChild(U[0]);A(this).trigger("emend.rendernotes")},refreshView:function(){var I=this.positions.getVisibleHighlights(),E=I.invisible,G=I.visible,B,F;for(i=0,l=E.length;i<l;i++){var B=this.renderedNotes[E[i]];B.comment.hide();B.group.closeGroup()}for(i=0,l=G.length;i<l;i++){var F=this.renderedNotes[G[i]];F.comment.show();F.group.openGroup()}var H=G[G.length-1];var D=A("#note"+H);if(D.length){var C=(D.offset().top-A(window).scrollTop()+36)+"px";this.scrollTo(C)}else{window.setTimeout(function(){A(document).trigger("emend.afterviewscroll")},350)}},scrollTo:function(B){A("#sidebar-body").scrollTo({top:B},350,{onAfter:function(){A(document).trigger("emend.afterviewscroll")},stop:true})}}})(jQuery);(function(A){eMend.prefetch=function(D){var B=eMend.config;var I=typeof B.baseURI!="undefined"?B.baseURI:"../dist";var H=A("#eMend-comment-assets");if(!H.length){H=A(A.create("div",{id:"eMend-comment-assets"}));for(var E=0;E<21;E++){H.append(A.create("img",{src:I+"images/user"+E+".png"}))}H.append(A.create("img",{src:I+"images/more_big.png"}));H.append(A.create("img",{src:I+"images/less_big.png"}));H.append(A.create("img",{src:I+"images/more.png"}));H.append(A.create("img",{src:I+"images/less.png"}));A(D.datastore).append(H);var G=eMend.dictionary;G.comment.baseURI=G.comment_more.baseURI=G.commentGroup.baseURI=G.commentTrigger.baseURI=G.commentForm.baseURI=G.sidebar.baseURI=I+"images"}else{var C=A(H[0].firstChild).attr("src"),F=C.substr(0,C.lastIndexOf("/")),G=eMend.dictionary;G.comment.baseURI=G.comment_more.baseURI=G.commentGroup.baseURI=G.commentTrigger.baseURI=G.commentForm.baseURI=G.sidebar.baseURI=F}delete eMendBaseURI}})(jQuery);(function($){function toIntegersAtLease(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(date){return this.getUTCFullYear()+"-"+toIntegersAtLease(this.getUTCMonth())+"-"+toIntegersAtLease(this.getUTCDate())};var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};$.quoteString=function(string){if(escapeable.test(string)){return'"'+string.replace(escapeable,function(a){var c=meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};$.toJSON=function(o,compact){var type=typeof(o);if(type=="undefined"){return"undefined"}else{if(type=="number"||type=="boolean"){return o+""}else{if(o===null){return"null"}}}if(type=="string"){return $.quoteString(o)}if(type=="object"&&typeof o.toJSON=="function"){return o.toJSON(compact)}if(type!="function"&&typeof(o.length)=="number"){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i],compact))}if(compact){return"["+ret.join(",")+"]"}else{return"["+ret.join(", ")+"]"}}if(type=="function"){throw new TypeError("Unable to convert object of type 'function' to json.")}ret=[];for(var k in o){var name;var type=typeof(k);if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}val=$.toJSON(o[k],compact);if(typeof(val)!="string"){continue}if(compact){ret.push(name+":"+val)}else{ret.push(name+": "+val)}}return"{"+ret.join(", ")+"}"};$.compactJSON=function(o){return $.toJSON(o,true)};$.evalJSON=function(src){return eval("("+src+")")};$.secureEvalJSON=function(src){var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}}})(jQuery);(function(A){eMend.backstore=eMend.backstore||{};eMend.backstore.tiddly=function(C){if(!(this instanceof arguments.callee)){return new eMend.backstore.tiddly(C)}this.opts=A.extend({},eMend.backstore.tiddly.defaults,C);var B=A("#eMend-backstore-tiddly");if(B.length){this.importData(B)}else{B=this.createDataContainer()}this.container=B};eMend.backstore.tiddly.defaults={};eMend.backstore.tiddly.prototype={createDataContainer:function(C){var B=A.create("div",{id:"eMend-backstore-tiddly"});A(this.opts.datastore).append(B);return A(B)},addComment:function(){var C=this.opts.dataset.getLastSelection(),D=this.opts.dataset.getLastComment().data,B=A.create("div",{});A(B).attr("data",A.toJSON({s:C,c:D}));B[0].innerHTML=D.body;this.container.append(B)},importData:function(B){var C=this.opts.dataset;B.children().each(function(){var D=A.evalJSON(A(this).attr("data"));C.importEmendment(D.s,D.c)});A(document).trigger("emend.importData")}}})(jQuery);(function(A){eMend.backstore=eMend.backstore||{};eMend.backstore.sfEmendPlugin=function(B){if(!(this instanceof arguments.callee)){return new eMend.backstore.sfEmendPlugin(B)}this.opts=A.extend({},eMend.backstore.sfEmendPlugin.defaults,B);var C=window.location.pathname.split("/");C.shift();this.resourceID=C.join("_");this.getComments()};eMend.backstore.sfEmendPlugin.defaults={};eMend.backstore.sfEmendPlugin.prototype={addComment:function(){var B=this.opts.dataset.getLastSelection(),C=this.opts.dataset.getLastComment().data;C.selection=A.toJSON(B);A.ajax({url:"/fe_dev.php/emend.addComment/"+this.resourceID,data:C,success:function(D){}})},getComments:function(B){var C=this.opts.dataset;A.ajax({url:"/fe_dev.php/emend.getComments/"+this.resourceID,success:function(F,I){var G=A.evalJSON(F);var E,D,H;for(E=0,D=G.comments.length;E<D;E++){H=G.comments[E];C.importEmendment(H.s,H.c)}A(document).trigger("emend.importData")},error:function(D,F,E){this}})}}})(jQuery);(function(A){eMend.init=function(J){if(eMend.status=="running"){return}document.body.normalize();J(document).cleanWhitespace(true);var O=J("#eMend-DATA-Overlay").remove()[0]||J.create("div",{id:"eMend-DATA-Overlay",className:"hidden write-protect"})[0];var T=J("#eMend-VISUAL-Overlay").remove()[0]||J.create("div",{id:"eMend-VISUAL-Overlay",className:"write-protect"})[0];if(J.browser.msie||J.browser.safari){J(document.body).append(O).append(T)}else{J(document.body.parentNode).append(O).append(T)}var b=eMend.prefetch({datastore:O});var Z=eMend.sidebar({target:T});var K=Z.getContainer();var U=eMend.dataset({target:document.body,datastore:O}),X=eMend.positions(),P=eMend.renderNotes({dataset:U,target:K,positions:X}),M=eMend.navbar({target:K.parentNode,positions:X}),S=eMend.commentForm({dataset:U,target:T}),I=eMend.commentTrigger({target:T,form:S,sidebar:Z}),N=eMend.linker({target:T,positions:X});var F=-1;var V=window.scrollY;var D=function(){if(Z.isOpen()){N.refreshLinks()}},Q=function(){if(Z.isOpen()){P.refreshView()}},Y=function(){N.hideLinks()},R=function(){N.clearLinks()},C=function(){M.refresh()},W=function(){X.invalidate("highlights","references")},H=function(){eMend.highlight(U);P.renderNotes()},L=function(){Z.open()},G=function(){window.clearTimeout(F);F=window.setTimeout(function(){J(document).trigger("emend.afterscroll")},450)};delayedRefresh=function(){if(V!=window.scrollY){Y();G();V=window.scrollY}};J(document).bind("emend.addComment",H);J(document).bind("emend.opensidebar",function(){D()});J(document).bind("emend.opensidebar",C);J(document).bind("emend.closesidebar",function(){Y();window.setTimeout(R,500)});J(document).bind("emend.addComment",function(){I.show(0)});J(document).bind("emend.highlight",W);J(document).bind("emend.importData",function(){H()});J(P).bind("emend.notesHover",D);J(P).bind("emend.rendernotes",L);J(document).bind("emend.afterscroll",Q);J(document).bind("emend.afterviewscroll",D);J(document).bind("emend.toggleGroup",function(){D()});J(window).wresize(W);J(window).wresize(D);J(window).wresize(C);if(eMend.config.scroll_refresh_delay){J(window).scroll(delayedRefresh)}else{J(window).scroll(D);J(window).scroll(G)}if(eMend.config.backstore_tiddly){var E=eMend.backstore.tiddly({dataset:U,datastore:O});J(document).bind("emend.addComment",function(){E.addComment()})}if(eMend.config.backstore_sfEmendPlugin){var a=eMend.backstore.sfEmendPlugin({dataset:U});J(document).bind("emend.addComment",function(){a.addComment()})}eMend.status="running"};if(!window.console||!window.console.firebug){var B=["dir","dirxml","group","groupEnd","trace","profile","profileEnd","log","debug","info","warn","error","time","timeEnd","assert","count"];window.console={};for(i in B){window.console[B[i]]=function(){}}}if(typeof eMendInit!="undefined"&&eMendInit==true){eMend.init(jQuery)}A(document).ready(function(){eMend.init(jQuery)})})(jQuery);if(eMend.config.jquery_noconflict){jQuery.noConflict()};